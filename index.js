const e=[127462,127487];function i(e){return 8205===e||65038===e||65039===e||e>=127995&&e<=128e3||e>=129456&&e<=129460||e>=917536&&e<=917632}function n(i){return i>=e[0]&&i<=e[1]}class t{constructor(e){this.obeyspaces=!1,this.s=function(e){if(/^[\u0020-\u00FF]*$/.test(e))return e;const t=[],r=function(e){const i=[];for(let n=0;n<e.length;n++){let t=e.charCodeAt(n);if(t>=55296&&t<=56319){const i=e.charCodeAt(n+1);i>=56320&&i<=57343&&(t=65536+1024*(t-55296)+(i-56320),n++);}i.push(t);}return i}(e);let o=0;for(;o<r.length;){const e=r[o++],s=r[o];if(8205===s){const e=o-1;for(o+=2;8205===r[o];)o+=2;t.push(String.fromCodePoint(...r.slice(e,2*o-e+1)));}else if(i(s)){const e=o-1;for(;i(r[o]);)o+=8205===r[o]?2:1;t.push(String.fromCodePoint(...r.slice(e,2*o-e-1)));}else n(e)?(o+=1,t.push(String.fromCodePoint(...r.slice(o-2,2)))):t.push(String.fromCodePoint(e));}return t}(e),this.pos=0;}end(){return this.pos>=this.s.length}get(){return this.pos<this.s.length?this.s[this.pos++]:""}peek(){return this.s[this.pos]}match(e){let i;return i="string"==typeof this.s?e.exec(this.s.slice(this.pos)):e.exec(this.s.slice(this.pos).join("")),(null==i?void 0:i[0])?(this.pos+=i[0].length,i[0]):null}next(){if(this.end())return null;if(!this.obeyspaces&&this.match(/^[ \f\n\r\t\v\xA0\u2028\u2029]+/))return "<space>";if(this.obeyspaces&&this.match(/^[ \f\n\r\t\v\xA0\u2028\u2029]/))return "<space>";const e=this.get();if("\\"===e){if(!this.end()){let e=this.match(/^[a-zA-Z*]+/);if(e)this.match(/^[ \f\n\r\t\v\xA0\u2028\u2029]*/);else if(e=this.get()," "===e)return "<space>";return "\\"+e}}else {if("{"===e)return "<{>";if("}"===e)return "<}>";if("^"===e){if("^"===this.peek()){this.get();const e=this.match(/^(\^(\^(\^(\^[0-9a-f])?[0-9a-f])?[0-9a-f])?[0-9a-f])?[0-9a-f][0-9a-f]/);if(e)return String.fromCodePoint(parseInt(e.slice(e.lastIndexOf("^")+1),16))}return e}if("#"===e){if(!this.end()){let e=!1;if(/[0-9?]/.test(this.peek())&&(e=!0,this.pos+1<this.s.length)){const i=this.s[this.pos+1];e=/[^0-9A-Za-z]/.test(i);}return e?"#"+this.get():"#"}}else if("$"===e)return "$"===this.peek()?(this.get(),"<$$>"):"<$>"}return e}}function r(e,i){var n,t,r,s;let a=[],l=e.next();if(l)if("\\relax"===l);else if("\\noexpand"===l)l=e.next(),l&&a.push(l);else if("\\obeyspaces"===l)e.obeyspaces=!0;else if("\\space"===l||"~"===l)a.push("<space>");else if("\\bgroup"===l)a.push("<{>");else if("\\egroup"===l)a.push("<}>");else if("\\string"===l)l=e.next(),l&&("\\"===l[0]?Array.from(l).forEach((e=>a.push("\\"===e?"\\backslash":e))):"<{>"===l?a.push("\\{"):"<space>"===l?a.push("~"):"<}>"===l&&a.push("\\}"));else if("\\csname"===l){for(;"<space>"===e.peek();)e.next();let r="",s=!1,u=[];do{if(0===u.length)if(/^#[0-9?]$/.test(e.peek())){const r=e.get().slice(1);u=o(null!==(t=null!==(n=null==i?void 0:i[r])&&void 0!==n?n:null==i?void 0:i["?"])&&void 0!==t?t:"\\placeholder{}",i),l=u[0];}else l=e.next(),u=l?[l]:[];s=0===u.length,s||"\\endcsname"!==l||(s=!0,u.shift()),s||(s="<$>"===l||"<$$>"===l||"<{>"===l||"<}>"===l||!!l&&l.length>1&&"\\"===l[0]),s||(r+=u.shift());}while(!s);r&&a.push("\\"+r),a=a.concat(u);}else if("\\endcsname"===l);else if(l.length>1&&"#"===l[0]){const e=l.slice(1);a=a.concat(o(null!==(s=null!==(r=null==i?void 0:i[e])&&void 0!==r?r:null==i?void 0:i["?"])&&void 0!==s?s:"\\placeholder{}",i));}else a.push(l);return a}function o(e,i){const n=e.toString().split(/\r?\n/);let o="",s="";for(const e of n){o+=s,s=" ";const i=e.match(/((?:\\%)|[^%])*/);null!==i&&(o+=i[0]);}const a=new t(o);let l=[];do{l=l.concat(r(a,i));}while(!a.end());return l}function s(e){let i="",n="";for(const t of e)t&&(/[a-zA-Z*]/.test(t[0])&&(n+=i),i=/\\[a-zA-Z]+\*?$/.test(t)?" ":"",n+=t);return n}function a(e){let i=[];if(Array.isArray(e))for(const n of e)Array.isArray(n)?i=[...i,...n]:i.push(n);else i=[e];return s(i.map((e=>{var i;return null!==(i={"<space>":" ","<$$>":"$$","<$>":"$","<{>":"{","<}>":"}"}[e])&&void 0!==i?i:e})))}var l,u="undefined"!=typeof globalThis?globalThis:"undefined"!=typeof window?window:"undefined"!=typeof global?global:"undefined"!=typeof self?self:{},c={exports:{}};l=c,function(e){var i,n,t,r,o=9e15,s=1e9,a="0123456789abcdef",u="2.3025850929940456840179914546843642076011014886287729760333279009675726096773524802359972050895982983419677840422862486334095254650828067566662873690987816894829072083255546808437998948262331985283935053089653777326288461633662222876982198867465436674744042432743651550489343149393914796194044002221051017141748003688084012647080685567743216228355220114804663715659121373450747856947683463616792101806445070648000277502684916746550586856935673420670581136429224554405758925724208241314695689016758940256776311356919292033376587141660230105703089634572075440370847469940168269282808481184289314848524948644871927809676271275775397027668605952496716674183485704422507197965004714951050492214776567636938662976979522110718264549734772662425709429322582798502585509785265383207606726317164309505995087807523710333101197857547331541421808427543863591778117054309827482385045648019095610299291824318237525357709750539565187697510374970888692180205189339507238539205144634197265287286965110862571492198849978748873771345686209167058",c="3.1415926535897932384626433832795028841971693993751058209749445923078164062862089986280348253421170679821480865132823066470938446095505822317253594081284811174502841027019385211055596446229489549303819644288109756659334461284756482337867831652712019091456485669234603486104543266482133936072602491412737245870066063155881748815209209628292540917153643678925903600113305305488204665213841469519415116094330572703657595919530921861173819326117931051185480744623799627495673518857527248912279381830119491298336733624406566430860213949463952247371907021798609437027705392171762931767523846748184676694051320005681271452635608277857713427577896091736371787214684409012249534301465495853710507922796892589235420199561121290219608640344181598136297747713099605187072113499999983729780499510597317328160963185950244594553469083026425223082533446850352619311881710100031378387528865875332083814206171776691473035982534904287554687311595628638823537875937519577818577805321712268066130019278766111959092164201989380952572010654858632789",m={precision:20,rounding:4,modulo:1,toExpNeg:-7,toExpPos:21,minE:-o,maxE:o,crypto:!1},f=!0,h="[DecimalError] ",p=h+"Invalid argument: ",g=h+"Precision limit exceeded",d=h+"crypto unavailable",v=Math.floor,x=Math.pow,y=/^0b([01]+(\.[01]*)?|\.[01]+)(p[+-]?\d+)?$/i,b=/^0x([0-9a-f]+(\.[0-9a-f]*)?|\.[0-9a-f]+)(p[+-]?\d+)?$/i,N=/^0o([0-7]+(\.[0-7]*)?|\.[0-7]+)(p[+-]?\d+)?$/i,w=/^(\d+(\.\d*)?|\.\d+)(e[+-]?\d+)?$/i,S=1e7,M=u.length-1,E=c.length-1,D={name:"[object Decimal]"};function A(e){var i,n,t,r=e.length-1,o="",s=e[0];if(r>0){for(o+=s,i=1;i<r;i++)(n=7-(t=e[i]+"").length)&&(o+=_(n)),o+=t;(n=7-(t=(s=e[i])+"").length)&&(o+=_(n));}else if(0===s)return "0";for(;s%10==0;)s/=10;return o+s}function C(e,i,n){if(e!==~~e||e<i||e>n)throw Error(p+e)}function q(e,i,n,t){var r,o,s,a;for(o=e[0];o>=10;o/=10)--i;return --i<0?(i+=7,r=0):(r=Math.ceil((i+1)/7),i%=7),o=x(10,7-i),a=e[r]%o|0,null==t?i<3?(0==i?a=a/100|0:1==i&&(a=a/10|0),s=n<4&&99999==a||n>3&&49999==a||5e4==a||0==a):s=(n<4&&a+1==o||n>3&&a+1==o/2)&&(e[r+1]/o/100|0)==x(10,i-2)-1||(a==o/2||0==a)&&0==(e[r+1]/o/100|0):i<4?(0==i?a=a/1e3|0:1==i?a=a/100|0:2==i&&(a=a/10|0),s=(t||n<4)&&9999==a||!t&&n>3&&4999==a):s=((t||n<4)&&a+1==o||!t&&n>3&&a+1==o/2)&&(e[r+1]/o/1e3|0)==x(10,i-3)-1,s}function F(e,i,n){for(var t,r,o=[0],s=0,l=e.length;s<l;){for(r=o.length;r--;)o[r]*=i;for(o[0]+=a.indexOf(e.charAt(s++)),t=0;t<o.length;t++)o[t]>n-1&&(void 0===o[t+1]&&(o[t+1]=0),o[t+1]+=o[t]/n|0,o[t]%=n);}return o.reverse()}D.absoluteValue=D.abs=function(){var e=new this.constructor(this);return e.s<0&&(e.s=1),k(e)},D.ceil=function(){return k(new this.constructor(this),this.e+1,2)},D.comparedTo=D.cmp=function(e){var i,n,t,r,o=this,s=o.d,a=(e=new o.constructor(e)).d,l=o.s,u=e.s;if(!s||!a)return l&&u?l!==u?l:s===a?0:!s^l<0?1:-1:NaN;if(!s[0]||!a[0])return s[0]?l:a[0]?-u:0;if(l!==u)return l;if(o.e!==e.e)return o.e>e.e^l<0?1:-1;for(i=0,n=(t=s.length)<(r=a.length)?t:r;i<n;++i)if(s[i]!==a[i])return s[i]>a[i]^l<0?1:-1;return t===r?0:t>r^l<0?1:-1},D.cosine=D.cos=function(){var e,i,n=this,t=n.constructor;return n.d?n.d[0]?(e=t.precision,i=t.rounding,t.precision=e+Math.max(n.e,n.sd())+7,t.rounding=1,n=function(e,i){var n,t,r=i.d.length;r<32?t=(1/W(4,n=Math.ceil(r/3))).toString():(n=16,t="2.3283064365386962890625e-10"),e.precision+=n,i=G(e,1,i.times(t),new e(1));for(var o=n;o--;){var s=i.times(i);i=s.times(s).minus(s).times(8).plus(1);}return e.precision-=n,i}(t,V(t,n)),t.precision=e,t.rounding=i,k(2==r||3==r?n.neg():n,e,i,!0)):new t(1):new t(NaN)},D.cubeRoot=D.cbrt=function(){var e,i,n,t,r,o,s,a,l,u,c=this,m=c.constructor;if(!c.isFinite()||c.isZero())return new m(c);for(f=!1,(o=c.s*x(c.s*c,1/3))&&Math.abs(o)!=1/0?t=new m(o.toString()):(n=A(c.d),(o=((e=c.e)-n.length+1)%3)&&(n+=1==o||-2==o?"0":"00"),o=x(n,1/3),e=v((e+1)/3)-(e%3==(e<0?-1:2)),(t=new m(n=o==1/0?"5e"+e:(n=o.toExponential()).slice(0,n.indexOf("e")+1)+e)).s=c.s),s=(e=m.precision)+3;;)if(u=(l=(a=t).times(a).times(a)).plus(c),t=I(u.plus(c).times(a),u.plus(l),s+2,1),A(a.d).slice(0,s)===(n=A(t.d)).slice(0,s)){if("9999"!=(n=n.slice(s-3,s+1))&&(r||"4999"!=n)){+n&&(+n.slice(1)||"5"!=n.charAt(0))||(k(t,e+1,1),i=!t.times(t).times(t).eq(c));break}if(!r&&(k(a,e+1,0),a.times(a).times(a).eq(c))){t=a;break}s+=4,r=1;}return f=!0,k(t,e,m.rounding,i)},D.decimalPlaces=D.dp=function(){var e,i=this.d,n=NaN;if(i){if(n=7*((e=i.length-1)-v(this.e/7)),e=i[e])for(;e%10==0;e/=10)n--;n<0&&(n=0);}return n},D.dividedBy=D.div=function(e){return I(this,new this.constructor(e))},D.dividedToIntegerBy=D.divToInt=function(e){var i=this.constructor;return k(I(this,new i(e),0,1,1),i.precision,i.rounding)},D.equals=D.eq=function(e){return 0===this.cmp(e)},D.floor=function(){return k(new this.constructor(this),this.e+1,3)},D.greaterThan=D.gt=function(e){return this.cmp(e)>0},D.greaterThanOrEqualTo=D.gte=function(e){var i=this.cmp(e);return 1==i||0===i},D.hyperbolicCosine=D.cosh=function(){var e,i,n,t,r,o=this,s=o.constructor,a=new s(1);if(!o.isFinite())return new s(o.s?1/0:NaN);if(o.isZero())return a;n=s.precision,t=s.rounding,s.precision=n+Math.max(o.e,o.sd())+4,s.rounding=1,(r=o.d.length)<32?i=(1/W(4,e=Math.ceil(r/3))).toString():(e=16,i="2.3283064365386962890625e-10"),o=G(s,1,o.times(i),new s(1),!0);for(var l,u=e,c=new s(8);u--;)l=o.times(o),o=a.minus(l.times(c.minus(l.times(c))));return k(o,s.precision=n,s.rounding=t,!0)},D.hyperbolicSine=D.sinh=function(){var e,i,n,t,r=this,o=r.constructor;if(!r.isFinite()||r.isZero())return new o(r);if(i=o.precision,n=o.rounding,o.precision=i+Math.max(r.e,r.sd())+4,o.rounding=1,(t=r.d.length)<3)r=G(o,2,r,r,!0);else {e=(e=1.4*Math.sqrt(t))>16?16:0|e,r=G(o,2,r=r.times(1/W(5,e)),r,!0);for(var s,a=new o(5),l=new o(16),u=new o(20);e--;)s=r.times(r),r=r.times(a.plus(s.times(l.times(s).plus(u))));}return o.precision=i,o.rounding=n,k(r,i,n,!0)},D.hyperbolicTangent=D.tanh=function(){var e,i,n=this,t=n.constructor;return n.isFinite()?n.isZero()?new t(n):(e=t.precision,i=t.rounding,t.precision=e+7,t.rounding=1,I(n.sinh(),n.cosh(),t.precision=e,t.rounding=i)):new t(n.s)},D.inverseCosine=D.acos=function(){var e,i=this,n=i.constructor,t=i.abs().cmp(1),r=n.precision,o=n.rounding;return -1!==t?0===t?i.isNeg()?z(n,r,o):new n(0):new n(NaN):i.isZero()?z(n,r+4,o).times(.5):(n.precision=r+6,n.rounding=1,i=i.asin(),e=z(n,r+4,o).times(.5),n.precision=r,n.rounding=o,e.minus(i))},D.inverseHyperbolicCosine=D.acosh=function(){var e,i,n=this,t=n.constructor;return n.lte(1)?new t(n.eq(1)?0:NaN):n.isFinite()?(e=t.precision,i=t.rounding,t.precision=e+Math.max(Math.abs(n.e),n.sd())+4,t.rounding=1,f=!1,n=n.times(n).minus(1).sqrt().plus(n),f=!0,t.precision=e,t.rounding=i,n.ln()):new t(n)},D.inverseHyperbolicSine=D.asinh=function(){var e,i,n=this,t=n.constructor;return !n.isFinite()||n.isZero()?new t(n):(e=t.precision,i=t.rounding,t.precision=e+2*Math.max(Math.abs(n.e),n.sd())+6,t.rounding=1,f=!1,n=n.times(n).plus(1).sqrt().plus(n),f=!0,t.precision=e,t.rounding=i,n.ln())},D.inverseHyperbolicTangent=D.atanh=function(){var e,i,n,t,r=this,o=r.constructor;return r.isFinite()?r.e>=0?new o(r.abs().eq(1)?r.s/0:r.isZero()?r:NaN):(e=o.precision,i=o.rounding,t=r.sd(),Math.max(t,e)<2*-r.e-1?k(new o(r),e,i,!0):(o.precision=n=t-r.e,r=I(r.plus(1),new o(1).minus(r),n+e,1),o.precision=e+4,o.rounding=1,r=r.ln(),o.precision=e,o.rounding=i,r.times(.5))):new o(NaN)},D.inverseSine=D.asin=function(){var e,i,n,t,r=this,o=r.constructor;return r.isZero()?new o(r):(i=r.abs().cmp(1),n=o.precision,t=o.rounding,-1!==i?0===i?((e=z(o,n+4,t).times(.5)).s=r.s,e):new o(NaN):(o.precision=n+6,o.rounding=1,r=r.div(new o(1).minus(r.times(r)).sqrt().plus(1)).atan(),o.precision=n,o.rounding=t,r.times(2)))},D.inverseTangent=D.atan=function(){var e,i,n,t,r,o,s,a,l,u=this,c=u.constructor,m=c.precision,h=c.rounding;if(u.isFinite()){if(u.isZero())return new c(u);if(u.abs().eq(1)&&m+4<=E)return (s=z(c,m+4,h).times(.25)).s=u.s,s}else {if(!u.s)return new c(NaN);if(m+4<=E)return (s=z(c,m+4,h).times(.5)).s=u.s,s}for(c.precision=a=m+10,c.rounding=1,e=n=Math.min(28,a/7+2|0);e;--e)u=u.div(u.times(u).plus(1).sqrt().plus(1));for(f=!1,i=Math.ceil(a/7),t=1,l=u.times(u),s=new c(u),r=u;-1!==e;)if(r=r.times(l),o=s.minus(r.div(t+=2)),r=r.times(l),void 0!==(s=o.plus(r.div(t+=2))).d[i])for(e=i;s.d[e]===o.d[e]&&e--;);return n&&(s=s.times(2<<n-1)),f=!0,k(s,c.precision=m,c.rounding=h,!0)},D.isFinite=function(){return !!this.d},D.isInteger=D.isInt=function(){return !!this.d&&v(this.e/7)>this.d.length-2},D.isNaN=function(){return !this.s},D.isNegative=D.isNeg=function(){return this.s<0},D.isPositive=D.isPos=function(){return this.s>0},D.isZero=function(){return !!this.d&&0===this.d[0]},D.lessThan=D.lt=function(e){return this.cmp(e)<0},D.lessThanOrEqualTo=D.lte=function(e){return this.cmp(e)<1},D.logarithm=D.log=function(e){var i,n,t,r,o,s,a,l,u=this,c=u.constructor,m=c.precision,h=c.rounding;if(null==e)e=new c(10),i=!0;else {if(n=(e=new c(e)).d,e.s<0||!n||!n[0]||e.eq(1))return new c(NaN);i=e.eq(10);}if(n=u.d,u.s<0||!n||!n[0]||u.eq(1))return new c(n&&!n[0]?-1/0:1!=u.s?NaN:n?0:1/0);if(i)if(n.length>1)o=!0;else {for(r=n[0];r%10==0;)r/=10;o=1!==r;}if(f=!1,s=$(u,a=m+5),t=i?O(c,a+10):$(e,a),q((l=I(s,t,a,1)).d,r=m,h))do{if(s=$(u,a+=10),t=i?O(c,a+10):$(e,a),l=I(s,t,a,1),!o){+A(l.d).slice(r+1,r+15)+1==1e14&&(l=k(l,m+1,0));break}}while(q(l.d,r+=10,h));return f=!0,k(l,m,h)},D.minus=D.sub=function(e){var i,n,t,r,o,s,a,l,u,c,m,h,p=this,g=p.constructor;if(e=new g(e),!p.d||!e.d)return p.s&&e.s?p.d?e.s=-e.s:e=new g(e.d||p.s!==e.s?p:NaN):e=new g(NaN),e;if(p.s!=e.s)return e.s=-e.s,p.plus(e);if(u=p.d,h=e.d,a=g.precision,l=g.rounding,!u[0]||!h[0]){if(h[0])e.s=-e.s;else {if(!u[0])return new g(3===l?-0:0);e=new g(p);}return f?k(e,a,l):e}if(n=v(e.e/7),c=v(p.e/7),u=u.slice(),o=c-n){for((m=o<0)?(i=u,o=-o,s=h.length):(i=h,n=c,s=u.length),o>(t=Math.max(Math.ceil(a/7),s)+2)&&(o=t,i.length=1),i.reverse(),t=o;t--;)i.push(0);i.reverse();}else {for((m=(t=u.length)<(s=h.length))&&(s=t),t=0;t<s;t++)if(u[t]!=h[t]){m=u[t]<h[t];break}o=0;}for(m&&(i=u,u=h,h=i,e.s=-e.s),s=u.length,t=h.length-s;t>0;--t)u[s++]=0;for(t=h.length;t>o;){if(u[--t]<h[t]){for(r=t;r&&0===u[--r];)u[r]=S-1;--u[r],u[t]+=S;}u[t]-=h[t];}for(;0===u[--s];)u.pop();for(;0===u[0];u.shift())--n;return u[0]?(e.d=u,e.e=T(u,n),f?k(e,a,l):e):new g(3===l?-0:0)},D.modulo=D.mod=function(e){var i,n=this,t=n.constructor;return e=new t(e),!n.d||!e.s||e.d&&!e.d[0]?new t(NaN):!e.d||n.d&&!n.d[0]?k(new t(n),t.precision,t.rounding):(f=!1,9==t.modulo?(i=I(n,e.abs(),0,3,1)).s*=e.s:i=I(n,e,0,t.modulo,1),i=i.times(e),f=!0,n.minus(i))},D.naturalExponential=D.exp=function(){return H(this)},D.naturalLogarithm=D.ln=function(){return $(this)},D.negated=D.neg=function(){var e=new this.constructor(this);return e.s=-e.s,k(e)},D.plus=D.add=function(e){var i,n,t,r,o,s,a,l,u,c,m=this,h=m.constructor;if(e=new h(e),!m.d||!e.d)return m.s&&e.s?m.d||(e=new h(e.d||m.s===e.s?m:NaN)):e=new h(NaN),e;if(m.s!=e.s)return e.s=-e.s,m.minus(e);if(u=m.d,c=e.d,a=h.precision,l=h.rounding,!u[0]||!c[0])return c[0]||(e=new h(m)),f?k(e,a,l):e;if(o=v(m.e/7),t=v(e.e/7),u=u.slice(),r=o-t){for(r<0?(n=u,r=-r,s=c.length):(n=c,t=o,s=u.length),r>(s=(o=Math.ceil(a/7))>s?o+1:s+1)&&(r=s,n.length=1),n.reverse();r--;)n.push(0);n.reverse();}for((s=u.length)-(r=c.length)<0&&(r=s,n=c,c=u,u=n),i=0;r;)i=(u[--r]=u[r]+c[r]+i)/S|0,u[r]%=S;for(i&&(u.unshift(i),++t),s=u.length;0==u[--s];)u.pop();return e.d=u,e.e=T(u,t),f?k(e,a,l):e},D.precision=D.sd=function(e){var i,n=this;if(void 0!==e&&e!==!!e&&1!==e&&0!==e)throw Error(p+e);return n.d?(i=L(n.d),e&&n.e+1>i&&(i=n.e+1)):i=NaN,i},D.round=function(){var e=this,i=e.constructor;return k(new i(e),e.e+1,i.rounding)},D.sine=D.sin=function(){var e,i,n=this,t=n.constructor;return n.isFinite()?n.isZero()?new t(n):(e=t.precision,i=t.rounding,t.precision=e+Math.max(n.e,n.sd())+7,t.rounding=1,n=function(e,i){var n,t=i.d.length;if(t<3)return G(e,2,i,i);n=(n=1.4*Math.sqrt(t))>16?16:0|n,i=G(e,2,i=i.times(1/W(5,n)),i);for(var r,o=new e(5),s=new e(16),a=new e(20);n--;)r=i.times(i),i=i.times(o.plus(r.times(s.times(r).minus(a))));return i}(t,V(t,n)),t.precision=e,t.rounding=i,k(r>2?n.neg():n,e,i,!0)):new t(NaN)},D.squareRoot=D.sqrt=function(){var e,i,n,t,r,o,s=this,a=s.d,l=s.e,u=s.s,c=s.constructor;if(1!==u||!a||!a[0])return new c(!u||u<0&&(!a||a[0])?NaN:a?s:1/0);for(f=!1,0==(u=Math.sqrt(+s))||u==1/0?(((i=A(a)).length+l)%2==0&&(i+="0"),u=Math.sqrt(i),l=v((l+1)/2)-(l<0||l%2),t=new c(i=u==1/0?"5e"+l:(i=u.toExponential()).slice(0,i.indexOf("e")+1)+l)):t=new c(u.toString()),n=(l=c.precision)+3;;)if(t=(o=t).plus(I(s,o,n+2,1)).times(.5),A(o.d).slice(0,n)===(i=A(t.d)).slice(0,n)){if("9999"!=(i=i.slice(n-3,n+1))&&(r||"4999"!=i)){+i&&(+i.slice(1)||"5"!=i.charAt(0))||(k(t,l+1,1),e=!t.times(t).eq(s));break}if(!r&&(k(o,l+1,0),o.times(o).eq(s))){t=o;break}n+=4,r=1;}return f=!0,k(t,l,c.rounding,e)},D.tangent=D.tan=function(){var e,i,n=this,t=n.constructor;return n.isFinite()?n.isZero()?new t(n):(e=t.precision,i=t.rounding,t.precision=e+10,t.rounding=1,(n=n.sin()).s=1,n=I(n,new t(1).minus(n.times(n)).sqrt(),e+10,0),t.precision=e,t.rounding=i,k(2==r||4==r?n.neg():n,e,i,!0)):new t(NaN)},D.times=D.mul=function(e){var i,n,t,r,o,s,a,l,u,c=this,m=c.constructor,h=c.d,p=(e=new m(e)).d;if(e.s*=c.s,!(h&&h[0]&&p&&p[0]))return new m(!e.s||h&&!h[0]&&!p||p&&!p[0]&&!h?NaN:h&&p?0*e.s:e.s/0);for(n=v(c.e/7)+v(e.e/7),(l=h.length)<(u=p.length)&&(o=h,h=p,p=o,s=l,l=u,u=s),o=[],t=s=l+u;t--;)o.push(0);for(t=u;--t>=0;){for(i=0,r=l+t;r>t;)a=o[r]+p[t]*h[r-t-1]+i,o[r--]=a%S|0,i=a/S|0;o[r]=(o[r]+i)%S|0;}for(;!o[--s];)o.pop();return i?++n:o.shift(),e.d=o,e.e=T(o,n),f?k(e,m.precision,m.rounding):e},D.toBinary=function(e,i){return Y(this,2,e,i)},D.toDecimalPlaces=D.toDP=function(e,i){var n=this,t=n.constructor;return n=new t(n),void 0===e?n:(C(e,0,s),void 0===i?i=t.rounding:C(i,0,8),k(n,e+n.e+1,i))},D.toExponential=function(e,i){var n,t=this,r=t.constructor;return void 0===e?n=P(t,!0):(C(e,0,s),void 0===i?i=r.rounding:C(i,0,8),n=P(t=k(new r(t),e+1,i),!0,e+1)),t.isNeg()&&!t.isZero()?"-"+n:n},D.toFixed=function(e,i){var n,t,r=this,o=r.constructor;return void 0===e?n=P(r):(C(e,0,s),void 0===i?i=o.rounding:C(i,0,8),n=P(t=k(new o(r),e+r.e+1,i),!1,e+t.e+1)),r.isNeg()&&!r.isZero()?"-"+n:n},D.toFraction=function(e){var i,n,t,r,o,s,a,l,u,c,m,h,g=this,d=g.d,v=g.constructor;if(!d)return new v(g);if(u=n=new v(1),t=l=new v(0),s=(o=(i=new v(t)).e=L(d)-g.e-1)%7,i.d[0]=x(10,s<0?7+s:s),null==e)e=o>0?i:u;else {if(!(a=new v(e)).isInt()||a.lt(u))throw Error(p+a);e=a.gt(i)?o>0?i:u:a;}for(f=!1,a=new v(A(d)),c=v.precision,v.precision=o=7*d.length*2;m=I(a,i,0,1,1),1!=(r=n.plus(m.times(t))).cmp(e);)n=t,t=r,r=u,u=l.plus(m.times(r)),l=r,r=i,i=a.minus(m.times(r)),a=r;return r=I(e.minus(n),t,0,1,1),l=l.plus(r.times(u)),n=n.plus(r.times(t)),l.s=u.s=g.s,h=I(u,t,o,1).minus(g).abs().cmp(I(l,n,o,1).minus(g).abs())<1?[u,t]:[l,n],v.precision=c,f=!0,h},D.toHexadecimal=D.toHex=function(e,i){return Y(this,16,e,i)},D.toNearest=function(e,i){var n=this,t=n.constructor;if(n=new t(n),null==e){if(!n.d)return n;e=new t(1),i=t.rounding;}else {if(e=new t(e),void 0===i?i=t.rounding:C(i,0,8),!n.d)return e.s?n:e;if(!e.d)return e.s&&(e.s=n.s),e}return e.d[0]?(f=!1,n=I(n,e,0,i,1).times(e),f=!0,k(n)):(e.s=n.s,n=e),n},D.toNumber=function(){return +this},D.toOctal=function(e,i){return Y(this,8,e,i)},D.toPower=D.pow=function(e){var i,n,t,r,o,s,a=this,l=a.constructor,u=+(e=new l(e));if(!(a.d&&e.d&&a.d[0]&&e.d[0]))return new l(x(+a,u));if((a=new l(a)).eq(1))return a;if(t=l.precision,o=l.rounding,e.eq(1))return k(a,t,o);if((i=v(e.e/7))>=e.d.length-1&&(n=u<0?-u:u)<=9007199254740991)return r=R(l,a,n,t),e.s<0?new l(1).div(r):k(r,t,o);if((s=a.s)<0){if(i<e.d.length-1)return new l(NaN);if(0==(1&e.d[i])&&(s=1),0==a.e&&1==a.d[0]&&1==a.d.length)return a.s=s,a}return (i=0!=(n=x(+a,u))&&isFinite(n)?new l(n+"").e:v(u*(Math.log("0."+A(a.d))/Math.LN10+a.e+1)))>l.maxE+1||i<l.minE-1?new l(i>0?s/0:0):(f=!1,l.rounding=a.s=1,n=Math.min(12,(i+"").length),(r=H(e.times($(a,t+n)),t)).d&&q((r=k(r,t+5,1)).d,t,o)&&(i=t+10,+A((r=k(H(e.times($(a,i+n)),i),i+5,1)).d).slice(t+1,t+15)+1==1e14&&(r=k(r,t+1,0))),r.s=s,f=!0,l.rounding=o,k(r,t,o))},D.toPrecision=function(e,i){var n,t=this,r=t.constructor;return void 0===e?n=P(t,t.e<=r.toExpNeg||t.e>=r.toExpPos):(C(e,1,s),void 0===i?i=r.rounding:C(i,0,8),n=P(t=k(new r(t),e,i),e<=t.e||t.e<=r.toExpNeg,e)),t.isNeg()&&!t.isZero()?"-"+n:n},D.toSignificantDigits=D.toSD=function(e,i){var n=this.constructor;return void 0===e?(e=n.precision,i=n.rounding):(C(e,1,s),void 0===i?i=n.rounding:C(i,0,8)),k(new n(this),e,i)},D.toString=function(){var e=this,i=e.constructor,n=P(e,e.e<=i.toExpNeg||e.e>=i.toExpPos);return e.isNeg()&&!e.isZero()?"-"+n:n},D.truncated=D.trunc=function(){return k(new this.constructor(this),this.e+1,1)},D.valueOf=D.toJSON=function(){var e=this,i=e.constructor,n=P(e,e.e<=i.toExpNeg||e.e>=i.toExpPos);return e.isNeg()?"-"+n:n};var I=function(){function e(e,i,n){var t,r=0,o=e.length;for(e=e.slice();o--;)t=e[o]*i+r,e[o]=t%n|0,r=t/n|0;return r&&e.unshift(r),e}function i(e,i,n,t){var r,o;if(n!=t)o=n>t?1:-1;else for(r=o=0;r<n;r++)if(e[r]!=i[r]){o=e[r]>i[r]?1:-1;break}return o}function t(e,i,n,t){for(var r=0;n--;)e[n]-=r,r=e[n]<i[n]?1:0,e[n]=r*t+e[n]-i[n];for(;!e[0]&&e.length>1;)e.shift();}return function(r,o,s,a,l,u){var c,m,f,h,p,g,d,x,y,b,N,w,M,E,D,A,C,q,F,I,P=r.constructor,T=r.s==o.s?1:-1,O=r.d,z=o.d;if(!(O&&O[0]&&z&&z[0]))return new P(r.s&&o.s&&(O?!z||O[0]!=z[0]:z)?O&&0==O[0]||!z?0*T:T/0:NaN);for(u?(p=1,m=r.e-o.e):(u=S,p=7,m=v(r.e/p)-v(o.e/p)),F=z.length,C=O.length,b=(y=new P(T)).d=[],f=0;z[f]==(O[f]||0);f++);if(z[f]>(O[f]||0)&&m--,null==s?(E=s=P.precision,a=P.rounding):E=l?s+(r.e-o.e)+1:s,E<0)b.push(1),g=!0;else {if(E=E/p+2|0,f=0,1==F){for(h=0,z=z[0],E++;(f<C||h)&&E--;f++)D=h*u+(O[f]||0),b[f]=D/z|0,h=D%z|0;g=h||f<C;}else {for((h=u/(z[0]+1)|0)>1&&(z=e(z,h,u),O=e(O,h,u),F=z.length,C=O.length),A=F,w=(N=O.slice(0,F)).length;w<F;)N[w++]=0;(I=z.slice()).unshift(0),q=z[0],z[1]>=u/2&&++q;do{h=0,(c=i(z,N,F,w))<0?(M=N[0],F!=w&&(M=M*u+(N[1]||0)),(h=M/q|0)>1?(h>=u&&(h=u-1),1==(c=i(d=e(z,h,u),N,x=d.length,w=N.length))&&(h--,t(d,F<x?I:z,x,u))):(0==h&&(c=h=1),d=z.slice()),(x=d.length)<w&&d.unshift(0),t(N,d,w,u),-1==c&&(c=i(z,N,F,w=N.length))<1&&(h++,t(N,F<w?I:z,w,u)),w=N.length):0===c&&(h++,N=[0]),b[f++]=h,c&&N[0]?N[w++]=O[A]||0:(N=[O[A]],w=1);}while((A++<C||void 0!==N[0])&&E--);g=void 0!==N[0];}b[0]||b.shift();}if(1==p)y.e=m,n=g;else {for(f=1,h=b[0];h>=10;h/=10)f++;y.e=f+m*p-1,k(y,l?s+y.e+1:s,a,g);}return y}}();function k(e,i,n,t){var r,o,s,a,l,u,c,m,h,p=e.constructor;e:if(null!=i){if(!(m=e.d))return e;for(r=1,a=m[0];a>=10;a/=10)r++;if((o=i-r)<0)o+=7,s=i,l=(c=m[h=0])/x(10,r-s-1)%10|0;else if((h=Math.ceil((o+1)/7))>=(a=m.length)){if(!t)break e;for(;a++<=h;)m.push(0);c=l=0,r=1,s=(o%=7)-7+1;}else {for(c=a=m[h],r=1;a>=10;a/=10)r++;l=(s=(o%=7)-7+r)<0?0:c/x(10,r-s-1)%10|0;}if(t=t||i<0||void 0!==m[h+1]||(s<0?c:c%x(10,r-s-1)),u=n<4?(l||t)&&(0==n||n==(e.s<0?3:2)):l>5||5==l&&(4==n||t||6==n&&(o>0?s>0?c/x(10,r-s):0:m[h-1])%10&1||n==(e.s<0?8:7)),i<1||!m[0])return m.length=0,u?(i-=e.e+1,m[0]=x(10,(7-i%7)%7),e.e=-i||0):m[0]=e.e=0,e;if(0==o?(m.length=h,a=1,h--):(m.length=h+1,a=x(10,7-o),m[h]=s>0?(c/x(10,r-s)%x(10,s)|0)*a:0),u)for(;;){if(0==h){for(o=1,s=m[0];s>=10;s/=10)o++;for(s=m[0]+=a,a=1;s>=10;s/=10)a++;o!=a&&(e.e++,m[0]==S&&(m[0]=1));break}if(m[h]+=a,m[h]!=S)break;m[h--]=0,a=1;}for(o=m.length;0===m[--o];)m.pop();}return f&&(e.e>p.maxE?(e.d=null,e.e=NaN):e.e<p.minE&&(e.e=0,e.d=[0])),e}function P(e,i,n){if(!e.isFinite())return j(e);var t,r=e.e,o=A(e.d),s=o.length;return i?(n&&(t=n-s)>0?o=o.charAt(0)+"."+o.slice(1)+_(t):s>1&&(o=o.charAt(0)+"."+o.slice(1)),o=o+(e.e<0?"e":"e+")+e.e):r<0?(o="0."+_(-r-1)+o,n&&(t=n-s)>0&&(o+=_(t))):r>=s?(o+=_(r+1-s),n&&(t=n-r-1)>0&&(o=o+"."+_(t))):((t=r+1)<s&&(o=o.slice(0,t)+"."+o.slice(t)),n&&(t=n-s)>0&&(r+1===s&&(o+="."),o+=_(t))),o}function T(e,i){var n=e[0];for(i*=7;n>=10;n/=10)i++;return i}function O(e,i,n){if(i>M)throw f=!0,n&&(e.precision=n),Error(g);return k(new e(u),i,1,!0)}function z(e,i,n){if(i>E)throw Error(g);return k(new e(c),i,n,!0)}function L(e){var i=e.length-1,n=7*i+1;if(i=e[i]){for(;i%10==0;i/=10)n--;for(i=e[0];i>=10;i/=10)n++;}return n}function _(e){for(var i="";e--;)i+="0";return i}function R(e,i,n,t){var r,o=new e(1),s=Math.ceil(t/7+4);for(f=!1;;){if(n%2&&J((o=o.times(i)).d,s)&&(r=!0),0===(n=v(n/2))){n=o.d.length-1,r&&0===o.d[n]&&++o.d[n];break}J((i=i.times(i)).d,s);}return f=!0,o}function Z(e){return 1&e.d[e.d.length-1]}function Q(e,i,n){for(var t,r=new e(i[0]),o=0;++o<i.length;){if(!(t=new e(i[o])).s){r=t;break}r[n](t)&&(r=t);}return r}function H(e,i){var n,t,r,o,s,a,l,u=0,c=0,m=0,h=e.constructor,p=h.rounding,g=h.precision;if(!e.d||!e.d[0]||e.e>17)return new h(e.d?e.d[0]?e.s<0?0:1/0:1:e.s?e.s<0?0:e:NaN);for(null==i?(f=!1,l=g):l=i,a=new h(.03125);e.e>-2;)e=e.times(a),m+=5;for(l+=t=Math.log(x(2,m))/Math.LN10*2+5|0,n=o=s=new h(1),h.precision=l;;){if(o=k(o.times(e),l,1),n=n.times(++c),A((a=s.plus(I(o,n,l,1))).d).slice(0,l)===A(s.d).slice(0,l)){for(r=m;r--;)s=k(s.times(s),l,1);if(null!=i)return h.precision=g,s;if(!(u<3&&q(s.d,l-t,p,u)))return k(s,h.precision=g,p,f=!0);h.precision=l+=10,n=o=a=new h(1),c=0,u++;}s=a;}}function $(e,i){var n,t,r,o,s,a,l,u,c,m,h,p=1,g=e,d=g.d,v=g.constructor,x=v.rounding,y=v.precision;if(g.s<0||!d||!d[0]||!g.e&&1==d[0]&&1==d.length)return new v(d&&!d[0]?-1/0:1!=g.s?NaN:d?0:g);if(null==i?(f=!1,c=y):c=i,v.precision=c+=10,t=(n=A(d)).charAt(0),!(Math.abs(o=g.e)<15e14))return u=O(v,c+2,y).times(o+""),g=$(new v(t+"."+n.slice(1)),c-10).plus(u),v.precision=y,null==i?k(g,y,x,f=!0):g;for(;t<7&&1!=t||1==t&&n.charAt(1)>3;)t=(n=A((g=g.times(e)).d)).charAt(0),p++;for(o=g.e,t>1?(g=new v("0."+n),o++):g=new v(t+"."+n.slice(1)),m=g,l=s=g=I(g.minus(1),g.plus(1),c,1),h=k(g.times(g),c,1),r=3;;){if(s=k(s.times(h),c,1),A((u=l.plus(I(s,new v(r),c,1))).d).slice(0,c)===A(l.d).slice(0,c)){if(l=l.times(2),0!==o&&(l=l.plus(O(v,c+2,y).times(o+""))),l=I(l,new v(p),c,1),null!=i)return v.precision=y,l;if(!q(l.d,c-10,x,a))return k(l,v.precision=y,x,f=!0);v.precision=c+=10,u=s=g=I(m.minus(1),m.plus(1),c,1),h=k(g.times(g),c,1),r=a=1;}l=u,r+=2;}}function j(e){return String(e.s*e.s/0)}function B(e,i){var n,t,r;for((n=i.indexOf("."))>-1&&(i=i.replace(".","")),(t=i.search(/e/i))>0?(n<0&&(n=t),n+=+i.slice(t+1),i=i.substring(0,t)):n<0&&(n=i.length),t=0;48===i.charCodeAt(t);t++);for(r=i.length;48===i.charCodeAt(r-1);--r);if(i=i.slice(t,r)){if(r-=t,e.e=n=n-t-1,e.d=[],t=(n+1)%7,n<0&&(t+=7),t<r){for(t&&e.d.push(+i.slice(0,t)),r-=7;t<r;)e.d.push(+i.slice(t,t+=7));t=7-(i=i.slice(t)).length;}else t-=r;for(;t--;)i+="0";e.d.push(+i),f&&(e.e>e.constructor.maxE?(e.d=null,e.e=NaN):e.e<e.constructor.minE&&(e.e=0,e.d=[0]));}else e.e=0,e.d=[0];return e}function U(e,n){var t,r,o,s,a,l,u,c,m;if("Infinity"===n||"NaN"===n)return +n||(e.s=NaN),e.e=NaN,e.d=null,e;if(b.test(n))t=16,n=n.toLowerCase();else if(y.test(n))t=2;else {if(!N.test(n))throw Error(p+n);t=8;}for((s=n.search(/p/i))>0?(u=+n.slice(s+1),n=n.substring(2,s)):n=n.slice(2),a=(s=n.indexOf("."))>=0,r=e.constructor,a&&(s=(l=(n=n.replace(".","")).length)-s,o=R(r,new r(t),s,2*s)),s=m=(c=F(n,t,S)).length-1;0===c[s];--s)c.pop();return s<0?new r(0*e.s):(e.e=T(c,m),e.d=c,f=!1,a&&(e=I(e,o,4*l)),u&&(e=e.times(Math.abs(u)<54?x(2,u):i.pow(2,u))),f=!0,e)}function G(e,i,n,t,r){var o,s,a,l,u=e.precision,c=Math.ceil(u/7);for(f=!1,l=n.times(n),a=new e(t);;){if(s=I(a.times(l),new e(i++*i++),u,1),a=r?t.plus(s):t.minus(s),t=I(s.times(l),new e(i++*i++),u,1),void 0!==(s=a.plus(t)).d[c]){for(o=c;s.d[o]===a.d[o]&&o--;);if(-1==o)break}o=a,a=t,t=s,s=o;}return f=!0,s.d.length=c+1,s}function W(e,i){for(var n=e;--i;)n*=e;return n}function V(e,i){var n,t=i.s<0,o=z(e,e.precision,1),s=o.times(.5);if((i=i.abs()).lte(s))return r=t?4:1,i;if((n=i.divToInt(o)).isZero())r=t?3:2;else {if((i=i.minus(n.times(o))).lte(s))return r=Z(n)?t?2:3:t?4:1,i;r=Z(n)?t?1:4:t?3:2;}return i.minus(o).abs()}function Y(e,i,t,r){var o,l,u,c,m,f,h,p,g,d=e.constructor,v=void 0!==t;if(v?(C(t,1,s),void 0===r?r=d.rounding:C(r,0,8)):(t=d.precision,r=d.rounding),e.isFinite()){for(v?(o=2,16==i?t=4*t-3:8==i&&(t=3*t-2)):o=i,(u=(h=P(e)).indexOf("."))>=0&&(h=h.replace(".",""),(g=new d(1)).e=h.length-u,g.d=F(P(g),10,o),g.e=g.d.length),l=m=(p=F(h,10,o)).length;0==p[--m];)p.pop();if(p[0]){if(u<0?l--:((e=new d(e)).d=p,e.e=l,p=(e=I(e,g,t,r,0,o)).d,l=e.e,f=n),u=p[t],c=o/2,f=f||void 0!==p[t+1],f=r<4?(void 0!==u||f)&&(0===r||r===(e.s<0?3:2)):u>c||u===c&&(4===r||f||6===r&&1&p[t-1]||r===(e.s<0?8:7)),p.length=t,f)for(;++p[--t]>o-1;)p[t]=0,t||(++l,p.unshift(1));for(m=p.length;!p[m-1];--m);for(u=0,h="";u<m;u++)h+=a.charAt(p[u]);if(v){if(m>1)if(16==i||8==i){for(u=16==i?4:3,--m;m%u;m++)h+="0";for(m=(p=F(h,o,i)).length;!p[m-1];--m);for(u=1,h="1.";u<m;u++)h+=a.charAt(p[u]);}else h=h.charAt(0)+"."+h.slice(1);h=h+(l<0?"p":"p+")+l;}else if(l<0){for(;++l;)h="0"+h;h="0."+h;}else if(++l>m)for(l-=m;l--;)h+="0";else l<m&&(h=h.slice(0,l)+"."+h.slice(l));}else h=v?"0p+0":"0";h=(16==i?"0x":2==i?"0b":8==i?"0o":"")+h;}else h=j(e);return e.s<0?"-"+h:h}function J(e,i){if(e.length>i)return e.length=i,!0}function X(e){return new this(e).abs()}function K(e){return new this(e).acos()}function ee(e){return new this(e).acosh()}function ie(e,i){return new this(e).plus(i)}function ne(e){return new this(e).asin()}function te(e){return new this(e).asinh()}function re(e){return new this(e).atan()}function oe(e){return new this(e).atanh()}function se(e,i){e=new this(e),i=new this(i);var n,t=this.precision,r=this.rounding,o=t+4;return e.s&&i.s?e.d||i.d?!i.d||e.isZero()?(n=i.s<0?z(this,t,r):new this(0)).s=e.s:!e.d||i.isZero()?(n=z(this,o,1).times(.5)).s=e.s:i.s<0?(this.precision=o,this.rounding=1,n=this.atan(I(e,i,o,1)),i=z(this,o,1),this.precision=t,this.rounding=r,n=e.s<0?n.minus(i):n.plus(i)):n=this.atan(I(e,i,o,1)):(n=z(this,o,1).times(i.s>0?.25:.75)).s=e.s:n=new this(NaN),n}function ae(e){return new this(e).cbrt()}function le(e){return k(e=new this(e),e.e+1,2)}function ue(e){if(!e||"object"!=typeof e)throw Error(h+"Object expected");var i,n,t,r=!0===e.defaults,a=["precision",1,s,"rounding",0,8,"toExpNeg",-o,0,"toExpPos",0,o,"maxE",0,o,"minE",-o,0,"modulo",0,9];for(i=0;i<a.length;i+=3)if(n=a[i],r&&(this[n]=m[n]),void 0!==(t=e[n])){if(!(v(t)===t&&t>=a[i+1]&&t<=a[i+2]))throw Error(p+n+": "+t);this[n]=t;}if(n="crypto",r&&(this[n]=m[n]),void 0!==(t=e[n])){if(!0!==t&&!1!==t&&0!==t&&1!==t)throw Error(p+n+": "+t);if(t){if("undefined"==typeof crypto||!crypto||!crypto.getRandomValues&&!crypto.randomBytes)throw Error(d);this[n]=!0;}else this[n]=!1;}return this}function ce(e){return new this(e).cos()}function me(e){return new this(e).cosh()}function fe(e,i){return new this(e).div(i)}function he(e){return new this(e).exp()}function pe(e){return k(e=new this(e),e.e+1,3)}function ge(){var e,i,n=new this(0);for(f=!1,e=0;e<arguments.length;)if((i=new this(arguments[e++])).d)n.d&&(n=n.plus(i.times(i)));else {if(i.s)return f=!0,new this(1/0);n=i;}return f=!0,n.sqrt()}function de(e){return e instanceof i||e&&"[object Decimal]"===e.name||!1}function ve(e){return new this(e).ln()}function xe(e,i){return new this(e).log(i)}function ye(e){return new this(e).log(2)}function be(e){return new this(e).log(10)}function Ne(){return Q(this,arguments,"lt")}function we(){return Q(this,arguments,"gt")}function Se(e,i){return new this(e).mod(i)}function Me(e,i){return new this(e).mul(i)}function Ee(e,i){return new this(e).pow(i)}function De(e){var i,n,t,r,o=0,a=new this(1),l=[];if(void 0===e?e=this.precision:C(e,1,s),t=Math.ceil(e/7),this.crypto)if(crypto.getRandomValues)for(i=crypto.getRandomValues(new Uint32Array(t));o<t;)(r=i[o])>=429e7?i[o]=crypto.getRandomValues(new Uint32Array(1))[0]:l[o++]=r%1e7;else {if(!crypto.randomBytes)throw Error(d);for(i=crypto.randomBytes(t*=4);o<t;)(r=i[o]+(i[o+1]<<8)+(i[o+2]<<16)+((127&i[o+3])<<24))>=214e7?crypto.randomBytes(4).copy(i,o):(l.push(r%1e7),o+=4);o=t/4;}else for(;o<t;)l[o++]=1e7*Math.random()|0;for(e%=7,(t=l[--o])&&e&&(r=x(10,7-e),l[o]=(t/r|0)*r);0===l[o];o--)l.pop();if(o<0)n=0,l=[0];else {for(n=-1;0===l[0];n-=7)l.shift();for(t=1,r=l[0];r>=10;r/=10)t++;t<7&&(n-=7-t);}return a.e=n,a.d=l,a}function Ae(e){return k(e=new this(e),e.e+1,this.rounding)}function Ce(e){return (e=new this(e)).d?e.d[0]?e.s:0*e.s:e.s||NaN}function qe(e){return new this(e).sin()}function Fe(e){return new this(e).sinh()}function Ie(e){return new this(e).sqrt()}function ke(e,i){return new this(e).sub(i)}function Pe(e){return new this(e).tan()}function Te(e){return new this(e).tanh()}function Oe(e){return k(e=new this(e),e.e+1,1)}(i=function e(i){var n,t,r;function o(e){var i,n,t,r=this;if(!(r instanceof o))return new o(e);if(r.constructor=o,e instanceof o)return r.s=e.s,void(f?!e.d||e.e>o.maxE?(r.e=NaN,r.d=null):e.e<o.minE?(r.e=0,r.d=[0]):(r.e=e.e,r.d=e.d.slice()):(r.e=e.e,r.d=e.d?e.d.slice():e.d));if("number"==(t=typeof e)){if(0===e)return r.s=1/e<0?-1:1,r.e=0,void(r.d=[0]);if(e<0?(e=-e,r.s=-1):r.s=1,e===~~e&&e<1e7){for(i=0,n=e;n>=10;n/=10)i++;return void(f?i>o.maxE?(r.e=NaN,r.d=null):i<o.minE?(r.e=0,r.d=[0]):(r.e=i,r.d=[e]):(r.e=i,r.d=[e]))}return 0*e!=0?(e||(r.s=NaN),r.e=NaN,void(r.d=null)):B(r,e.toString())}if("string"!==t)throw Error(p+e);return 45===(n=e.charCodeAt(0))?(e=e.slice(1),r.s=-1):(43===n&&(e=e.slice(1)),r.s=1),w.test(e)?B(r,e):U(r,e)}if(o.prototype=D,o.ROUND_UP=0,o.ROUND_DOWN=1,o.ROUND_CEIL=2,o.ROUND_FLOOR=3,o.ROUND_HALF_UP=4,o.ROUND_HALF_DOWN=5,o.ROUND_HALF_EVEN=6,o.ROUND_HALF_CEIL=7,o.ROUND_HALF_FLOOR=8,o.EUCLID=9,o.config=o.set=ue,o.clone=e,o.isDecimal=de,o.abs=X,o.acos=K,o.acosh=ee,o.add=ie,o.asin=ne,o.asinh=te,o.atan=re,o.atanh=oe,o.atan2=se,o.cbrt=ae,o.ceil=le,o.cos=ce,o.cosh=me,o.div=fe,o.exp=he,o.floor=pe,o.hypot=ge,o.ln=ve,o.log=xe,o.log10=be,o.log2=ye,o.max=Ne,o.min=we,o.mod=Se,o.mul=Me,o.pow=Ee,o.random=De,o.round=Ae,o.sign=Ce,o.sin=qe,o.sinh=Fe,o.sqrt=Ie,o.sub=ke,o.tan=Pe,o.tanh=Te,o.trunc=Oe,void 0===i&&(i={}),i&&!0!==i.defaults)for(r=["precision","rounding","toExpNeg","toExpPos","maxE","minE","modulo","crypto"],n=0;n<r.length;)i.hasOwnProperty(t=r[n++])||(i[t]=this[t]);return o.config(i),o}(m)).default=i.Decimal=i,u=new i(u),c=new i(c),l.exports?("function"==typeof Symbol&&"symbol"==typeof Symbol.iterator&&(D[Symbol.for("nodejs.util.inspect.custom")]=D.toString,D[Symbol.toStringTag]="Decimal"),l.exports=i):(e||(e="undefined"!=typeof self&&self&&self.self==self?self:window),t=e.Decimal,i.noConflict=function(){return e.Decimal=t,i},e.Decimal=i);}(u);var m={exports:{}};
/**
 * @license Complex.js v2.0.13 12/05/2020
 *
 * Copyright (c) 2020, Robert Eisele (robert@xarg.org)
 * Dual licensed under the MIT or GPL Version 2 licenses.
 **/!function(e,i){!function(i){var n=function(e){return .5*(Math.exp(e)+Math.exp(-e))},t=function(e){return .5*(Math.exp(e)-Math.exp(-e))},r=function(){throw SyntaxError("Invalid Param")};function o(e,i){var n=Math.abs(e),t=Math.abs(i);return 0===e?Math.log(t):0===i?Math.log(n):n<3e3&&t<3e3?.5*Math.log(e*e+i*i):Math.log(e/Math.cos(Math.atan2(i,e)))}function s(e,i){if(!(this instanceof s))return new s(e,i);var n=function(e,i){var n={re:0,im:0};if(null==e)n.re=n.im=0;else if(void 0!==i)n.re=e,n.im=i;else switch(typeof e){case"object":if("im"in e&&"re"in e)n.re=e.re,n.im=e.im;else if("abs"in e&&"arg"in e){if(!Number.isFinite(e.abs)&&Number.isFinite(e.arg))return s.INFINITY;n.re=e.abs*Math.cos(e.arg),n.im=e.abs*Math.sin(e.arg);}else if("r"in e&&"phi"in e){if(!Number.isFinite(e.r)&&Number.isFinite(e.phi))return s.INFINITY;n.re=e.r*Math.cos(e.phi),n.im=e.r*Math.sin(e.phi);}else 2===e.length?(n.re=e[0],n.im=e[1]):r();break;case"string":n.im=n.re=0;var t=e.match(/\d+\.?\d*e[+-]?\d+|\d+\.?\d*|\.\d+|./g),o=1,a=0;null===t&&r();for(var l=0;l<t.length;l++){var u=t[l];" "===u||"\t"===u||"\n"===u||("+"===u?o++:"-"===u?a++:"i"===u||"I"===u?(o+a===0&&r()," "===t[l+1]||isNaN(t[l+1])?n.im+=parseFloat((a%2?"-":"")+"1"):(n.im+=parseFloat((a%2?"-":"")+t[l+1]),l++),o=a=0):((o+a===0||isNaN(u))&&r(),"i"===t[l+1]||"I"===t[l+1]?(n.im+=parseFloat((a%2?"-":"")+u),l++):n.re+=parseFloat((a%2?"-":"")+u),o=a=0));}o+a>0&&r();break;case"number":n.im=0,n.re=e;break;default:r();}return isNaN(n.re)||isNaN(n.im),n}(e,i);this.re=n.re,this.im=n.im;}s.prototype={re:0,im:0,sign:function(){var e=this.abs();return new s(this.re/e,this.im/e)},add:function(e,i){var n=new s(e,i);return this.isInfinite()&&n.isInfinite()?s.NAN:this.isInfinite()||n.isInfinite()?s.INFINITY:new s(this.re+n.re,this.im+n.im)},sub:function(e,i){var n=new s(e,i);return this.isInfinite()&&n.isInfinite()?s.NAN:this.isInfinite()||n.isInfinite()?s.INFINITY:new s(this.re-n.re,this.im-n.im)},mul:function(e,i){var n=new s(e,i);return this.isInfinite()&&n.isZero()||this.isZero()&&n.isInfinite()?s.NAN:this.isInfinite()||n.isInfinite()?s.INFINITY:0===n.im&&0===this.im?new s(this.re*n.re,0):new s(this.re*n.re-this.im*n.im,this.re*n.im+this.im*n.re)},div:function(e,i){var n=new s(e,i);if(this.isZero()&&n.isZero()||this.isInfinite()&&n.isInfinite())return s.NAN;if(this.isInfinite()||n.isZero())return s.INFINITY;if(this.isZero()||n.isInfinite())return s.ZERO;e=this.re,i=this.im;var t,r,o=n.re,a=n.im;return 0===a?new s(e/o,i/o):Math.abs(o)<Math.abs(a)?new s((e*(r=o/a)+i)/(t=o*r+a),(i*r-e)/t):new s((e+i*(r=a/o))/(t=a*r+o),(i-e*r)/t)},pow:function(e,i){var n=new s(e,i);if(e=this.re,i=this.im,n.isZero())return s.ONE;if(0===n.im){if(0===i&&e>0)return new s(Math.pow(e,n.re),0);if(0===e)switch((n.re%4+4)%4){case 0:return new s(Math.pow(i,n.re),0);case 1:return new s(0,Math.pow(i,n.re));case 2:return new s(-Math.pow(i,n.re),0);case 3:return new s(0,-Math.pow(i,n.re))}}if(0===e&&0===i&&n.re>0&&n.im>=0)return s.ZERO;var t=Math.atan2(i,e),r=o(e,i);return e=Math.exp(n.re*r-n.im*t),i=n.im*r+n.re*t,new s(e*Math.cos(i),e*Math.sin(i))},sqrt:function(){var e,i,n=this.re,t=this.im,r=this.abs();if(n>=0){if(0===t)return new s(Math.sqrt(n),0);e=.5*Math.sqrt(2*(r+n));}else e=Math.abs(t)/Math.sqrt(2*(r-n));return i=n<=0?.5*Math.sqrt(2*(r-n)):Math.abs(t)/Math.sqrt(2*(r+n)),new s(e,t<0?-i:i)},exp:function(){var e=Math.exp(this.re);return this.im,new s(e*Math.cos(this.im),e*Math.sin(this.im))},expm1:function(){var e=this.re,i=this.im;return new s(Math.expm1(e)*Math.cos(i)+function(e){var i=Math.PI/4;if(e<-i||e>i)return Math.cos(e)-1;var n=e*e;return n*(n*(1/24+n*(-1/720+n*(1/40320+n*(-1/3628800+n*(1/4790014600+n*(-1/87178291200+n*(1/20922789888e3)))))))-.5)}(i),Math.exp(e)*Math.sin(i))},log:function(){var e=this.re,i=this.im;return new s(o(e,i),Math.atan2(i,e))},abs:function(){return e=this.re,i=this.im,n=Math.abs(e),t=Math.abs(i),n<3e3&&t<3e3?Math.sqrt(n*n+t*t):(n<t?(n=t,t=e/i):t=i/e,n*Math.sqrt(1+t*t));var e,i,n,t;},arg:function(){return Math.atan2(this.im,this.re)},sin:function(){var e=this.re,i=this.im;return new s(Math.sin(e)*n(i),Math.cos(e)*t(i))},cos:function(){var e=this.re,i=this.im;return new s(Math.cos(e)*n(i),-Math.sin(e)*t(i))},tan:function(){var e=2*this.re,i=2*this.im,r=Math.cos(e)+n(i);return new s(Math.sin(e)/r,t(i)/r)},cot:function(){var e=2*this.re,i=2*this.im,r=Math.cos(e)-n(i);return new s(-Math.sin(e)/r,t(i)/r)},sec:function(){var e=this.re,i=this.im,r=.5*n(2*i)+.5*Math.cos(2*e);return new s(Math.cos(e)*n(i)/r,Math.sin(e)*t(i)/r)},csc:function(){var e=this.re,i=this.im,r=.5*n(2*i)-.5*Math.cos(2*e);return new s(Math.sin(e)*n(i)/r,-Math.cos(e)*t(i)/r)},asin:function(){var e=this.re,i=this.im,n=new s(i*i-e*e+1,-2*e*i).sqrt(),t=new s(n.re-i,n.im+e).log();return new s(t.im,-t.re)},acos:function(){var e=this.re,i=this.im,n=new s(i*i-e*e+1,-2*e*i).sqrt(),t=new s(n.re-i,n.im+e).log();return new s(Math.PI/2-t.im,t.re)},atan:function(){var e=this.re,i=this.im;if(0===e){if(1===i)return new s(0,1/0);if(-1===i)return new s(0,-1/0)}var n=e*e+(1-i)*(1-i),t=new s((1-i*i-e*e)/n,-2*e/n).log();return new s(-.5*t.im,.5*t.re)},acot:function(){var e=this.re,i=this.im;if(0===i)return new s(Math.atan2(1,e),0);var n=e*e+i*i;return 0!==n?new s(e/n,-i/n).atan():new s(0!==e?e/0:0,0!==i?-i/0:0).atan()},asec:function(){var e=this.re,i=this.im;if(0===e&&0===i)return new s(0,1/0);var n=e*e+i*i;return 0!==n?new s(e/n,-i/n).acos():new s(0!==e?e/0:0,0!==i?-i/0:0).acos()},acsc:function(){var e=this.re,i=this.im;if(0===e&&0===i)return new s(Math.PI/2,1/0);var n=e*e+i*i;return 0!==n?new s(e/n,-i/n).asin():new s(0!==e?e/0:0,0!==i?-i/0:0).asin()},sinh:function(){var e=this.re,i=this.im;return new s(t(e)*Math.cos(i),n(e)*Math.sin(i))},cosh:function(){var e=this.re,i=this.im;return new s(n(e)*Math.cos(i),t(e)*Math.sin(i))},tanh:function(){var e=2*this.re,i=2*this.im,r=n(e)+Math.cos(i);return new s(t(e)/r,Math.sin(i)/r)},coth:function(){var e=2*this.re,i=2*this.im,r=n(e)-Math.cos(i);return new s(t(e)/r,-Math.sin(i)/r)},csch:function(){var e=this.re,i=this.im,r=Math.cos(2*i)-n(2*e);return new s(-2*t(e)*Math.cos(i)/r,2*n(e)*Math.sin(i)/r)},sech:function(){var e=this.re,i=this.im,r=Math.cos(2*i)+n(2*e);return new s(2*n(e)*Math.cos(i)/r,-2*t(e)*Math.sin(i)/r)},asinh:function(){var e=this.im;this.im=-this.re,this.re=e;var i=this.asin();return this.re=-this.im,this.im=e,e=i.re,i.re=-i.im,i.im=e,i},acosh:function(){var e=this.acos();if(e.im<=0){var i=e.re;e.re=-e.im,e.im=i;}else i=e.im,e.im=-e.re,e.re=i;return e},atanh:function(){var e=this.re,i=this.im,n=e>1&&0===i,t=1-e,r=1+e,a=t*t+i*i,l=0!==a?new s((r*t-i*i)/a,(i*t+r*i)/a):new s(-1!==e?e/0:0,0!==i?i/0:0),u=l.re;return l.re=o(l.re,l.im)/2,l.im=Math.atan2(l.im,u)/2,n&&(l.im=-l.im),l},acoth:function(){var e=this.re,i=this.im;if(0===e&&0===i)return new s(0,Math.PI/2);var n=e*e+i*i;return 0!==n?new s(e/n,-i/n).atanh():new s(0!==e?e/0:0,0!==i?-i/0:0).atanh()},acsch:function(){var e=this.re,i=this.im;if(0===i)return new s(0!==e?Math.log(e+Math.sqrt(e*e+1)):1/0,0);var n=e*e+i*i;return 0!==n?new s(e/n,-i/n).asinh():new s(0!==e?e/0:0,0!==i?-i/0:0).asinh()},asech:function(){var e=this.re,i=this.im;if(this.isZero())return s.INFINITY;var n=e*e+i*i;return 0!==n?new s(e/n,-i/n).acosh():new s(0!==e?e/0:0,0!==i?-i/0:0).acosh()},inverse:function(){if(this.isZero())return s.INFINITY;if(this.isInfinite())return s.ZERO;var e=this.re,i=this.im,n=e*e+i*i;return new s(e/n,-i/n)},conjugate:function(){return new s(this.re,-this.im)},neg:function(){return new s(-this.re,-this.im)},ceil:function(e){return e=Math.pow(10,e||0),new s(Math.ceil(this.re*e)/e,Math.ceil(this.im*e)/e)},floor:function(e){return e=Math.pow(10,e||0),new s(Math.floor(this.re*e)/e,Math.floor(this.im*e)/e)},round:function(e){return e=Math.pow(10,e||0),new s(Math.round(this.re*e)/e,Math.round(this.im*e)/e)},equals:function(e,i){var n=new s(e,i);return Math.abs(n.re-this.re)<=s.EPSILON&&Math.abs(n.im-this.im)<=s.EPSILON},clone:function(){return new s(this.re,this.im)},toString:function(){var e=this.re,i=this.im,n="";return this.isNaN()?"NaN":this.isInfinite()?"Infinity":(Math.abs(e)<s.EPSILON&&(e=0),Math.abs(i)<s.EPSILON&&(i=0),0===i?n+e:(0!==e?(n+=e,n+=" ",i<0?(i=-i,n+="-"):n+="+",n+=" "):i<0&&(i=-i,n+="-"),1!==i&&(n+=i),n+"i"))},toVector:function(){return [this.re,this.im]},valueOf:function(){return 0===this.im?this.re:null},isNaN:function(){return isNaN(this.re)||isNaN(this.im)},isZero:function(){return 0===this.im&&0===this.re},isFinite:function(){return isFinite(this.re)&&isFinite(this.im)},isInfinite:function(){return !(this.isNaN()||this.isFinite())}},s.ZERO=new s(0,0),s.ONE=new s(1,0),s.I=new s(0,1),s.PI=new s(Math.PI,0),s.E=new s(Math.E,0),s.INFINITY=new s(1/0,1/0),s.NAN=new s(NaN,NaN),s.EPSILON=1e-15,Object.defineProperty(s,"__esModule",{value:!0}),s.default=s,s.Complex=s,e.exports=s;}();}(m);const f=new c.exports.Decimal(0),h=new c.exports.Decimal(1),p=new c.exports.Decimal(-1),g=new c.exports.Decimal(NaN),d=new c.exports.Decimal(1/0),v=new c.exports.Decimal(-1/0);function x(e){if("number"==typeof e&&(e=new c.exports.Decimal(e)),!e.isInteger()||e.isNegative())return g;if(e.lessThan(10))return new c.exports.Decimal([1,1,2,6,24,120,720,5040,40320,362880,3628800][e.toNumber()]);if(e.gt(Number.MAX_SAFE_INTEGER)){let i=h,n=new c.exports.Decimal(2);for(;n.lessThan(e);)i=i.mul(n),n=n.add(1);return i}if(e.modulo(2).eq(1))return e.times(x(e.minus(1)));let i=e.toNumber(),n=e.toNumber(),t=e;for(;i>2;)i-=2,n+=i,t=t.mul(n);return t}const y=[.9999999999998099,676.5203681218851,-1259.1392167224028,771.3234287776531,-176.6150291621406,12.507343278686905,-.13857109526572012,9984369578019572e-21,1.5056327351493116e-7].map((e=>new c.exports.Decimal(e))),b=new c.exports.Decimal(607).div(128),N=[.9999999999999971,57.15623566586292,-59.59796035547549,14.136097974741746,-.4919138160976202,3399464998481189e-20,4652362892704858e-20,-9837447530487956e-20,.0001580887032249125,-.00021026444172410488,.00021743961811521265,-.0001643181065367639,8441822398385275e-20,-26190838401581408e-21,36899182659531625e-22].map((e=>new c.exports.Decimal(e)));function w(e){if("number"==typeof e&&(e=new c.exports.Decimal(e)),e.isNegative())return g;let i=N[0];for(let n=N.length-1;n>0;--n)i=i.add(N[n].div(e.add(n)));const n=e.add(b).add(.5);return c.exports.Decimal.acos(-1).mul(2).log().mul(.5).add(n.log().mul(e.add(.5)).minus(n).add(i.log()).minus(e.log()))}function S(e){if("number"==typeof e&&(e=new c.exports.Decimal(e)),e.lessThan(.5)){const i=c.exports.Decimal.acos(-1);return i.div(i.mul(e).sin().mul(S(c.exports.Decimal.sub(1,e))))}if(e.greaterThan(100))return w(e).exp();{e=e.sub(1);let i=y[0];for(let n=1;n<9;n++)i=i.add(y[n].div(e.add(n)));const n=e.add(7).add(.5);return c.exports.Decimal.acos(-1).times(2).sqrt().mul(i.mul(n.neg().exp()).mul(c.exports.Decimal.pow(n,e.add(.5))))}}const E=Math.pow(10,-10);function A(e,i){if(!Number.isInteger(e)||!Number.isInteger(i))return NaN;for(;0!==i;)[e,i]=[i,e%i];return e<0?-e:e}const C=[.9999999999998099,676.5203681218851,-1259.1392167224028,771.3234287776531,-176.6150291621406,12.507343278686905,-.13857109526572012,9984369578019572e-21,1.5056327351493116e-7],q=[.9999999999999971,57.15623566586292,-59.59796035547549,14.136097974741746,-.4919138160976202,3399464998481189e-20,4652362892704858e-20,-9837447530487956e-20,.0001580887032249125,-.00021026444172410488,.00021743961811521265,-.0001643181065367639,8441822398385275e-20,-26190838401581408e-21,36899182659531625e-22];function F(e){if(e<0)return NaN;let i=q[0];for(let n=q.length-1;n>0;--n)i+=q[n]/(e+n);const n=e+4.7421875+.5;return .5*Math.log(2*Math.PI)+(e+.5)*Math.log(n)-n+Math.log(i)-Math.log(e)}function I(e){if(e<.5)return Math.PI/(Math.sin(Math.PI*e)*I(1-e));if(e>100)return Math.exp(F(e));{e-=1;let i=C[0];for(let n=1;n<9;n++)i+=C[n]/(e+n);const n=e+7+.5;return Math.sqrt(2*Math.PI)*Math.pow(n,e+.5)*Math.exp(-n)*i}}const k="List",P="Missing",T="Nothing",O="Add",z="Divide",L="Multiply",_="Negate",R="Power",Z="Root",Q="Sqrt";function H(e){return null!==e&&"object"==typeof e&&"num"in e}function $(e){return null!==e&&"object"==typeof e&&"sym"in e}function B(e){return null!==e&&"object"==typeof e&&"fn"in e}function G(e){if("number"==typeof e)return e;if(null===e)return null;if(H(e))return e.num.endsWith("d")||e.num.endsWith("n")?null:parseFloat(e.num);const i=re(e);return null===i?null:"NaN"===i?NaN:"+Infinity"===i?1/0:"-Infinity"===i?-1/0:"Complex"===te(e)&&0===G(le(e,2))?G(le(e,1)):null}function W(e){if(null===e)return null;if(e instanceof m.exports.Complex)return e;const i=re(e);if(null!==i){if("ComplexInfinity"===i)return m.exports.Complex.INFINITY;if("ImaginaryUnit"===i)return m.exports.Complex.I}const n=te(e);if("Complex"===n){const i=G(le(e,1)),n=G(le(e,2));return null===i||null===n?null:new m.exports.Complex(i,n)}let t=V(e);if(null!==t)return new m.exports.Complex(0,t);if("Add"===n&&2===ue(e)){let i=G(le(e,1));if(null!==i?t=V(le(e,2)):(t=V(le(e,1)),null!==t&&(i=G(le(e,2)))),null!==i&&null!==t)return new m.exports.Complex(i,t)}if("Subtract"===n){const i=G(le(e,1)),n=le(e,2);if(null!==i){if("ImaginaryUnit"===re(n))return new m.exports.Complex(i,-1);if("Multiply"===te(n)&&"ImaginaryUnit"===le(n,2)){const e=G(le(n,1));if(null!==e)return new m.exports.Complex(i,-e)}}}if("Multiply"===n&&2===ue(e)){let i=null;if("ImaginaryUnit"===re(le(e,2))?i=G(le(e,2)):"ImaginaryUnit"===re(le(e,1))&&(i=G(le(e,1))),null!==i&&Number.isInteger(i))return 0===i?m.exports.Complex.ZERO:1===i?m.exports.Complex.ONE:-1===i?m.exports.Complex.ONE.neg():new m.exports.Complex(0,i)}if("Negate"===n){const i=W(le(e,1));if(null!==i)return i.neg()}return null}function V(e){if("ImaginaryUnit"===re(e))return 1;let i=null;const n=te(e);return "Multiply"===n&&2===ue(e)?"ImaginaryUnit"===re(le(e,1))?i=G(le(e,2)):"ImaginaryUnit"===re(le(e,2))&&(i=G(le(e,1))):"Negate"===n&&1===ue(e)&&"ImaginaryUnit"===re(le(e,1))&&(i=-1),0===i?null:i}function Y(e){var i,n;if(e instanceof c.exports.Decimal)return e;const t=re(e);if(null!==t){if("NaN"===t)return g;if("+Infinity"===t)return d;if("-Infinity"===t)return v}if(H(e))return e.num.endsWith("d")||e.num.endsWith("n")?new c.exports.Decimal(e.num.slice(0,-1)):new c.exports.Decimal(null!==(i=G(e))&&void 0!==i?i:NaN);if(null!==e&&e instanceof m.exports.Complex){const i=e;return 0===i.im?new c.exports.Decimal(i.re):null}return "Complex"===te(e)&&0===G(le(e,2))?new c.exports.Decimal(null!==(n=G(le(e,1)))&&void 0!==n?n:NaN):null}function J(e){return null===e?null:"object"==typeof e&&"str"in e?e.str:"string"!=typeof e||e.length<2||"'"!==e[0]||"'"!==e[e.length-1]?null:e.substring(1,e.length-1)}function X(e){var i,n,t,r,o,s;const a=re(e);if("ThreeQuarter"===a)return [3,4];if("TwoThird"===a)return [2,3];if("Half"===a)return [1,2];if("Third"===a)return [1,3];if("Quarter"===a)return [1,4];if(ne(e))return [null,null];const l=te(e);if(!l)return [null,null];let u=null,c=null;if(l===R){const t=G(le(e,2));1===t?(u=null!==(i=G(le(e,1)))&&void 0!==i?i:null,c=1):-1===t&&(u=1,c=null!==(n=G(le(e,1)))&&void 0!==n?n:null);}return l===z&&(u=null!==(t=G(le(e,1)))&&void 0!==t?t:null,c=null!==(r=G(le(e,2)))&&void 0!==r?r:null),l===L&&te(le(e,2))===R&&-1===G(le(le(e,2),2))&&(u=null!==(o=G(le(e,1)))&&void 0!==o?o:null,c=null!==(s=G(le(le(e,2),1)))&&void 0!==s?s:null),null===u||null===c?[null,null]:Number.isInteger(u)&&Number.isInteger(c)?[u,c]:[null,null]}function ie(e){return null===e?null:Array.isArray(e)?e[0]:B(e)?e.fn[0]:null}function ne(e){return null===e||!Array.isArray(e)&&("object"!=typeof e||!("fn"in e||"dic"in e))}function te(e){if(null===e)return "";const i=ie(e);return "string"==typeof i?i:""}function re(e){return null===e?null:"string"==typeof e?e.length>=2&&"'"===e[0]&&"'"===e[e.length-1]?null:e:$(e)?e.sym:null}function oe(e){return Array.isArray(e)?e.slice(1):B(e)?e.fn.slice(1):[]}function se(e,i){const n=ie(e);if(null!==n)return [i(n),...oe(e).map(i)];const t=ce(e);if(null!==t){const e=Object.keys(t),n={};for(const r of e)n[r]=i(t[r]);return {dict:n}}return i(e)}function ae(e,i){let n=null;if(Array.isArray(e)&&(n=e),B(e)&&(n=e.fn),null===n)return [];let t=1;const r=[];for(;t<n.length;)r.push(i(n[t])),t+=1;return r}function le(e,i){var n,t;return null===e?null:Array.isArray(e)?null!==(n=e[i])&&void 0!==n?n:null:B(e)&&null!==(t=e.fn[i])&&void 0!==t?t:null}function ue(e){return Array.isArray(e)?Math.max(0,e.length-1):B(e)?Math.max(0,e.fn.length-1):0}function ce(e){return "object"==typeof e&&"dict"in e?e.dict:null}const fe=[{name:"Overscript",trigger:{infix:"\\overset"},precedence:700},{name:"Underscript",trigger:{infix:"\\underset"},precedence:700},{name:"Increment",trigger:{postfix:["+","+"]},precedence:880},{name:"Decrement",trigger:{postfix:["-","-"]},precedence:880},{name:"PreIncrement",trigger:{prefix:["+","+"]},precedence:880},{name:"PreDecrement",trigger:{prefix:["-","-"]},precedence:880},{name:"Ring",trigger:{infix:"\\circ"},precedence:265},{name:"Transpose",trigger:{superfix:"T"}},{name:"ConjugateTranspose",trigger:{superfix:"H"}},{name:"StringJoin",trigger:{infix:["\\lt","\\gt"]},precedence:780},{name:"Starstar",trigger:{infix:["\\star","\\star"]},precedence:780},{name:"PartialDerivative",trigger:{prefix:"\\partial"},parse:(e,i,n)=>{var t,r;let o=!1,s=T,a=T;for(;!o;)i.skipSpace(),i.match("_")?a=i.matchRequiredLatexArgument():i.match("^")?s=i.matchRequiredLatexArgument():o=!0;if("Sequence"===te(a)&&(a=[k,...oe(a)]),!a||!s)return [e,null];let l=null!==(t=i.matchRequiredLatexArgument())&&void 0!==t?t:T;return l!==T&&(l=[l,...null!==(r=i.matchArguments("group"))&&void 0!==r?r:T]),[null,["PartialDerivative",l,a,s]]},serialize:(e,i)=>{let n="\\partial";const t=le(i,1),r=le(i,2),o=le(i,3);return null!==r&&r!==T&&(ie(r)===k?n+="_{"+e.serialize(["Sequence",...oe(r)])+"}":n+="_{"+e.serialize(r)+"}"),null!==o&&o!==T&&(n+="^{"+e.serialize(o)+"}"),null!==t&&t!==T&&(n+=e.serialize(t)),n},precedence:740},{name:"OverBar",trigger:{symbol:"\\overline"},requiredLatexArg:1},{name:"UnderBar",trigger:{symbol:"\\underline"},requiredLatexArg:1},{name:"OverVector",trigger:{symbol:"\\vec"},requiredLatexArg:1},{name:"OverTile",trigger:{symbol:"\\tilde"},requiredLatexArg:1},{name:"OverHat",trigger:{symbol:"\\hat"},requiredLatexArg:1},{name:"OverHat",trigger:{symbol:"\\hat"},requiredLatexArg:1},{name:"OverRightArrow",trigger:{symbol:"\\overrightarrow"},requiredLatexArg:1},{name:"OverLeftArrow",trigger:{symbol:"\\overleftarrow"},requiredLatexArg:1},{name:"OverRightDoubleArrow",trigger:{symbol:"\\Overrightarrow"},requiredLatexArg:1},{name:"OverLeftHarpoon",trigger:{symbol:"\\overleftharpoon"},requiredLatexArg:1},{name:"OverRightHarpoon",trigger:{symbol:"\\overrightharpoon"},requiredLatexArg:1},{name:"OverLeftRightArrow",trigger:{symbol:"\\overleftrightarrow"},requiredLatexArg:1},{name:"OverBrace",trigger:{symbol:"\\overbrace"},requiredLatexArg:1},{name:"OverLineSegment",trigger:{symbol:"\\overlinesegment"},requiredLatexArg:1},{name:"OverGroup",trigger:{symbol:"\\overgroup"},requiredLatexArg:1}];function he(e,i){return i>2?"solidus":"radical"}function pe(e){return "<space>"===e||"\\qquad"===e||"\\quad"===e||"\\enskip"===e||"\\;"===e||"\\,"===e||"\\ "===e||"~"===e}function ge(e,i,n){return (t,r,o)=>{if(o>=i)return [t,null];r.skipSpace(),r.match(n),"Missing"===t&&(t=T);const s=[e,null!=t?t:T];let a=!1;for(;!a;){for(a=!0,r.skipSpace();r.match(n);)s.push(T),r.skipSpace();if(r.atEnd)s.push(T);else {const e=r.matchExpression(i);s.push(null!=e?e:T),a=null===e;}a||(r.skipSpace(),a=!r.match(n));}return [null,s]}}function de(e){return (i,n)=>oe(n).map((e=>i.serialize(e))).join(e)}const ve=[{name:"LatexTokens",serialize:function(e,i){return oe(i).map((i=>{const n=J(i);return null===n?e.serialize(i):"<{>"===n?"{":"<}>"===n?"}":"<$>"===n?"$":"<$$>"===n?"$$":"<space>'"===n?" ":n})).join("")}},{name:"Parentheses",trigger:{matchfix:"("},parse:(e,i,n)=>{var t;const r=i.index;if(!i.match("("))return [e,null];let o=!1,s=!0,a=!1,l=0,u="";for(;!o&&s;){const e=i.next();i.atEnd||")"===e?o=!0:"\\mathtt"===e?(i.match("<{>"),a=!0):pe(e)||(/^[0-9a-zA-Z]$/.test(e)?(l=Math.max(l,parseInt(e,36)),u+=e):s=!1),a&&i.match("<}>");}if(i.skipSpace(),s&&i.match("_")){const n=null!==(t=G(i.matchRequiredLatexArgument()))&&void 0!==t?t:NaN;return !isFinite(n)||n<2||n>36||l>=n?(i.onError({code:"base-out-of-range"}),[e,T]):[e,["BaseForm",parseInt(u,n),n]]}i.index=r;const c=i.matchBalancedExpression("(",")",i.onError);return c?"Sequence"===te(c)?[e,["Parentheses",...oe(c)]]:[e,["Parentheses",c]]:[e,["Parentheses"]]},serialize:(e,i)=>e.wrapString(de(",")(e,i),(e.level,"paren")),separator:",",closeFence:")",precedence:20},{name:k,trigger:{matchfix:"\\lbrack"},separator:",",closeFence:"\\rbrack",precedence:20,parse:(e,i,n)=>{if(null===e){const n=i.matchBalancedExpression("\\lbrack","\\rbrack",i.onError);return n?"Sequence"===te(n)?[e,[k,...oe(n)]]:[e,[k,n]]:[null,[k]]}return [e,null]}},{name:"BaseForm",serialize:(e,i)=>{var n,t;const r=null!==(n=G(le(i,2)))&&void 0!==n?n:NaN;if(isFinite(r)&&r>=2&&r<=36){const e=null!==(t=G(le(i,1)))&&void 0!==t?t:NaN;if(isFinite(e)){let i=Number(e).toString(r),n=0;if(2===r||10===r?n=4:16===r?n=2:r>16&&(n=4),n>0){const e=i;i="";for(let t=0;t<e.length;t++)t>0&&t%n==0&&(i="\\, "+i),i=e[e.length-t-1]+i;}return `(\\mathtt{${i}})_{${r}}`}}return "\\operatorname{BaseForm}("+e.serialize(le(i,1))+", "+e.serialize(le(i,2))+")"}},{name:"Set",trigger:{matchfix:"\\lbrace"},separator:",",closeFence:"\\rbrace",precedence:20},{name:"Sequence",trigger:{infix:","},parse:ge("Sequence",20,","),serialize:de(", "),precedence:20},{name:"Sequence2",trigger:{infix:";"},parse:ge("Sequence2",19,";"),serialize:de("; "),precedence:19},{name:P,trigger:"\\placeholder",serialize:"\\placeholder",requiredLatexArg:1},{name:"Subscript",trigger:{infix:"_"},precedence:720,serialize:(e,i)=>2===ue(i)?e.serialize(le(i,1))+"_{"+e.serialize(le(i,2))+"}":"_{"+e.serialize(le(i,1))+"}",parse:(e,i,n)=>{var t;if(!i.match("_"))return [e,null];const r=null!==(t=i.matchRequiredLatexArgument())&&void 0!==t?t:P;return e?[null,["Subscript",e,r]]:[null,["Subscript",r]]}},{name:"Superplus",trigger:{superfix:"+"}},{name:"Subplus",trigger:{subfix:"+"}},{name:"Superminus",trigger:{superfix:"-"}},{name:"Subminus",trigger:{subfix:"-"}},{name:"Superstar",trigger:{superfix:"*"}},{name:"Superstar",trigger:{superfix:"\\star"}},{name:"Substar",trigger:{subfix:"*"}},{name:"Substar",trigger:{subfix:"\\star"}},{name:"Superdagger",trigger:{superfix:"\\dagger"}},{name:"Superdagger",trigger:{superfix:"\\dag"}},{name:"Prime",trigger:{superfix:"\\prime"},arguments:"group"},{trigger:{superfix:"\\doubleprime"},parse:(e,i)=>[null,["Prime",null!=e?e:T,2]],arguments:"group"},{name:"InverseFunction",serialize:(e,i)=>e.serialize(le(i,1))+"^{-1}"},{name:"Derivative",trigger:"D",parse:(e,i)=>[e,["Derivative",1]],serialize:(e,i)=>{var n;const t=null!==(n=G(le(i,1)))&&void 0!==n?n:NaN;if(!isFinite(t))return "";const r=e.serialize(le(i,2));return 1===t?r+"^{\\prime}":2===t?r+"^{\\doubleprime}":r+"^{("+Number(t).toString()+")}"}},{name:"Piecewise",trigger:{environment:"cases"},parse:(e,i)=>{var n;return [e,["Piecewise",null!==(n=i.matchTabular())&&void 0!==n?n:T]]},serialize:(e,i)=>{if(te(le(i,1))!==k)return "";const n=oe(le(i,1));let t="",r="";for(const i of n){t+=r;const n=le(i,1);if(null!==n){t+=e.serialize(n);const r=le(i,2);null!==r&&(t+="&"+e.serialize(r));}r="\\\\";}return "\\begin{cases}"+t+"\\end{cases}"}}];function xe(e,i){const n=G(i);return null!==n?0===n:!!e.is(["Equal",i,0])||!0!==e.is(["NotEqual",i,0])&&!0!==e.is(["Greater",i,0])&&!0!==e.is(["Less",i,0])&&null===n&&void 0}function ye(e,i){const n=xe(e,i);return void 0===n?void 0:!n}function be(e,i){if(null===i)return;const n=G(i);if(null!==n&&!Number.isFinite(n))return !0;if(null!==n&&isNaN(n))return;const t=re(i);if("ComplexInfinity"===t)return !0;if(t===P||t===T)return !1;if(e.is(i,"ComplexNumber"))return !1;const r=te(i);if("Negate"===r){if(be(e,le(i,1)))return !0}else if("Multiply"===r){const n=oe(i);if(n.some((i=>!0===be(e,i)))&&n.every((i=>!0===ye(e,i))))return !0}return null===n&&void 0}function Ne(e,i){if(null===i)return;const n=G(i);if(null!==n)return n>0;const t=re(i);if(t&&["Quarter","Third","Half","TwoThird","ThreeQuarter","MinusDoublePi","MinusPi","QuarterPi","ThirdPi","HalfPi","TwoThirdPi","ThreeQuarterPi","Pi","DoublePi","MachineEpsilon","CatalanConstant","GoldenRatio","EulerGamma","ExponentialE"].includes(t))return !0;if(e.is(["Greater",i,0]))return !0;if(e.is(["LessEqual",i,0]))return !1;if(e.is(["Less",i,0]))return !1;const r=te(i);if(r){if(("Cosh"===r||"Exp"===r)&&Se(0,le(i,1)))return !0;if("Sqrt"===r&&Ne(e,le(i,1)))return !0;if(r===L||r===O)return oe(i).every((i=>!0===Ne(e,i)));if(r===z&&Ne(e,le(i,1))&&Ne(e,le(i,2)))return !0;if(r===R&&Ne(e,le(i,1)))return !0}}function we(e,i){const n=Ne(e,i);return !0!==n&&(void 0!==n?!1===xe(e,i):void 0)}function Se(e,i){return null!==i&&null!==G(i)}const Ee={MachineEpsilon:{domain:"RealNumber",constant:!0,value:{num:Number.EPSILON.toString()}},ImaginaryUnit:{domain:"ImaginaryNumber",constant:!0,wikidata:"Q193796"},ExponentialE:{domain:"TranscendentalNumber",wikidata:"Q82435",constant:!0,value:e=>"decimal"===e.numericFormat?c.exports.Decimal.exp(1):"complex"===e.numericFormat?m.exports.Complex.E:2.718281828459045},GoldenRatio:{domain:"IrrationalNumber",wikidata:"Q41690",constant:!0,hold:!1,value:["Divide",["Add",1,["Sqrt",5]],2]},CatalanConstant:{domain:"RealNumber",wikidata:"Q855282",constant:!0,value:{num:"0.91596559417721901505"}},EulerGamma:{domain:"RealNumber",wikidata:"Q273023",constant:!0,value:{num:"0.577215664901532860606"}},Quarter:{domain:"RationalNumber",wikidata:"Q2310416",constant:!0,hold:!1,value:[z,3,4]},Third:{domain:"RationalNumber",wikidata:"Q20021125",constant:!0,hold:!1,value:[z,1,3]},Half:{domain:"RationalNumber",wikidata:"Q2114394",constant:!0,hold:!1,value:[z,1,2]},TwoThird:{domain:"RationalNumber",constant:!0,hold:!1,value:[z,2,3]},ThreeQuarter:{domain:"RationalNumber",constant:!0,hold:!1,value:[z,3,4]},Abs:{domain:"Function",wikidata:"Q3317982",threadable:!0,idempotent:!0,numeric:!0,range:["Interval",0,1/0],evalNumber:(e,i)=>Math.abs(i),evalComplex:(e,i)=>m.exports.Complex.abs(i),evalDecimal:(e,i)=>c.exports.Decimal.abs(i)},Add:{domain:"Function",wikidata:"Q32043",associative:!0,commutative:!0,threadable:!0,idempotent:!0,range:"Number",numeric:!0,simplify:function(e,...i){var n,t;if(0===i.length)return 0;if(1===i.length)return i[0];let r=0,o=1,s=f,a=m.exports.Complex.ZERO,l=!1,u=!1;const c=[];for(const n of i){const i=re(n);if(i===P||i===T)return NaN;if("ComplexInfinity"===i)return "ComplexInfinity";be(e,n)&&(Ne(e,n)?l=!0:u=!0);const[t,m]=X(n);if(null!==t&&null!==m){if(isNaN(t)||isNaN(m))return NaN;r=r*m+t*o,o*=m;}else {const i=W(n);if(null!==i)Number.isInteger(i.re)&&Number.isInteger(i.im)?a=a.add(i):c.push(n);else {const i=Y(n);if(null!==i&&i.isInteger())s=s.add(i);else {const i=G(n);null!==i&&Number.isInteger(i)?r+=i:!1!==ye(e,n)&&c.push(n);}}}}if(l&&u)return NaN;if(l)return 1/0;if(u)return -1/0;if(s.isZero()||c.push(s),a.isZero()||c.push(a),0===c.length)return 0===r?0:1===o?r:["Divide",r,o];if(0!==r){const e=A(r,o);r/=e,o/=e,1===o?c.push(r):c.push(["Divide",r,o]);}return 1===c.length?c[0]:2===c.length&&te(c[1])===_?["Subtract",c[0],null!==(n=le(c[1],1))&&void 0!==n?n:P]:2===c.length&&te(c[0])===_?["Subtract",c[1],null!==(t=le(c[0],1))&&void 0!==t?t:P]:["Add",...c]},evalNumber:(e,...i)=>{if(0===i.length)return 0;let n=0;for(const e of i)n+=e;return n},evalComplex:(e,...i)=>{if(0===i.length)return m.exports.Complex.ZERO;let n=m.exports.Complex.ZERO;for(const e of i)n=n.add(e);return n},evalDecimal:(e,...i)=>{if(0===i.length)return f;let n=f;for(const e of i)n=n.add(e);return n},evaluate:(e,...i)=>{if(0===i.length)return 0;let n=["Add"];const t=i.filter((e=>e instanceof c.exports.Decimal));t.length>0&&(1===t.length?n.push(t[0]):n.push(e.N(["Add",...t])));const r=i.filter((e=>e instanceof m.exports.Complex));r.length>0&&(1===r.length?n.push(r[0]):n.push(e.N(["Add",...r])));const o=i.filter((e=>"number"==typeof e));o.length>0&&(1===o.length?n.push(o[0]):n.push(e.N(["Add",...o])));const s=i.filter((e=>!("number"==typeof e||e instanceof c.exports.Decimal||e instanceof m.exports.Complex)));return n=[...n,...s],0===n.length?0:1===n.length?n[1]:n}},Chop:{domain:"Function",associative:!0,threadable:!0,idempotent:!0,numeric:!0,range:"Number",evalNumber:(e,i)=>e.chop(i),evalComplex:(e,i)=>e.chop(i),evalDecimal:(e,i)=>e.chop(i)},Ceil:{domain:"Function",range:"Number",numeric:!0,evalNumber:(e,i)=>Math.ceil(i),evalComplex:(e,i)=>m.exports.Complex.ceil(i),evalDecimal:(e,i)=>c.exports.Decimal.ceil(i)},Divide:{domain:"Function",range:"Number",numeric:!0,evalNumber:(e,i,n)=>i/n,evalComplex:(e,i,n)=>"number"==typeof i?new m.exports.Complex(i).div(n):i.div(n),evalDecimal:(e,i,n)=>c.exports.Decimal.div(i,n)},Exp:{domain:["ContinuousFunction","MonotonicFunction"],wikidata:"Q168698",threadable:!0,range:"Number",numeric:!0,evalNumber:(e,i)=>Math.exp(i),evalComplex:(e,i)=>"number"==typeof i?new m.exports.Complex(i).exp():i.exp(),evalDecimal:(e,i)=>c.exports.Decimal.exp(i)},Erf:{domain:["ContinuousFunction","MonotonicFunction"],range:"Number",numeric:!0},Erfc:{domain:["ContinuousFunction","MonotonicFunction"],range:"Number",numeric:!0},Factorial:{wikidata:"Q120976",domain:"MonotonicFunction",range:"Integer",numeric:!0,evalNumber:(e,i)=>function(e){if(!Number.isInteger(e)||e<0)return NaN;let i=1;for(let n=2;n<=e;n++)i*=n;return i}(i),evalComplex:(e,i)=>"number"==typeof i?new m.exports.Complex(i+1):i.add(1),evalDecimal:(e,i)=>x(i)},Floor:{domain:"Function",wikidata:"Q56860783",range:"Number",numeric:!0,evalNumber:(e,i)=>Math.floor(i),evalDecimal:(e,i)=>c.exports.Decimal.floor(i)},Gamma:{domain:"Function",wikidata:"Q190573",range:"Number",numeric:!0,evalNumber:(e,i)=>I(i),evalDecimal:(e,i)=>S(i)},LogGamma:{domain:"Function",range:"Number",numeric:!0,evalNumber:(e,i)=>F(i),evalDecimal:(e,i)=>w(i)},Ln:{domain:"Function",wikidata:"Q11197",range:"Number",numeric:!0,evalNumber:(e,i)=>Math.log(i),evalComplex:(e,i)=>"number"==typeof i?new m.exports.Complex(i).log():i.log(),evalDecimal:(e,i)=>c.exports.Decimal.log(i)},Log:{domain:"Function",range:"Number",numeric:!0,evalNumber:(e,i,n)=>Math.log(n)/Math.log(i),evalComplex:(e,i,n)=>{const t="number"==typeof i?new m.exports.Complex(i):i;return ("number"==typeof n?new m.exports.Complex(n):n).log().div(t.log())},evalDecimal:(e,i,n)=>c.exports.Decimal.log(n).div(c.exports.Decimal.log(i))},Lb:{domain:"Function",wikidata:"Q581168",range:"Number",numeric:!0,evalNumber:(e,i)=>Math.log2(i),evalComplex:(e,i,n)=>("number"==typeof n?new m.exports.Complex(n):n).log().div(m.exports.Complex.log(2)),evalDecimal:(e,i)=>c.exports.Decimal.log(i).div(c.exports.Decimal.log(2))},Lg:{domain:"Function",wikidata:"Q966582",range:"Number",numeric:!0,evalNumber:(e,i)=>Math.log10(i),evalComplex:(e,i,n)=>("number"==typeof n?new m.exports.Complex(n):n).log().div(m.exports.Complex.log(10)),evalDecimal:(e,i)=>c.exports.Decimal.log(i).div(c.exports.Decimal.log(10))},Multiply:{domain:"Function",wikidata:"Q40276",associative:!0,commutative:!0,idempotent:!0,range:"Number",simplify:function(e,...i){if(0===i.length)return 1;if(1===i.length)return i[0];const n=[];let t=1,r=1,o=m.exports.Complex.ONE;for(const s of i){const i=G(s);if(0===i)return 0;if(null===i||Number.isFinite(i)&&!Number.isInteger(i)){const[i,a]=[null,null];if(null!==i&&null!==a)t*=i,r*=a;else {const i=W(s);if(null!==i)Number.isInteger(i.re)&&Number.isInteger(i.im)?o=o.mul(i):n.push(s);else {if(xe(e,s))return 0;n.push(s);}}}else t*=i;}return 0!==o.im?(o=o.mul(t),t=1):(t*=o.re,o=m.exports.Complex.ONE),0!==t&&isFinite(t)?(o.equals(m.exports.Complex.ONE)||n.push(["Complex",o.re,o.im]),0===n.length?1===r?t:["Divide",t,r]:(1!==r&&(n.unshift(["Divide",t,r]),t=1,r=1),1===n.length&&1===t?n[0]:1===n.length&&-1===t?["Negate",n[0]]:1===t?["Multiply",...n]:-1===t?["Negate",["Multiply",...n]]:["Multiply",t,...n])):t/r},numeric:!0,evalNumber:function(e,...i){if(0===i.length)return 1;if(1===i.length)return i[0];let n=1;for(const e of i)n*=e;return n},evalComplex:(e,...i)=>{if(0===i.length)return m.exports.Complex.ONE;let n=m.exports.Complex.ONE;for(const e of i)n=n.mul(e);return n},evalDecimal:(e,...i)=>{if(0===i.length)return h;let n=h;for(const e of i)n=n.mul(e);return n},evaluate:(e,...i)=>{if(0===i.length)return 0;let n=["Multiply"];const t=i.filter((e=>e instanceof c.exports.Decimal));t.length>0&&(1===t.length?n.push(t[0]):n.push(e.N(["Multiply",...t])));const r=i.filter((e=>e instanceof m.exports.Complex));r.length>0&&(1===r.length?n.push(r[0]):n.push(e.N(["Multiply",...r])));const o=i.filter((e=>"number"==typeof e));o.length>0&&(1===o.length?n.push(o[0]):n.push(e.N(["Multiply",...o])));const s=i.filter((e=>!("number"==typeof e||e instanceof c.exports.Decimal||e instanceof m.exports.Complex)));return n=[...n,...s],0===n.length?1:1===n.length?n[1]:n}},Negate:{domain:"Function",wikidata:"Q715358",range:"Number",simplify:(e,i)=>{var n;return null!==(n=De(i))&&void 0!==n?n:["Negate",i]},numeric:!0,evalNumber:(e,i)=>-i,evalComplex:(e,i)=>"number"==typeof i?new m.exports.Complex(-i):i.neg(),evalDecimal:(e,i)=>"number"==typeof i?new c.exports.Decimal(-i):i.neg()},Power:{domain:"Function",wikidata:"Q33456",commutative:!1,numeric:!0,range:"Number",simplify:(e,...i)=>Ce(e,["Power",...i]),evalNumber:(e,i,n)=>Math.pow(i,n),evalComplex:(e,i,n)=>{const t="number"==typeof i?new m.exports.Complex(i):i,r="number"==typeof n?new m.exports.Complex(n):n;return m.exports.Complex.pow(t,r)},evalDecimal:(e,i,n)=>c.exports.Decimal.pow(i,n)},Round:{domain:"Function",range:"Number",numeric:!0,evalNumber:(e,i)=>Math.round(i),evalComplex:(e,i)=>"number"==typeof i?new m.exports.Complex(i).round():i.round(),evalDecimal:(e,i)=>c.exports.Decimal.round(i)},Sign:{domain:"Function",range:["Range",-1,1],numeric:!0,simplify:(e,i)=>xe(e,i)?0:we(e,i)?-1:1,evalNumber:(e,i)=>0===i?0:i<0?-1:1,evalComplex:(e,i)=>{const n="number"==typeof i?new m.exports.Complex(i):i;return n.div(n.abs())},evalDecimal:(e,i)=>"number"==typeof i?0===i?f:i<0?p:h:i.isZero()?f:i.isNeg()?p:h},SignGamma:{domain:"Function",range:"Number",numeric:!0},Sqrt:{domain:"Function",wikidata:"Q134237",range:"Number",numeric:!0,evalNumber:(e,i)=>Math.sqrt(i),evalComplex:(e,i)=>"number"==typeof i?new m.exports.Complex(i).sqrt():i.sqrt(),evalDecimal:(e,i)=>c.exports.Decimal.sqrt(i)},Square:{domain:"Function",wikidata:"Q3075175",range:"Number",numeric:!0,evalNumber:(e,i)=>i*i,evalComplex:(e,i)=>"number"==typeof i?new m.exports.Complex(i).multiply(i):i.mul(i),evalDecimal:(e,i)=>c.exports.Decimal.mul(i,i)},Root:{domain:"Function",commutative:!1,range:"Number",numeric:!0,evalNumber:(e,i,n)=>Math.pow(i,1/n),evalComplex:(e,i,n)=>{const t="number"==typeof i?new m.exports.Complex(i):i,r="number"==typeof n?new m.exports.Complex(1/n):new m.exports.Complex(m.exports.Complex.ONE.div(n));return m.exports.Complex.pow(t,r)},evalDecimal:(e,i,n)=>c.exports.Decimal.pow(i,h.div(n))},Subtract:{domain:"Function",wikidata:"Q32043",range:"Number",numeric:!0,evalNumber:(e,i,n)=>i-n,evalComplex:(e,i,n)=>"number"==typeof i?new m.exports.Complex(i).sub(n):i.sub(n),evalDecimal:(e,i,n)=>c.exports.Decimal.sub(i,n)}};function De(e){var i,n,t,r;if("number"==typeof(e=Ae(e)))return -e;if(e&&H(e))return "-"===e.num[0]?{num:e.num.slice(1)}:"+"===e.num[0]?{num:"-"+e.num.slice(1)}:{num:"-"+e.num};if(e instanceof c.exports.Decimal)return e.mul(-1);if(e instanceof m.exports.Complex)return e.mul(-1);const o=te(e),s=ue(e);if(o===_&&1===s)return null!==(i=le(e,1))&&void 0!==i?i:P;if(o===L){const i=De(null!==(n=le(e,1))&&void 0!==n?n:P);return [L,i,...oe(e).slice(1)]}return o===O?[O,...ae(e,De)]:"Subtract"===o?["Subtract",null!==(t=le(e,2))&&void 0!==t?t:P,null!==(r=le(e,1))&&void 0!==r?r:P]:"Parentheses"===o&&1===s?De(le(le(e,1),1)):[_,null!=e?e:P]}function Ae(e){return null===e?T:ne(e)?e:"Parentheses"===ie(e)&&1===ue(e)?Ae(le(e,1)):se(e,Ae)}function Ce(e,i){var n,t;if(2!==ue(i=Ae(i)))return i;const r=le(i,1),o=null!==(n=G(r))&&void 0!==n?n:NaN,s=le(i,2);if("ComplexInfinity"===re(s))return NaN;const a=null!==(t=G(s))&&void 0!==t?t:NaN;if(xe(e,s))return 1;if(1===a)return r;if(2===a)return ["Square",r];if(-1===a)return -1===o||1===o?-1:Number.isFinite(o)?["Divide",1,r]:0;if(!Number.isFinite(a)){if(0===o&&a<0)return "ComplexInfinity";if(1===o||-1===o)return NaN;if(o===1/0){if(a>0)return 1/0;if(a<0)return 0}if(o===-1/0&&!Number.isFinite(a))return NaN}return i}function Fe(e,i,n,t){return null===n?"\\sqrt{}":(t=null!=t?t:2,"solidus"===i?e.wrapShort(n)+"^{1\\/"+e.serialize(t)+"}":"quotient"===i?e.wrapShort(n)+"^{\\frac{1}{"+e.serialize(t)+"}}":2===G(t)?"\\sqrt{"+e.serialize(n)+"}":"\\sqrt["+e.serialize(t)+"]{"+e.serialize(n)+"}")}function Ie(e,i,n){if(!i.match("\\sqrt"))return [e,null];const t=i.matchOptionalLatexArgument(),r=i.matchRequiredLatexArgument();return null===r?null!==t?[e,[Z,T,t]]:[e,[Q]]:null!==t?[e,[Z,r,t]]:[e,[Q,r]]}function ke(e,i,n){if(276<n)return [e,null];const t=i.index;if(!i.match("-"))return [e,null];const r=i.matchExpression(null===e?400:277);return null===r?(i.index=t,[e,null]):null===e?[null,[_,r]]:[null,["Subtract",e,r]]}function Pe(e,i){var n;if(null===i)return "";e.level-=1;let t="";const[r,o]=function(e){var i,n,t,r,o,s;if(te(e)!==L)return [[],[]];const a=[],l=[],u=oe(e);for(const e of u)if(te(e)===R)if(te(le(e,2))===_){const t=null!==(i=le(e,1))&&void 0!==i?i:T,r=null!==(n=le(le(e,2),1))&&void 0!==n?n:T;l.push([R,t,r]);}else {const i=null!==(t=G(le(e,2)))&&void 0!==t?t:NaN;-1===i?l.push(null!==(r=le(e,1))&&void 0!==r?r:T):i<0?l.push([R,null!==(o=le(e,1))&&void 0!==o?o:T,null!==(s=De(le(e,2)))&&void 0!==s?s:T]):a.push(e);}else a.push(e);return [a,l]}(i);if(o.length>0&&(t=1===o.length&&1===o[0]?0===r.length?"1":1===r.length?e.serialize(r[0]):Pe(e,[L,...r]):e.serialize([z,1===r.length?r[0]:[L,...r],1===o.length?o[0]:[L,...o]])),t)return e.level+=1,t;let a=!1,l=null;const u=ue(i)+1;let c=!1;for(let r=1;r<u;r++)if(l=le(i,r),null!==l){let i;"number"==typeof l||H(l)?(i=e.serialize(l),"-1"!==i||t?("-"===i[0]&&(i=i.slice(1),a=!a),t=t?s([t,e.options.multiply,i]):i):t="-",c=!0):te(l)!==R||isNaN(null!==(n=G(le(l,1)))&&void 0!==n?n:NaN)?(te(l)===_&&(l=le(l,1),a=!a),i=e.wrap(l,390),t=t?c&&te(l)===z?s([t,"\\times",i]):e.options.invisibleMultiply?s([t,e.options.invisibleMultiply,i]):s([t,i]):i,c=!1):(t=t?s([t,e.options.multiply,e.serialize(l)]):e.serialize(l),c=!0);}return e.level+=1,a?"-"+t:t}function Te(e,i){if(null===i)return "";if(1===ue(i))return e.serialize(le(i,1));const n=e.level>3?"inline-solidus":"quotient";if("inline-solidus"===n||"nice-solidus"===n){const t=e.wrapShort(le(i,1)),r=e.wrapShort(le(i,2));return "nice-solidus"===n?`^{${t}}\\!\\!/\\!_{${r}}`:`${t}\\/${r}`}return "reciprocal"===n?e.wrap(le(i,1))+e.wrap(le(i,2))+"^{-1}":"factor"===n?"\\frac{1}{"+e.serialize(le(i,2))+"}"+e.wrap(le(i,1)):"\\frac{"+e.serialize(le(i,1))+"}{"+e.serialize(le(i,2))+"}"}function Oe(e,i){var n;const t=le(i,1),r=le(i,2);if(null===r)return e.serialize(t);if(null===t)return "";const o=te(i);if(o===Q||o===Z)return Fe(e,he(0,e.level),le(i,1),le(i,2));const s=null!==(n=G(r))&&void 0!==n?n:1;if(-1===s)return e.serialize([z,"1",t]);if(s<0)return e.serialize([z,"1",[R,t,-s]]);if(te(r)===z){if(1===G(le(r,1)))return Fe(e,he(0,e.level),t,le(r,2))}else if(te(r)===R&&-1===G(le(r,2)))return Fe(e,he(0,e.level),t,le(r,1));return e.wrapShort(t)+"^{"+e.serialize(r)+"}"}function ze(e,i,n){var t;const r=i.next();let o=!1,s=0;if(i.skipSpace(),i.match("^")){if(i.skipSpace(),i.match("<{>")){i.skipSpace(),i.match("-")&&i.match("1")&&(o=!0);do{i.match("\\doubleprime")&&(s+=2),i.match("\\prime")&&(s+=1),i.match("'")&&(s+=1);}while(!i.match("<}>")&&!i.atEnd)}let e=!1;for(;!e;)i.skipSpace(),i.match("\\doubleprime")?s+=2:i.match("\\prime")||i.match("'")?s+=1:e=!0;}let a=null!==(t={"\\arcsin":"Arcsin","\\arccos":"Arccos","\\arctan":"Arctan","\\arctg":"Arctan","\\arcctg":"Arctan","\\arcsec":"Arcsec","\\arccsc":" Arccsc","\\arsinh":"Arsinh","\\arcosh":"Arcosh","\\artanh":"Artanh","\\arcsech":"Arcsech","\\arccsch":"Arcsch","\\ch":"Cosh","\\cos":"Cos","\\cosec":"Csc","\\cosh":"Csch","\\cot":"Cot","\\cotg":"Cot","\\coth":"Coth","\\csc":"Csc","\\ctg":"Cot","\\cth":"Coth","\\sec":"Sec","\\sin":"Sin","\\sinh":"Sinh","\\sh":"Sinh","\\tan":"Tan","\\tanh":"Tanh","\\tg":"Tan","\\th":"Tanh"}[r])&&void 0!==t?t:r;o&&(a=["InverseFunction",a]),s>=1&&(a=["Derivative",s,a]);const l=i.matchArguments("implicit");return null===l?[null,a]:[null,[a,...l]]}function Le(e){return a(e)}const _e={algebra:[{name:"To",trigger:{infix:"\\to"},precedence:270}],arithmetic:[{name:"ThreeQuarter",serialize:"\\frac{3}{4}"},{name:"TwoThird",serialize:"\\frac{2}{3}"},{name:"Half",serialize:"\\frac{1}{2}"},{name:"Third",serialize:"\\frac{1}{3}"},{name:"Quarter",serialize:"\\frac{1}{4}"},{name:"CatalanConstant",serialize:"G"},{name:"GoldenRatio",serialize:"\\varphi"},{name:"EulerGamma",serialize:"\\gamma"},{name:"Degrees",serialize:"\\frac{\\pi}{180}"},{name:"MinusDoublePi",serialize:"-2\\pi"},{name:"MinusPi",serialize:"-\\pi"},{name:"MinusHalfPi",serialize:"-\\frac{\\pi}{2}"},{name:"QuarterPi",serialize:"\\frac{\\pi}{4}"},{name:"ThirdPi",serialize:"\\frac{\\pi}{3}"},{name:"HalfPi",serialize:"\\frac{\\pi}{2}"},{name:"TwoThirdPi",serialize:"\\frac{2\\pi}{3}"},{name:"ThreeQuarterPi",serialize:"\\frac{3\\pi}{4}"},{name:"DoublePi",serialize:"2\\pi"},{name:"Complex",precedence:275,serialize:(e,i)=>{const n=G(le(i,1)),t=G(le(i,2));if(0===t)return e.serialize(le(i,1));const r=1===t?"\\imaginaryI":-1===t?"-\\imaginaryI":s([e.serialize(le(i,2)),"\\imaginaryI"]);return 0===n?r:s([e.serialize(le(i,1)),"+",r])}},{name:"Exp",serialize:(e,i)=>{var n;return s(["\\exponentialE^{",e.serialize(null!==(n=le(i,1))&&void 0!==n?n:T),"}"])}},{name:"Square",serialize:(e,i)=>e.wrapShort(le(i,1))+"^2"},{trigger:{symbol:"\\infty"},parse:{num:"+Infinity"}},{name:"ComplexInfinity",trigger:{symbol:["\\tilde","\\infty"]},serialize:"\\tilde\\infty"},{name:"ComplexInfinity",trigger:{symbol:["\\tilde","<{>","\\infty","<}>"]},serialize:"\\tilde\\infty"},{name:"Pi",trigger:{symbol:"\\pi"}},{name:"Pi",trigger:{symbol:"π"},serialize:"\\pi"},{name:"ExponentialE",trigger:{symbol:"e"},serialize:"e"},{name:"ImaginaryUnit",trigger:{symbol:"i"},serialize:"\\imaginaryI"},{name:"ImaginaryUnit",trigger:{symbol:"\\imaginaryI"}},{name:O,trigger:{prefix:"+",infix:"+"},parse:function(e,i,n){if(275<n)return [e,null];const t=i.index;if(!i.match("+"))return [e,null];const r=i.matchExpression(null===e?400:275);return null===r?(i.index=t,[e,null]):null===e?[null,r]:i.applyOperator(O,e,r)},serialize:function(e,i){var n,t;e.level-=1;const r=te(i);let o="",s=le(i,1),a=!Number.isNaN(null!==(n=G(s))&&void 0!==n?n:NaN);if(r===_)o="-"+e.wrap(s,276);else if(r===O){o=e.serialize(s);const n=ue(i)+1;for(let r=2;r<n;r++){s=le(i,r);const n=null!==(t=G(s))&&void 0!==t?t:NaN,l=!Number.isNaN(n);let u=!1;if(null!==s&&a){const[i,n]=X(s);null!==i&&null!==n&&isFinite(i)&&isFinite(n)&&1!==n&&(o+=e.options.invisiblePlus+e.serialize(s),u=!0);}if(!u)if(n<0)o+=e.serialize(s);else if(te(s)===_)o+=e.wrap(s,275);else {const i=e.wrap(s,275);"-"===i[0]||"+"===i[0]?o+=i:o=o+"+"+i;}a=l;}}else if("Subtract"===r){const n=le(i,2);o=null!==n?e.wrap(s,275)+"-"+e.wrap(n,275):e.wrap(s,275);}return e.level+=1,o},associativity:"both",precedence:275},{name:_,trigger:{prefix:"-"},parse:ke,associativity:"left",precedence:275},{name:"Subtract",trigger:{infix:"-"},parse:ke,associativity:"both",precedence:275},{name:"PlusMinus",trigger:{infix:"\\pm"},associativity:"both",precedence:270},{name:"MinusPlus",trigger:{infix:"\\mp"},associativity:"both",precedence:270},{name:L,trigger:{infix:"\\times"},serialize:Pe,associativity:"both",precedence:390},{name:L,trigger:{infix:"\\cdot"},serialize:Pe,associativity:"both",precedence:390},{name:L,trigger:{infix:"*"},serialize:Pe,associativity:"both",precedence:390},{name:z,trigger:"\\frac",parse:function(e,i,n){var t,r,o,s;if(!i.match("\\frac"))return [e,null];const a=null!==(t=i.matchRequiredLatexArgument())&&void 0!==t?t:P,l=null!==(r=i.matchRequiredLatexArgument())&&void 0!==r?r:P;if("PartialDerivative"===te(a)&&("PartialDerivative"===te(l)||te(l)===L&&"PartialDerivative"===te(le(l,1)))){const n=null!==(o=le(a,3))&&void 0!==o?o:T;let t=le(a,1);null!==t&&t!==T||(t=null!==(s=i.matchExpression())&&void 0!==s?s:T);let r=[];if(te(l)===L){for(const e of oe(l))if("PartialDerivative"===ie(e)){const i=le(e,2);i&&r.push(i);}}else {const e=le(l,2);e&&r.push(e);}return r.length>1&&(r=[k,...r]),[e,["PartialDerivative",t,r,n===T?1:n]]}return [e,[z,a,l]]},serialize:Te,requiredLatexArg:2},{name:z,trigger:{infix:"\\/"},serialize:Te,associativity:"non",precedence:660},{name:z,trigger:{infix:"/"},serialize:Te,associativity:"non",precedence:660},{name:z,trigger:{infix:"\\div"},serialize:Te,associativity:"non",precedence:660},{name:R,trigger:{infix:"^"},associativity:"non",precedence:720,serialize:Oe},{name:R,trigger:{infix:["*","*"]},associativity:"non",precedence:720,serialize:Oe},{name:Q,trigger:"\\sqrt",optionalLatexArg:1,requiredLatexArg:1,parse:Ie,serialize:Oe},{name:Z,trigger:"\\sqrt",optionalLatexArg:1,requiredLatexArg:1,parse:Ie},{name:"Norm",trigger:{matchfix:"\\lVert"},closeFence:"\\rVert"},{name:"Norm",trigger:{matchfix:"\\|"},closeFence:"\\|"},{name:"Norm",trigger:{matchfix:["|","|"]},closeFence:["|","|"]},{name:"Abs",trigger:{matchfix:"|"},closeFence:"|"},{name:"Abs",trigger:{matchfix:"\\lvert"},closeFence:"\\rvert"},{name:"Factorial",trigger:{postfix:"!"},precedence:810},{name:"Factorial2",trigger:{postfix:["!","!"]},precedence:810},{name:"Lcm",trigger:{symbol:["\\operatorname","<{>","l","c","m","<}>"]}},{name:"Gcd",trigger:{symbol:["\\operatorname","<{>","g","c","d","<}>"]}},{name:"Ceil",trigger:{symbol:["\\operatorname","<{>","c","e","i","l","<}>"]}},{name:"Floor",trigger:{symbol:["\\operatorname","<{>","f","l","o","o","r","<}>"]}},{name:"Round",trigger:{symbol:["\\operatorname","<{>","r","o","u","n","d","<}>"]}},{name:"Sign",trigger:{symbol:["\\operatorname","<{>","s","g","n","<}>"]}}],calculus:[{trigger:{symbol:"\\int"},parse:function(e,i,n){if(!i.match("\\int"))return [e,null];let t=T,r=T,o=!1;for(;!o;)i.skipSpace(),i.match("_")?r=i.matchRequiredLatexArgument():i.match("^")?t=i.matchRequiredLatexArgument():o=!0;const s=i.matchBalancedExpression("<{>","<}>");return [e,["Integral",null!=s?s:"",null!=t?t:T,null!=r?r:T]]},serialize:function(e,i){return ""}}],core:ve,inequalities:[{name:"NotLess",trigger:{infix:["!","<"]},associativity:"right",precedence:246},{name:"NotLess",trigger:{infix:"\\nless"},associativity:"right",precedence:246},{name:"Less",trigger:{infix:"<"},associativity:"right",precedence:245},{name:"Less",trigger:{infix:"\\lt"},associativity:"right",precedence:245},{name:"LessEqual",trigger:{infix:["<","="]},associativity:"right",precedence:241},{name:"LessEqual",trigger:{infix:"\\le"},associativity:"right",precedence:241},{name:"LessEqual",trigger:{infix:"\\leq"},associativity:"right",precedence:241},{name:"LessEqual",trigger:{infix:"\\leqslant"},associativity:"right",precedence:265},{name:"LessNotEqual",trigger:{infix:"\\lneqq"},associativity:"right",precedence:260},{name:"NotLessNotEqual",trigger:{infix:"\\nleqq"},associativity:"right",precedence:260},{name:"LessOverEqual",trigger:{infix:"\\leqq"},associativity:"right",precedence:265},{name:"GreaterOverEqual",trigger:{infix:"\\geqq"},associativity:"right",precedence:265},{name:"Equal",trigger:{infix:"="},associativity:"right",precedence:260},{name:"StarEqual",trigger:{infix:["*","="]},associativity:"right",precedence:260},{name:"StarEqual",trigger:{infix:["\\star","="]},associativity:"right",precedence:260},{name:"PlusEqual",trigger:{infix:["+","="]},associativity:"right",precedence:260},{name:"MinusEqual",trigger:{infix:["-","="]},associativity:"right",precedence:260},{name:"SlashEqual",trigger:{infix:["/","="]},associativity:"right",precedence:260},{name:"EqualEqual",trigger:{infix:["=","="]},associativity:"right",precedence:260},{name:"EqualEqualEqual",trigger:{infix:["=","=","="]},associativity:"right",precedence:265},{name:"TildeFullEqual",trigger:{infix:"\\cong"},associativity:"right",precedence:260},{name:"NotTildeFullEqual",trigger:{infix:"\\ncong"},associativity:"right",precedence:260},{name:"Assign",trigger:{infix:[":","="]},associativity:"right",precedence:260},{name:"Assign",trigger:{infix:"\\coloneq"},associativity:"right",precedence:260},{name:"Approx",trigger:{infix:"\\approx"},associativity:"right",precedence:247},{name:"NotApprox",trigger:{infix:"\\approx"},associativity:"right",precedence:247},{name:"ApproxEqual",trigger:{infix:"\\approxeq"},associativity:"right",precedence:260},{name:"NotApproxEqual",trigger:{infix:["!","\\approxeq"]},associativity:"right",precedence:250},{name:"NotEqual",trigger:{infix:"\\ne"},associativity:"right",precedence:255},{name:"Unequal",trigger:{infix:["!","="]},associativity:"right",precedence:260},{name:"GreaterEqual",trigger:{infix:"\\ge"},associativity:"right",precedence:242},{name:"GreaterEqual",trigger:{infix:"\\geq"},associativity:"right",precedence:242},{name:"GreaterEqual",trigger:{infix:[">","="]},associativity:"right",precedence:243},{name:"GreaterEqual",trigger:{infix:"\\geqslant"},associativity:"right",precedence:265},{name:"GreaterNotEqual",trigger:{infix:"\\gneqq"},associativity:"right",precedence:260},{name:"NotGreaterNotEqual",trigger:{infix:"\\ngeqq"},associativity:"right",precedence:260},{name:"Greater",trigger:{infix:">"},associativity:"right",precedence:245},{name:"Greater",trigger:{infix:"\\gt"},associativity:"right",precedence:245},{name:"NotGreater",trigger:{infix:"\\ngtr"},associativity:"right",precedence:244},{name:"NotGreater",trigger:{infix:["!",">"]},associativity:"right",precedence:244},{name:"RingEqual",trigger:{infix:"\\circeq"},associativity:"right",precedence:260},{name:"TriangleEqual",trigger:{infix:"\\triangleq"},associativity:"right",precedence:260},{name:"DotEqual",trigger:{infix:"\\doteq"},associativity:"right",precedence:265},{name:"DotEqualDot",trigger:{infix:"\\doteqdot"},associativity:"right",precedence:265},{name:"FallingDotEqual",trigger:{infix:"\\fallingdotseq"},associativity:"right",precedence:265},{name:"RisingDotEqual",trigger:{infix:"\\fallingdotseq"},associativity:"right",precedence:265},{name:"QuestionEqual",trigger:{infix:"\\questeq"},associativity:"right",precedence:260},{name:"Equivalent",trigger:{infix:"\\equiv"},associativity:"right",precedence:260},{name:"MuchLess",trigger:{infix:"\\ll"},associativity:"right",precedence:260},{name:"MuchGreater",trigger:{infix:"\\gg"},associativity:"right",precedence:260},{name:"Precedes",trigger:{infix:"\\prec"},associativity:"right",precedence:260},{name:"Succeeds",trigger:{infix:"\\succ"},associativity:"right",precedence:260},{name:"PrecedesEqual",trigger:{infix:"\\preccurlyeq"},associativity:"right",precedence:260},{name:"SucceedsEqual",trigger:{infix:"\\curlyeqprec"},associativity:"right",precedence:260},{name:"NotPrecedes",trigger:{infix:"\\nprec"},associativity:"right",precedence:260},{name:"NotSucceeds",trigger:{infix:"\\nsucc"},associativity:"right",precedence:260},{name:"Between",trigger:{infix:"\\between"},associativity:"right",precedence:265}],other:fe,physics:[{name:"mu-0",trigger:{symbol:["\\mu","_","0"]}}],sets:[{trigger:{symbol:"\\N"},parse:"NaturalNumber"},{trigger:{symbol:"\\Z"},parse:"Integer"},{trigger:{symbol:"\\Q"},parse:"RationalNumber"},{trigger:{symbol:["\\mathbb","<{>","A","<}>"]},parse:"AlgebraicNumber"},{trigger:{symbol:"\\R"},parse:"RealNumber"},{trigger:{symbol:"\\C"},parse:"ComplexNumber"},{trigger:{symbol:"\\varnothing"},parse:"EmptySet"},{trigger:{symbol:"\\emptyset"},parse:"EmptySet"},{name:"Complement",trigger:{infix:"\\complement"},precedence:240},{name:"Element",trigger:{infix:"\\in"},precedence:240},{name:"Intersection",trigger:{infix:"\\Cap"},precedence:350},{name:"NotElement",trigger:{infix:"\\notin"},precedence:240},{name:"SetMinus",trigger:{infix:"\\setminus"},precedence:650},{name:"SubsetEqual",trigger:{infix:"\\subseteq"},precedence:240},{name:"SymmetricDifference",trigger:{infix:"\\triangle"},precedence:260},{name:"Union",trigger:{infix:"\\cup"},precedence:350},{name:"Contains",trigger:{infix:"\\ni"},associativity:"right",precedence:160},{name:"Subset",trigger:{infix:"\\subset"},associativity:"right",precedence:240},{name:"SquareSubset",trigger:{infix:"\\sqsubset"},associativity:"right",precedence:265},{name:"SquareSubsetEqual",trigger:{infix:"\\sqsubseteq"},associativity:"right",precedence:265},{name:"Superset",trigger:{infix:"\\supset"},associativity:"right",precedence:240},{name:"SquareSuperset",trigger:{infix:"\\sqsupset"},associativity:"right",precedence:265},{name:"SquareSupersetEqual",trigger:{infix:"\\sqsupseteq"},associativity:"right",precedence:265},{name:"NotSubset",trigger:{infix:"\\nsubset"},associativity:"right",precedence:240},{name:"NotSuperset",trigger:{infix:"\\nsupset"},associativity:"right",precedence:240},{name:"SupersetEqual",trigger:{infix:"\\supseteq"},associativity:"right",precedence:240},{name:"NotSubsetNotEqual",trigger:{infix:"\\nsubseteq"},associativity:"right",precedence:240},{name:"NotSupersetNotEqual",trigger:{infix:"\\nsupseteq"},associativity:"right",precedence:240},{name:"SubsetNotEqual",trigger:{infix:"\\subsetneq"},associativity:"right",precedence:240},{name:"SubsetNotEqual",trigger:{infix:"\\varsupsetneqq"},associativity:"right",precedence:240},{name:"SupersetNotEqual",trigger:{infix:"\\supsetneq"},associativity:"right",precedence:240},{name:"SupersetNotEqual",trigger:{infix:"\\varsupsetneq"},associativity:"right",precedence:240}],symbols:[{trigger:{symbol:"\\alpha"},parse:"α"},{trigger:{symbol:"\\beta"},parse:"β"},{trigger:{symbol:"\\gamma"},parse:"γ"},{trigger:{symbol:"\\delta"},parse:"δ"},{trigger:{symbol:"\\epsilon"},parse:"ϵ"},{trigger:{symbol:"\\varepsilon"},parse:"ε"},{trigger:{symbol:"\\zeta"},parse:"ζ"},{trigger:{symbol:"\\eta"},parse:"η"},{trigger:{symbol:"\\theta"},parse:"θ"},{trigger:{symbol:"\\vartheta"},parse:"ϑ"},{trigger:{symbol:"\\iota"},parse:"ι"},{trigger:{symbol:"\\kappa"},parse:"κ"},{trigger:{symbol:"\\varkappa"},parse:"ϰ"},{trigger:{symbol:"\\lambda"},parse:"λ"},{trigger:{symbol:"\\mu"},parse:"μ"},{trigger:{symbol:"\\nu"},parse:"ν"},{trigger:{symbol:"\\xi"},parse:"ξ"},{trigger:{symbol:"\\omicron"},parse:"ο"},{trigger:{symbol:"\\varpi"},parse:"ϖ"},{trigger:{symbol:"\\rho"},parse:"ρ"},{trigger:{symbol:"\\varrho"},parse:"ϱ"},{trigger:{symbol:"\\sigma"},parse:"σ"},{trigger:{symbol:"\\varsigma"},parse:"ς"},{trigger:{symbol:"\\tau"},parse:"τ"},{trigger:{symbol:"\\phi"},parse:"ϕ"},{trigger:{symbol:"\\varphi"},parse:"φ"},{trigger:{symbol:"\\upsilon"},parse:"υ"},{trigger:{symbol:"\\chi"},parse:"χ"},{trigger:{symbol:"\\psi"},parse:"ψ"},{trigger:{symbol:"\\omega"},parse:"ω"},{trigger:{symbol:"\\Gamma"},parse:"Γ"},{trigger:{symbol:"\\Delta"},parse:"Δ"},{trigger:{symbol:"\\Theta"},parse:"Θ"},{trigger:{symbol:"\\Lambda"},parse:"Λ"},{trigger:{symbol:"\\Xi"},parse:"Ξ"},{trigger:{symbol:"\\Pi"},parse:"Π"},{trigger:{symbol:"\\Sigma"},parse:"Σ"},{trigger:{symbol:"\\Upsilon"},parse:"Υ"},{trigger:{symbol:"\\Phi"},parse:"Φ"},{trigger:{symbol:"\\Psi"},parse:"Ψ"},{trigger:{symbol:"\\Omega"},parse:"Ω"},{trigger:{symbol:"\\digamma"},parse:"ϝ"},{trigger:{symbol:"\\aleph"},parse:"ℵ"},{trigger:{symbol:"\\beth"},parse:"ℶ"},{trigger:{symbol:"\\daleth"},parse:"ℸ"},{trigger:{symbol:"\\gimel"},parse:"ℷ"},{trigger:{symbol:"\\Finv"},parse:"Ⅎ"},{trigger:{symbol:"\\Game"},parse:"⅁"},{trigger:{symbol:"\\wp"},parse:"℘"},{trigger:{symbol:"\\eth"},parse:"ð"},{trigger:{symbol:"\\mho"},parse:"℧"},{trigger:{symbol:"\\clubsuit"},parse:"♣"},{trigger:{symbol:"\\heartsuit"},parse:"♡"},{trigger:{symbol:"\\spadesuit"},parse:"♠"},{trigger:{symbol:"\\diamondsuit"},parse:"♢"},{trigger:{symbol:"\\sharp"},parse:"♯"},{trigger:{symbol:"\\flat"},parse:"♭"},{trigger:{symbol:"\\natural"},parse:"♮"}],trigonometry:[{name:"Arcsin",trigger:"\\arcsin",arguments:"implicit",parse:ze},{name:"Arccos",trigger:"\\arccos",arguments:"implicit",parse:ze},{name:"Arctan",trigger:"\\arctan",arguments:"implicit",parse:ze},{name:"Arctan",trigger:"\\arctg",arguments:"implicit",parse:ze},{name:"Arccot",trigger:"\\arcctg",arguments:"implicit",parse:ze},{name:"Arcsec",trigger:"\\arcsec",arguments:"implicit",parse:ze},{name:"Arccsc",trigger:"\\arccsc",arguments:"implicit",parse:ze},{name:"Arsinh",trigger:"\\arsinh",arguments:"implicit",parse:ze},{name:"Arcosh",trigger:"\\arcosh",arguments:"implicit",parse:ze},{name:"Artanh",trigger:"\\artanh",arguments:"implicit",parse:ze},{name:"Arsech",trigger:"\\arsech",arguments:"implicit",parse:ze},{name:"Arcsch",trigger:"\\arcsch",arguments:"implicit",parse:ze},{name:"Cosh",trigger:"\\ch",arguments:"implicit",parse:ze},{name:"Cosec",trigger:"\\cosec",arguments:"implicit",parse:ze},{name:"Cosh",trigger:"\\cosh",arguments:"implicit",parse:ze},{name:"Cot",trigger:"\\cot",arguments:"implicit",parse:ze},{name:"Cot",trigger:"\\cotg",arguments:"implicit",parse:ze},{name:"Coth",trigger:"\\coth",arguments:"implicit",parse:ze},{name:"Csc",trigger:"\\csc",arguments:"implicit",parse:ze},{name:"Cot",trigger:"\\ctg",arguments:"implicit",parse:ze},{name:"Coth",trigger:"\\cth",arguments:"implicit",parse:ze},{name:"Sec",trigger:"\\sec",arguments:"implicit",parse:ze},{name:"Sinh",trigger:"\\sinh",arguments:"implicit",parse:ze},{name:"Sinh",trigger:"\\sh",arguments:"implicit",parse:ze},{name:"Tan",trigger:"\\tan",arguments:"implicit",parse:ze},{name:"Tan",trigger:"\\tg",arguments:"implicit",parse:ze},{name:"Tanh",trigger:"\\tanh",arguments:"implicit",parse:ze},{name:"Tanh",trigger:"\\th",arguments:"implicit",parse:ze},{name:"Cos",trigger:"\\cos",arguments:"implicit",parse:ze},{name:"Sin",trigger:"\\sin",arguments:"implicit",parse:ze}]},Re={precision:15,positiveInfinity:"\\infty",negativeInfinity:"-\\infty",notANumber:"\\operatorname{NaN}",decimalMarker:".",groupSeparator:",",exponentProduct:"\\cdot",beginExponentMarker:"10^{",endExponentMarker:"}",notation:"auto",truncationMarker:"\\ldots",beginRepeatingDigits:"\\overline{",endRepeatingDigits:"}",imaginaryNumber:"\\imaginaryI"},Ze={invisibleOperator:L,skipSpace:!0,parseArgumentsOfUnknownLatexCommands:!0,parseNumbers:!0,promoteUnknownSymbols:/^[a-zA-Z]$/,promoteUnknownFunctions:/^[fg]$/,ignoreCommands:["\\displaystyle","\\!","\\:","\\enskip","\\quad","\\,","\\;","\\enspace","\\qquad","\\selectfont","\\tiny","\\scriptsize","\\footnotesize","\\small","\\normalsize","\\large","\\Large","\\LARGE","\\huge","\\Huge"],idempotentCommands:["\\left","\\right","\\mleft","\\mright","\\middle","\\bigl","\\bigm","\\bigr","\\Bigl","\\Bigm","\\Bigr","\\biggl","\\biggm","\\biggr","\\Biggl","\\Biggm","\\Biggr"],invisiblePlusOperator:O,preserveLatex:!1},Qe={invisibleMultiply:"",invisiblePlus:"",multiply:"\\times"};function He(e,i){var n;let t=e;for(let e=0;e<i.length;e++){let r=null!==(n=i[e])&&void 0!==n?n:"";if(/[a-zA-Z*]/.test(r[0])){const i=t.match(new RegExp("(.*)#"+Number(e+1).toString()));i&&/\\[a-zA-Z*]+/.test(i[1])&&(r=" "+r);}t=t.replace("#"+Number(e+1).toString(),r);}return t}class $e{constructor(e,i,n,t){let r;this.index=0,this.options={...Re,...Ze,...i},this.tokens=e,this.onError=e=>t({...e,before:this.latexBefore(),after:this.latexAfter()}),this.dictionary=n,this.invisibleOperatorPrecedence=0,this.options.invisibleOperator&&(r=this.dictionary.name.get(this.options.invisibleOperator),void 0===r?t({code:"unknown-operator",arg:"invisible operator "+this.options.invisibleOperator}):void 0===r.precedence?t({code:"expected-operator",arg:"invisible operator "+this.options.invisibleOperator}):this.invisibleOperatorPrecedence=r.precedence);}clone(e,i){return new $e(this.tokens.slice(e,i),this.options,this.dictionary,this.onError)}balancedClone(e,i,n=!0){if(!this.matchAll(e))return n||this.onError({code:"syntax-error",arg:"Expected "+a(e)}),null;const t=this.index;let r=t,o=1;for(;!this.atEnd&&0!==o;)this.skipSpace(),r=this.index,this.matchAll(i)?o-=1:this.matchAll(e)?o+=1:this.next();return 0!==o?(n||this.onError({code:"unbalanced-symbols",arg:a(e)+a(i)}),this.index=t,null):this.clone(t,r)}get atEnd(){return this.index>=this.tokens.length}get peek(){return this.tokens[this.index]}latex(e,i){return a(this.tokens.slice(e,i))}latexAhead(e){return a(this.tokens.slice(this.index,this.index+e))}latexBefore(){return this.latex(0,this.index)}latexAfter(){return this.latex(this.index)}lookAhead(){let e=Math.min(this.dictionary.lookahead,this.tokens.length-this.index);const i=[];for(;e>0;)i[e]=this.latexAhead(e--);return i}peekDefinition(e){let i;i="operator"===e?this.lookAhead().map(((e,i)=>{var n,t,r,o,s;return null!==(o=null!==(t=null===(n=this.dictionary.infix[i])||void 0===n?void 0:n.get(e))&&void 0!==t?t:null===(r=this.dictionary.postfix[i])||void 0===r?void 0:r.get(e))&&void 0!==o?o:null===(s=this.dictionary.prefix[i])||void 0===s?void 0:s.get(e)})):this.lookAhead().map(((i,n)=>{var t;return null===(t=this.dictionary[e][n])||void 0===t?void 0:t.get(i)}));for(let e=i.length;e>0;e--)if(void 0!==i[e])return [i[e],e];return [null,0]}next(){return this.tokens[this.index++]}skipSpace(){if(!this.atEnd&&"<{>"===this.peek&&"<}>"===this.tokens[this.index+1])return this.index+=2,this.skipSpace(),!0;let e=!1;for(;!this.atEnd&&(this.options.ignoreCommands.includes(this.peek)||this.options.idempotentCommands.includes(this.peek));)this.index+=1,this.skipSpace(),e=!0;if(!this.options.skipSpace)return !1;for(;this.match("<space>");)e=!0;return e&&this.skipSpace(),e}match(e){return this.tokens[this.index]===e&&(this.index++,!0)}matchAll(e){let i=!0;"string"==typeof e&&(e=[e]);let n=0;do{i=this.tokens[this.index+n]===e[n++];}while(i&&n<e.length);return i&&(this.index+=n),i}matchAny(e){return e.includes(this.tokens[this.index])?this.tokens[this.index++]:""}matchWhile(e){const i=[];for(;e.includes(this.tokens[this.index]);)i.push(this.tokens[this.index++]);return i}matchSign(){let e=!1,i=!1;for(;!i;)this.skipSpace()?i=!1:this.match("-")?(e=!e,i=!1):i=!this.match("+");return e?"-":"+"}matchDecimalDigits(){let e="",i=!1;for(;!i;)if(e+=this.matchWhile(["0","1","2","3","4","5","6","7","8","9"]).join(""),i=!0,this.options.groupSeparator){const e=this.index;this.match(this.options.groupSeparator)&&(/[0-9]/.test(this.peek)?i=!1:this.index=e);}return e}matchSignedInteger(){const e=this.index,i=this.matchSign(),n=this.matchDecimalDigits();return n?("-"===i?"-":"")+n:(this.index=e,"")}matchExponent(){const e=this.index;let i="";if(this.matchAny(["e","E","d","D"])){const e=this.matchSignedInteger();e&&(i="e"+e);}if(i)return i;if(this.match("\\times")&&(this.skipSpace(),this.match("1")&&this.match("0")&&this.match("^"))){if(/[0-9]/.test(this.peek))return "e"+this.next();if(this.match("<{>")){this.skipSpace();const e=this.matchSignedInteger();if(this.skipSpace(),this.match("<}>")&&e)return "e"+e}}return this.index=e,""}matchNumber(){var e,i;if(!this.options.parseNumbers)return "";const n=this.index,t=this.matchSign();let r=this.matchDecimalDigits();if(!r)return this.index=n,"";r=("-"===t?"-":"")+r;let o=!1,s=!1;this.match(null!==(e=this.options.decimalMarker)&&void 0!==e?e:"")&&(o=!0,r+="."+(null!==(i=this.matchDecimalDigits())&&void 0!==i?i:"0"));const a=this.matchExponent();return a&&(s=!0),r?r.length+a.length>12?o||s?r+a+"d":r+"n":r+a:(this.index=n,"")}matchOperator(e,i=null,n=0){const[t,r]=this.peekDefinition(e);if(null===t)return null;if("function"==typeof t.parse){let e=null;return [i,e]=t.parse(i,this,n),null===e?null:this.applyInvisibleOperator(i,e)}let o=t.precedence;if(void 0===o||o<n)return null;o+="left"===t.associativity?1:0,this.index+=r;const s=this.matchExpression(o);return this.applyInvisibleOperator(...this.applyOperator(t.parse,i,s))}matchArguments(e){if(!e)return null;const i=this.index;let n=null;const t=this.matchMatchfixOperator();if("group"===e&&"Parentheses"===te(t))n=oe(t);else if("implicit"===e)if("Parentheses"===te(t))n=oe(t);else if(null!==t)n=[t];else {const e=this.matchPrimary();null!==e&&(n=[e]);}else this.index=i;return n}matchMatchfixOperator(){const[e]=this.peekDefinition("matchfix");if(null===e)return null;if("function"==typeof e.parse)return this.applyInvisibleOperator(...e.parse(null,this,0));const i="object"==typeof e.trigger?e.trigger.matchfix:e.trigger;if(!i||!e.closeFence||!e.parse)return null;const n=this.matchBalancedExpression(i,e.closeFence,this.onError);return n?[e.parse,n]:[e.parse]}matchDefinition(e){const[i,n]=this.peekDefinition(e);if("function"==typeof(null==i?void 0:i.parse)){const[,e]=i.parse(null,this,0);return [i,e]}return this.index+=n,[i,null]}matchSymbol(){var e,i,n,t;const[r,o]=this.matchDefinition("symbol");if(null!==o)return o;if(null===r){if(null===(e=this.options.promoteUnknownFunctions)||void 0===e?void 0:e.test(this.peek)){const e=this.next(),i=this.matchMatchfixOperator();return null===i?e:"Parentheses"!==te(i)?null:[e,...oe(i)]}return (null===(i=this.options.promoteUnknownSymbols)||void 0===i?void 0:i.test(this.peek))?this.next():this.matchUnknownLatexCommand()}const s=[],a=[];let l,u=null!==(n=r.optionalLatexArg)&&void 0!==n?n:0;for(;u>0;)l=this.matchOptionalLatexArgument(),null!==l&&a.push(l),u--;for(u=null!==(t=r.requiredLatexArg)&&void 0!==t?t:0;u>0;)l=this.matchRequiredLatexArgument(),null===l&&this.onError({code:"expected-argument"}),null!==l&&s.push(l),u--;const c=this.matchArguments(r.arguments);return null===c?0===s.length&&0===a.length?r.parse:[r.parse,...s,...a]:[r.parse,...s,...c,...a]}matchOptionalLatexArgument(){return this.skipSpace(),this.matchBalancedExpression("[","]")}matchRequiredLatexArgument(){return this.skipSpace(),this.matchBalancedExpression("<{>","<}>")||(/^[0-9]$/.test(this.peek)?parseFloat(this.next()):/^[^\\#]$/.test(this.peek)?this.next():this.matchSymbol())}matchSupsub(e){if(null===e)return null;let i=null;return this.skipSpace(),[["^","superfix"],["_","subfix"]].forEach((n=>{var t,r,o;if(null!==i)return;const[s,a]=n,l=this.index;if(!this.match(s))return;const u=this.index;let c,m=0;if(this.match("<{>")?([c,m]=this.peekDefinition(a),c?"function"==typeof c.parse?i=c.parse(e,this,0)[1]:(this.index+=m,this.match("<}>")?i=[null!==(t=c.parse)&&void 0!==t?t:c.name,e]:this.index=u):this.index=u):([c,m]=this.peekDefinition(a),c?"function"==typeof c.parse?i=c.parse(e,this,0)[1]:(this.index+=m,i=[null!==(r=c.parse)&&void 0!==r?r:c.name,e]):this.index=u),null===i&&(c=null===(o=this.dictionary.infix[1])||void 0===o?void 0:o.get(s),"function"==typeof(null==c?void 0:c.parse)?(this.index=l,i=c.parse(e,this,0)[1]):"string"==typeof(null==c?void 0:c.parse)?([e,i]=this.applyOperator(c.parse,e,this.matchRequiredLatexArgument()),i=this.applyInvisibleOperator(e,i)):i=this.applyInvisibleOperator(e,s)),null!==i){const e=this.matchArguments(null==c?void 0:c.arguments);null!==e&&(i=[i,...e]);}})),i}matchPostfix(e){if(null===e)return null;const[i,n]=this.peekDefinition("postfix");return null==i?null:"function"==typeof i.parse?([,e]=i.parse(e,this,0),null===e?null:e):(this.index+=n,[i.parse,e])}matchString(){let e="",i=this.atEnd;for(;!i;){if(this.match("<space>"))e+=" ";else {const n=this.peek;"]"===n?i=!0:/^<({|}|\$|\$\$|space)>$/.test(n)?"\\"===n[0]?(this.onError({code:"unexpected-command"}),e+=this.next()):i=!0:e+=this.next();}i=i||this.atEnd;}return e}matchEnvironmentName(e,i){if(this.match(e)){const e=this.index;if(this.match("<{>")){const e=this.matchString();if(this.match("<}>")&&e===i)return !0}this.index=e;}return !1}matchTabular(){const e=["list"];let i=["list"],n=null,t=!1;for(;!this.atEnd&&!t;)if(this.match("&"))i.push(null!=n?n:T),n=null;else if(this.match("\\\\")||this.match("\\cr"))this.skipSpace(),this.matchOptionalLatexArgument(),null!==n&&i.push(n),e.push(i),i=["list"],n=null;else {const e=this.matchExpression();null===e&&(t=!0),n=null!==n?this.applyInvisibleOperator(n,e):e;}return i.length>1&&e.push(i),e}matchEnvironment(){var e;if(this.match("\\begin")&&this.match("<{>")){const i=this.matchString();if(this.match("<}>")){const n=this.index;let t=this.index,r=1;for(;!this.atEnd&&0!==r;)t=this.index,this.matchEnvironmentName("\\begin",i)?r+=1:this.matchEnvironmentName("\\end",i)?r-=1:this.next();const o=this.dictionary.environment.get(i);return "function"==typeof(null==o?void 0:o.parse)?o.parse(null,this.clone(n,t),0)[1]:null!==(e=null==o?void 0:o.parse)&&void 0!==e?e:null}}return null}applyOperator(e,i,n){var t,r,o,s;const a=this.dictionary.name.get(e);if(void 0===a)return this.onError({code:"unknown-operator"}),[i,n];if(void 0!==(null===(t=a.trigger)||void 0===t?void 0:t.prefix)&&null===i&&null!==n)return [null,[a.name,n]];if(void 0!==(null===(r=a.trigger)||void 0===r?void 0:r.postfix)&&null!==i)return [null,[a.name,i]];if(void 0!==(null===(o=a.trigger)||void 0===o?void 0:o.matchfix)||void 0!==(null===(s=a.trigger)||void 0===s?void 0:s.infix)){if("non"===a.associativity)return [null,[e,null!=i?i:"Missing",null!=n?n:"Missing"]];if(te(i)===e){if("both"===a.associativity){if(te(n)===e){if(Array.isArray(i))return [null,i.concat(oe(n))];if(B(i))return [null,i.fn.concat(oe(n))]}else n&&(Array.isArray(i)&&i.push(n),B(i)&&i.fn.push(n));return [null,i]}return "left"===a.associativity?[null,[e,null!=i?i:P,null!=n?n:P]]:Array.isArray(i)?[null,[e,i[1],[e,i[2],null!=n?n:P]]]:(B(i)&&(i.fn[2]=[e,i.fn[2],null!=n?n:P]),[null,i])}return te(n)===e?"both"===a.associativity?(Array.isArray(n)&&i&&n.splice(1,0,i),B(n)&&i&&n.fn.splice(1,0,i),[null,n]):"right"===a.associativity?[null,[e,null!=i?i:P,null!=n?n:P]]:Array.isArray(n)?[null,[e,n[1],[e,n[2],null!=i?i:P]]]:(B(n)&&(n.fn[2]=[e,n.fn[2],null!=i?i:P]),[null,n]):[null,[e,null!=i?i:"Missing",null!=n?n:"Missing"]]}return [i,null]}applyInvisibleOperator(e,i){if(null===e)return i;if(null===i)return e;if(this.options.invisiblePlusOperator&&("number"==typeof e||H(e))&&function(e){var i,n;const t=re(e);if(null!==t&&["ThreeQuarter","TwoThird","Half","Third","Quarter"].includes(t))return !0;if(te(e)!==z)return !1;const r=null!==(i=G(le(e,1)))&&void 0!==i?i:NaN,o=null!==(n=G(le(e,2)))&&void 0!==n?n:NaN;return Number.isInteger(r)&&Number.isInteger(o)}(i))return [e,i]=this.applyOperator(this.options.invisiblePlusOperator,e,i),null===e?i:null;if(this.options.invisibleOperator)return [e,i]=this.applyOperator(this.options.invisibleOperator,e,i),null===e?i:null;let n=["LatexTokens"];return "LatexTokens"===te(e)?n=n.concat(oe(e)):n.push(e),null!==i&&("LatexTokens"===te(i)?n=n.concat(oe(i)):n.push(i)),this.options.invisibleOperator&&this.onError({code:"unexpected-sequence"}),n}matchUnknownLatexCommand(){var e;const i=this.peek;if(!i||"\\"!==i[0])return null;if(this.next(),"\\operatorname"===i){if(this.skipSpace(),"<{>"===this.peek){let e="";for(this.next();!this.atEnd&&"<}>"!==this.tokens[this.index];)e+=this.next();return e}return null!==(e=this.next())&&void 0!==e?e:P}const n=[],t=[];let r=!1;do{r=!0;let e=this.matchOptionalLatexArgument();null!==e&&(n.push(e),r=!1),this.skipSpace(),"<{>"===this.peek&&(e=this.matchRequiredLatexArgument(),null!==e&&(t.push(e),r=!1));}while(!r);return n.length>0||t.length>0?[i,...t,...n]:i}matchPrimary(e){let i=null;const n=this.index,t=this.matchNumber();t&&(i={num:t}),null===i&&(i=this.matchMatchfixOperator()),null===i&&(i=this.matchEnvironment()),null===i&&(i=this.matchSymbol());let r=null;do{r=this.matchSupsub(i),i=null!=r?r:i;}while(null!==r);let o=null;do{o=this.matchPostfix(i),i=null!=o?o:i;}while(null!==o);return this.decorate(i,n)}matchBalancedExpression(e,i,n){const t=this.balancedClone(e,i);if(!t)return null==n||n({code:"unbalanced-symbols",arg:a(e)+a(i)}),null;const r=t.matchExpression();return t.atEnd||null==n||n({code:"unbalanced-symbols",arg:a(e)+a(i)}),r}matchExpression(e=0){let i=null;const n=this.index;this.skipSpace(),i=this.matchPrimary(e),null===i&&(i=this.matchOperator("prefix"));let t=!1;for(;!this.atEnd&&!t;){this.skipSpace();let n=this.matchOperator("infix",i,e);if(null===n&&null!==i){const[e]=this.peekDefinition("operator");if(null===e){const e=this.matchExpression(this.invisibleOperatorPrecedence);null!==e&&(n=this.applyInvisibleOperator(i,e));}}null!==n?i=n:t=!0;}return this.decorate(i,n)}decorate(e,i){if(null===e)return null;if(this.options.preserveLatex){const n=this.latex(i,this.index);Array.isArray(e)?e={latex:n,fn:e}:"number"==typeof e?e={latex:n,num:Number(e).toString()}:"string"==typeof e?e={latex:n,sym:e}:"object"==typeof e&&null!==e&&(e.latex=n);}return e}}function je(e,i){const n=e.length,t=e;e=e.slice(0,-1);for(let n=0;n<e.length-16;n++){const t=e.substr(0,n);for(let r=0;r<17;r++){const o=e.substr(n,r+1),s=Math.floor((e.length-t.length)/o.length);if(s>1&&(t+o.repeat(s+1)).startsWith(e))return "0"===o?t.replace(/(\d{3})/g,"$1"+i.groupSeparator):t.replace(/(\d{3})/g,"$1"+i.groupSeparator)+i.beginRepeatingDigits+o+i.endRepeatingDigits}}const r=n>i.precision-1;return e=t,r&&(e=e.substr(0,i.precision-1)),i.groupSeparator&&(e=e.replace(/(\d{3})/g,"$1"+i.groupSeparator)).endsWith(i.groupSeparator)&&(e=e.slice(0,-i.groupSeparator.length)),r?e+i.truncationMarker:e}function Be(e,i){var n;return e?i.beginExponentMarker?i.beginExponentMarker+e+(null!==(n=i.endExponentMarker)&&void 0!==n?n:""):"10^{"+e+"}":""}class Ue{constructor(e,i,n){this.level=-1,this.options=e,e.invisibleMultiply&&(/#1/.test(e.invisibleMultiply)&&/#2/.test(e.invisibleMultiply)||n({code:"expected-argument",arg:"invisibleMultiply"})),this.onError=n,this.dictionary=i;}wrap(e,i){if(null===e)return "";if(void 0===i)return "("+this.serialize(e)+")";if("number"==typeof e||H(e)||"string"==typeof e||$(e))return this.serialize(e);const n=te(e);if(n&&"Parentheses"!==n){const t=this.dictionary.name.get(n);if(t&&void 0!==t.precedence&&t.precedence<i)return this.wrapString(this.serialize(e),(this.level,"paren"))}return this.serialize(e)}wrapShort(e){if(null===e)return "";const i=this.serialize(e);return "Parentheses"===te(e)||"number"==typeof e||H(e)||/(^(.|\\[a-zA-Z*]+))$/.test(i)?i:this.wrapString(i,(this.level,"paren"))}wrapString(e,i){return "none"===i?e:"("+e+")"}serializeSymbol(e,i){const n=ie(e);if(!n){if("string"==typeof(null==i?void 0:i.serialize))return i.serialize;const n=re(e);if(null===n)return "";switch(function(e,i){const n=re(e);return null===n?"asis":n.length>1?"upright":"asis"}(e,this.level)){case"upright":return "\\operatorname{"+n+"}";default:return n}}const t=oe(e);if(!i){if("string"==typeof n&&n.length>0&&"\\"===n[0]){let e=n;for(const i of t)e+="{"+this.serialize(i)+"}";return e}return `${this.serialize(n)}(${t.map((e=>this.serialize(e))).join(", ")})`}if(i.requiredLatexArg>0){let e="",n="",r=0;for(;r<i.requiredLatexArg;)n+="{"+this.serialize(t[r++])+"}";for(;r<Math.min(t.length,i.optionalLatexArg+i.requiredLatexArg);){const i=this.serialize(t[1+r++]);i&&(e+="["+i+"]");}return i.serialize+(e+n)}return this.level,i.serialize+this.serialize(["Parentheses",...t])}serializeDictionary(e){return `\\left[\\begin{array}{lll}${Object.keys(e).map((i=>`\\textbf{${i}} & \\rightarrow & ${this.serialize(e[i])}`)).join("\\\\")}\\end{array}\\right]`}serialize(e){if(null===e)return "";this.level+=1;const i=(()=>{var i,n,t,r;const o=function(e,i){var n,t;let r;if("number"==typeof e)r=e;else {if(!H(e))return "";r=e.num;}if(r===1/0||"Infinity"===r||"+Infinity"===r)return i.positiveInfinity;if(r===-1/0||"-Infinity"===r)return i.negativeInfinity;if("NaN"===r||"number"==typeof r&&Number.isNaN(r))return i.notANumber;if("number"==typeof r)return "engineering"===i.notation?function(e,i){if(0===e)return "0";const n=Math.abs(e);let t=Math.round(Math.log10(n));t-=t%3,n<1e3&&(t=0);const r=n/Math.pow(10,t);let o="";const s=r.toString().match(/^(.*)\.(.*)$/);(null==s?void 0:s[1])&&s[2]&&(o=s[1]+i.decimalMarker+s[2]),i.groupSeparator&&(o=je(r.toExponential(),i));let a="";return 0!==t&&(a=Be(t.toString(),i)),(e<0?"-":"")+o+a}(r,i):function(e,i){let n,t=e.match(/^(.*)[e|E]([-+]?[0-9]+)$/i);(null==t?void 0:t[1])&&t[2]&&(n=Be(t[2],i),n&&(n=i.exponentProduct+n));let r=e,o="";return t=(n?t[1]:e).match(/^(.*)\.(.*)$/),(null==t?void 0:t[1])&&t[2]&&(r=t[1],o=t[2]),i.groupSeparator&&(r=r.replace(/\B(?=(\d{3})+(?!\d))/g,i.groupSeparator),o=je(o,i)),o&&(o=i.decimalMarker+o),r+o+(null!=n?n:"")}(r.toString(),i);/[a-zA-Z]$/.test(r)&&(r=r.slice(0,-1));let o="";for("-"===r[0]?(o="-",r=r.substr(1)):"+"===r[0]&&(r=r.substr(1));"0"===r[0];)r=r.substr(1);if(0===r.length)return o+"0";"."===r[0]&&(r="0"+r);let s="";if(r.indexOf(".")>=0){const e=r.match(/(\d*)\.(\d*)([e|E]([-+]?[0-9]*))?/);if(!e)return "";const t=e[1],a=e[2];if(s=null!==(n=e[4])&&void 0!==n?n:"","0"===t){let e=0;for(;"0"===a[e]&&e<a.length;)e+=1;let n="";if(e<=4)n="0"+i.decimalMarker,n+=a.substr(0,e),n+=je(r.substr(n.length),i);else if(e+1>=i.precision)n="0",o="";else {n=r[e];const t=je(r.substr(e+1),i);t&&(n+=i.decimalMarker+t);}"0"!==n&&(!(r.length-1>i.precision)||i.endRepeatingDigits&&n.endsWith(i.endRepeatingDigits)||!i.truncationMarker||n.endsWith(i.truncationMarker)||(n+=i.truncationMarker),e>4&&(n+=i.exponentProduct+Be((1-e).toString(),i))),r=n;}else {r=t.replace(/\B(?=(\d{3})+(?!\d))/g,i.groupSeparator);const e=je(a,i);e&&(r+=i.decimalMarker+e);}}else if(r.length>i.precision){const e=r.length;let n=r[0];const t=je(r.substr(1),i);t&&(n+=i.decimalMarker+t,i.truncationMarker&&!n.endsWith(i.truncationMarker)&&i.endRepeatingDigits&&!n.endsWith(i.endRepeatingDigits)&&(n+=i.truncationMarker)),"1"!==n?n+=i.exponentProduct:n="",r=n+Be((e-1).toString(),i);}else {const e=r.match(/([0-9]*)\.?([0-9]*)([e|E]([-+]?[0-9]+))?/);e&&(r=e[1],e[2]&&(r+=i.decimalMarker+e[2]),s=null!==(t=e[4])&&void 0!==t?t:""),r=r.replace(/\B(?=(\d{3})+(?!\d))/g,i.groupSeparator);}const a=Be(s,i);return o+r+(a?i.exponentProduct+a:"")}(e,this.options);if(o)return o;const l=J(e);if(null!==l)return `\\text{${l}}`;const u=re(e);if(null!==u)return this.serializeSymbol(e,this.dictionary.name.get(u));const c=ce(e);if(null!==c)return this.serializeDictionary(c);const m=te(e);if(m){if("\\"===m[0]){const i=oe(e);return 0===i.length?m:m+"{"+i.map((e=>this.serialize(e))).filter((e=>Boolean(e))).join("}{")+"}"}const o=this.dictionary.name.get(m);if(o){let l="";return "function"==typeof o.serialize&&(l=o.serialize(this,e)),l||void 0===o.precedence&&!(null===(i=o.trigger)||void 0===i?void 0:i.superfix)&&!(null===(n=o.trigger)||void 0===n?void 0:n.subfix)||(l=function(e,i,n){var t,r,o,s,a;let l="";const u=ue(i),c=te(i);if((null===(t=n.trigger)||void 0===t?void 0:t.superfix)||(null===(r=n.trigger)||void 0===r?void 0:r.subfix))return 1!==u&&e.onError({code:"operator-requires-one-operand",arg:e.serializeSymbol(c)}),He(n.serialize,[e.serialize(le(i,1))]);if(null===(o=n.trigger)||void 0===o?void 0:o.postfix)return 1!==u&&e.onError({code:"postfix-operator-requires-one-operand",arg:e.serializeSymbol(c)}),He(n.serialize,[e.wrap(le(i,1),n.precedence)]);if(null===(s=n.trigger)||void 0===s?void 0:s.prefix)return 1!==u&&e.onError({code:"prefix-operator-requires-one-operand",arg:e.serializeSymbol(c)}),He(n.serialize,[e.wrap(le(i,1),n.precedence+1)]);if(null===(a=n.trigger)||void 0===a?void 0:a.infix){l=e.wrap(le(i,1),n.precedence);for(let t=2;t<u+1;t++){const r=le(i,t);null!==r&&(l=He(n.serialize,[l,e.wrap(r,n.precedence)]));}}return l}(this,e,o)),!l&&(null===(t=o.trigger)||void 0===t?void 0:t.matchfix)&&(l=function(e,i,n){var t,r;let o=[];if("string"==typeof(null===(t=n.trigger)||void 0===t?void 0:t.matchfix)?o.push(null===(r=n.trigger)||void 0===r?void 0:r.matchfix):n.trigger&&Array.isArray(n.trigger.matchfix)&&(o=[...n.trigger.matchfix]),ue(i)>=1){let t="";for(const r of oe(i))r&&(o.push(t),o.push(e.serialize(r)),t=n.separator);}return o.push(a(n.closeFence)),s(o)}(this,e,o)),!l&&(null===(r=o.trigger)||void 0===r?void 0:r.symbol)&&(l=this.serializeSymbol(e,o)),l}}if(Array.isArray(e)||B(e))return this.serializeSymbol(e);this.onError({code:"syntax-error",arg:JSON.stringify(e)});})();return this.level-=1,null!=i?i:""}}class Ge{constructor(e){var i,n;this.onError=null!==(i=null==e?void 0:e.onError)&&void 0!==i?i:e=>{"undefined"!=typeof window&&(!e.before||e.after);};const t={...null!=e?e:{}};delete t.dictionary,delete t.onError,this.options={...Re,...Qe,...Ze,...t},this.dictionary=function(e,i){var n,t,r,o,s,a,l,u,c,m,f,h,p,g,d;const v={lookahead:1,name:new Map,prefix:[],infix:[],postfix:[],matchfix:[],superfix:[],subfix:[],symbol:[],environment:new Map};for(const x of e)void 0===x.parse&&(x.parse=x.name),"string"==typeof x.trigger&&(x.trigger={symbol:x.trigger}),"string"==typeof x.serialize&&void 0!==(null===(n=x.trigger)||void 0===n?void 0:n.symbol)&&/#[0-9]/.test(x.serialize)&&i({code:"unexpected-argument",arg:x.name}),void 0===x.serialize&&(void 0!==(null===(t=x.trigger)||void 0===t?void 0:t.postfix)?x.serialize="#1"+Le(x.trigger.postfix):void 0!==(null===(r=x.trigger)||void 0===r?void 0:r.prefix)?x.serialize=Le(x.trigger.prefix)+"#1":void 0!==(null===(o=x.trigger)||void 0===o?void 0:o.infix)?x.serialize="#1"+Le(x.trigger.infix)+"#2":void 0!==(null===(s=x.trigger)||void 0===s?void 0:s.symbol)?x.serialize=Le(x.trigger.symbol):void 0!==(null===(a=x.trigger)||void 0===a?void 0:a.superfix)?x.serialize="#1^{"+Le(null===(l=x.trigger)||void 0===l?void 0:l.superfix)+"}":void 0!==(null===(u=x.trigger)||void 0===u?void 0:u.subfix)?x.serialize="#1_{"+Le(null===(c=x.trigger)||void 0===c?void 0:c.subfix)+"}":x.serialize=""),void 0!==(null===(m=x.trigger)||void 0===m?void 0:m.infix)&&(void 0===x.precedence&&i({code:"syntax-error",arg:"Infix operators require a precedence"}),x.associativity||(x.associativity="non")),void 0!==(null===(f=x.trigger)||void 0===f?void 0:f.symbol)&&(x.arguments=null!==(h=x.arguments)&&void 0!==h?h:"",x.optionalLatexArg=null!==(p=x.optionalLatexArg)&&void 0!==p?p:0,x.requiredLatexArg=null!==(g=x.requiredLatexArg)&&void 0!==g?g:0),void 0!==(null===(d=x.trigger)||void 0===d?void 0:d.matchfix)&&("function"===x.parse||x.closeFence||i({code:"syntax-error",arg:"Matchfix operators require a close fence or a custom parse function"})),void 0!==x.trigger&&(["infix","prefix","postfix","symbol","matchfix","superfix","subfix"].forEach((e=>{if(x.trigger[e]){const n=(i=x.trigger[e],Array.isArray(i)?i.length:1);v.lookahead=Math.max(v.lookahead,n),void 0===v[e][n]&&(v[e][n]=new Map),v[e][n].set(Le(x.trigger[e]),x);}var i;})),void 0!==x.trigger.environment&&v.environment.set(x.trigger.environment,x)),void 0!==x.name?v.name.set(Le(x.name),x):"string"==typeof x.parse&&v.name.set(x.parse,x),void 0!==x.trigger||x.name||i({code:"syntax-error",arg:"Need at least a trigger or a name"});return v}(null!==(n=null==e?void 0:e.dictionary)&&void 0!==n?n:Ge.getDictionary(),this.onError);}static getDictionary(e="all"){if("all"===e){let e=[];for(const i of Object.keys(_e))e=[...e,..._e[i]];return e}return _e[e]?[..._e[e]]:[]}parse(e){var i;const n=new $e(o(e,[]),this.options,this.dictionary,this.onError),t=n.matchExpression();return n.atEnd||null===(i=this.onError)||void 0===i||i.call(this,{code:"syntax-error"}),null!=t?t:""}serialize(e){return new Ue(this.options,this.dictionary,this.onError).serialize(e)}}function Ve(e,i){return new Ge(i).serialize(e)}const ii={Anything:[],Expression:"Anything",Domain:["Set","Symbol"],ParametricDomain:["Domain","Function"],MaybeBoolean:"Expression",Boolean:"MaybeBoolean",Collection:"Expression",Dictionary:"Collection",List:"Collection",Sequence:"Collection",Tuple:"Collection",Set:"Collection",FiniteSet:"Set",InfiniteSet:"Set",EmptySet:"FiniteSet",String:"Expression",Symbol:"String",Function:"Expression",Predicate:"Function",LogicalFunction:"Predicate",TranscendentalFunction:"Function",AlgebraicFunction:"Function",PeriodicFunction:"Function",TrigonometricFunction:["PeriodicFunction","TranscendentalFunction"],HyperbolicFunction:"TranscendentalFunction",MonotonicFunction:"Function",StrictMonotonicFunction:"MonotonicFunction",ContinuousFunction:"Function",DifferentiableFunction:"ContinuousFunction",InfinitelyDifferentiableFunction:"DifferentiableFunction",RationalFunction:["AlgebraicFunction","ContinuousFunction"],PolynomialFunction:["AlgebraicFunction","InfinitelyDifferentiableFunction"],QuadraticFunction:"PolynomialFunction",LinearFunction:["QuadraticFunction","MonotonicFunction"],ConstantFunction:"LinearFunction",Number:"Set",ImaginaryNumber:["ComplexNumber","InfiniteSet"],ComplexNumber:"ExtendedComplexNumber",ExtendedComplexNumber:"Number",ComplexInfinity:"ExtendedComplexNumber",NumberZero:["CompositeNumber","ImaginaryNumber","FiniteSet"],NaturalNumber:"Integer",CompositeNumber:"NaturalNumber",PrimeNumber:"NaturalNumber",Integer:["RationalNumber","ExtendedInteger"],ExtendedInteger:"ExtendedRationalNumber",RationalNumber:["AlgebraicNumber","ExtendedRationalNumber"],IrrationalNumber:"RealNumber",TranscendentalNumber:["IrrationalNumber","ImaginaryNumber"],AlgebraicNumber:"IrrationalNumber",RealNumber:["ComplexNumber","ExtendedRealNumber"],ExtendedRealNumber:"ExtendedComplexNumber",ExtendedNaturalNumber:"ExtendedInteger",ExtendedRationalNumber:"ExtendedRealNumber",SignedInfinity:"ExtendedNaturalNumber",Tensor:"Expression",Scalar:"Tensor",Vector:"Matrix",Row:"Vector",Column:"Vector",Matrix:"Tensor",ComplexTensor:"Tensor",RealTensor:"ComplexTensor",IntegerTensor:"RealTensor",LogicalTensor:"IntegerTensor",SquareMatrix:"Matrix",MonomialMatrix:"SquareMatrix",TriangularMatrix:"SquareMatrix",UpperTriangularMatrix:"TriangularMatrix",LowerTriangularMatrix:"TriangularMatrix",PermutationMatrix:["MonomialMatrix","LogicalTensor","OrthogonalMatrix"],OrthogonalMatrix:["SquareMatrix","RealTensor"],DiagonalMatrix:["UpperTriangularMatrix","LowerTriangularMatrix"],IdentityMatrix:["DiagonalMatrix","SymmetricMatrix","PermutationMatrix"],ZeroMatrix:["DiagonalMatrix","SymmetricMatrix","PermutationMatrix"],SymmetricMatrix:["HermitianMatrix","SquareMatrix","RealTensor"],HermitianMatrix:"ComplexTensor",Quaternion:["SquareMatrix","ComplexTensor"]},ni={Function:"Q11348",ComplexNumber:"Q26851286",Integer:"Q47007735",ImaginaryNumber:"Q47310259",NaturalNumber:"Q28920052"},ti={MaybeBoolean:["Union","Boolean",["Set","Maybe"]],NaturalNumber:["Union","CompositeNumber","PrimeNumber"],Scalar:["Intersection","Row","Column"],TriangularMatrix:["Union","UpperTriangularMatrix","LowerTriangularMatrix"],Vector:["Union","Row","Column"]},ri={Boolean:2,MaybeBoolean:3,EmptySet:0,IdentityMatrix:1,ZeroMatrix:1,NumberZero:1},oi={Range:{range:"ParametricDomain",evaluate:(e,i,n)=>(i=Math.round(i),n=Math.round(n),Number.isNaN(i)||Number.isNaN(n)||i>n?"EmptySet":i===-1/0&&n===1/0?"Integer":0===i&&n===1/0?"NaturalNumber":0===i&&0===n?"NumberZero":["Range",i,n])},Interval:{range:"ParametricDomain",evaluate:(e,i,n)=>Number.isNaN(i)||Number.isNaN(n)||i>n?"EmptySet":i===-1/0&&n===1/0?"RealNumber":0===i&&0===n?"NumberZero":["Interval",i,n]}};function si(e,i,n){if(null===i)return null;const t=ci(e);return ""===t?n:n[t]?null===li(i,n[t])?null:n:(n[t]=i,n)}function ai(e,i,n,t){var r;const o=G(i);if(null!==o)return Math.abs(o-(null!==(r=G(e))&&void 0!==r?r:NaN))<=t.numericalTolerance?n:null;const s=J(i);if(null!==s)return J(e)===s?n:null;const a=ce(i);if(null!==a){const i=Object.keys(a),r=ce(e);if(null===r)return null;if(Object.keys(r).length!==i.length)return null;for(const e of i){const i=ai(r[e],a[e],n,t);if(null===i)return null;n=i;}return n}const l=re(i);if(null!==l)return l.startsWith("_")?si(l,e,n):l===re(e)?"object"==typeof i&&"object"==typeof e&&"wikidata"in i&&"wikidata"in e&&i.wikidata!==e.wikidata?null:n:"object"==typeof i&&"object"==typeof e&&"wikidata"in i&&"wikidata"in e&&i.wikidata===e.wikidata?n:null;const u=ie(i);if(null===u)return null;if("string"==typeof u&&u.startsWith("_"))return si(u,ie(e),n);{const i=ie(e);if(null===i)return null;if(null===li(u,i,t))return null}const c=oe(i),m=oe(e),f=c.length;if(f!==m.length)return null;let h={...n},p=0;for(;p<f;){const e=c[p],i=re(e);if(null!==i)if(i.startsWith("__")){let e=0;if(void 0===c[p+1])e=m.length+1;else {let i=!1;for(;!i&&e<m.length;)i=null!==li(c[p+1],m[e],t),e+=1;if(!i)return null}if(!i.startsWith("___")&&e<=1)return null;h=si(i,["Sequence",...m.splice(0,e-1)],h);}else if(i.startsWith("_"))h=si(i,m.shift(),h);else {const i=li(e,m.shift(),t);if(null===i)return null;h={...h,...i};}else {const i=li(e,m.shift(),t);if(null===i)return null;h={...h,...i};}if(null===h)return null;p+=1;}return h}function li(e,i,n){return ai(i,e,{},null!=n?n:{numericalTolerance:E})}function ci(e){const i=e.match(/^__?_?([a-zA-Z0-9]+)/);return null===i?"":i[1]}class mi{constructor(e){this._items=e?new Map(e instanceof mi?e._items:e):new Map;}has(e){for(const i of this._items.keys())if(li(e,i))return !0;return !1}get(e){for(const[i,n]of this._items)if(li(e,i))return n}set(e,i){for(const n of this._items.keys())if(li(e,n))return void this._items.set(n,i);this._items.set(e,i);}delete(e){this._items.delete(e);}[Symbol.iterator](){return this._items.entries()}entries(){return this._items.entries()}}const fi=["Sqrt",2],hi=["Sqrt",3],pi=["Sqrt",5],gi=["Sqrt",6],di=new mi([[["Divide","Pi",12],{Sin:["Divide",["Subtract",gi,fi],4],Cos:["Divide",["Add",gi,fi],4],Tan:["Subtract",[2,hi]],Cot:["Add",[2,hi]],Sec:["Subtract",[gi,fi]],Csc:["Add",[gi,fi]]}],[["Divide","Pi",10],{Sin:["Divide",["Subtract",pi,1],4],Cos:["Divide",["Sqrt",["Add",10,["Multiply",2,pi]]],4],Tan:["Divide",["Sqrt",["Subtract",25,["Multiply",10,pi]]],4],Cot:["Sqrt",["Add",5,["Multiply",2,pi]]],Sec:["Divide",["Sqrt",["Subtract",50,["Multiply",10,pi]]],5],Csc:["Add",1,pi]}],[["Divide","Pi",4],{Sin:["Divide",fi,2],Cos:["Divide",fi,2],Tan:1,Cot:1,Sec:fi,Csc:fi}],[["Divide","Pi",3],{Sin:["Divide",hi,2],Cos:"Half",Tan:hi,Cot:["Divide",hi,3],Sec:2,Csc:["Divide",["Multiply",2,hi],3]}],[["Divide","Pi",2],{Sin:1,Cos:0,Tan:1/0,Cot:0,Sec:1/0,Csc:1}]]),vi={Degrees:{domain:"Real",constant:!0,value:.017453292519943295},MinusDoublePi:{domain:"TranscendentalNumber",constant:!0,hold:!1,value:[L,-2,"Pi"]},MinusPi:{domain:"TranscendentalNumber",constant:!0,hold:!1,value:[_,"Pi"]},MinusHalfPi:{domain:"TranscendentalNumber",constant:!0,hold:!1,value:[z,[_,"Pi"],2]},QuarterPi:{domain:"TranscendentalNumber",constant:!0,hold:!1,value:[z,"Pi",4]},ThirdPi:{domain:"TranscendentalNumber",constant:!0,hold:!1,value:[z,"Pi",3]},HalfPi:{domain:"TranscendentalNumber",constant:!0,hold:!1,value:[z,"Pi",2]},TwoThirdPi:{domain:"TranscendentalNumber",constant:!0,hold:!1,value:[L,2,[z,"Pi",3]]},ThreeQuarterPi:{domain:"TranscendentalNumber",constant:!0,hold:!1,value:[L,3,[z,"Pi",4]]},Pi:{domain:"TranscendentalNumber",constant:!0,wikidata:"Q167",value:e=>"decimal"===e.numericFormat?c.exports.Decimal.acos(-1):"complex"===e.numericFormat?m.exports.Complex.PI:Math.PI},DoublePi:{domain:"TranscendentalNumber",constant:!0,hold:!1,value:[L,2,"Pi"]},Arccos:{domain:"TrigonometricFunction",range:["Interval",0,"Pi"],numeric:!0,value:["Subtract","HalfPi",["Arcsin","_"]],simplify:(e,i)=>{var n,t;return null!==(t=null===(n=di.get(i))||void 0===n?void 0:n.Arccos)&&void 0!==t?t:["Subtract","HalfPi",["Arcsin",i]]},evalNumber:(e,i)=>Math.acos(i),evalDecimal:(e,i)=>c.exports.Decimal.acos(i),evalComplex:(e,i)=>m.exports.Complex.acos(i)},Arcosh:{domain:"HyperbolicFunction",range:["Interval",0,1/0],numeric:!0,value:["Ln",["Add","_",["Sqrt",["Subtract",["Square","_"],1]]]],simplify:(e,i)=>{var n,t;return null!==(t=null===(n=di.get(i))||void 0===n?void 0:n.Arccosh)&&void 0!==t?t:["Ln",["Add",i,["Sqrt",["Subtract",["Square",i],1]]]]},evalNumber:(e,i)=>Math.acosh(i),evalDecimal:(e,i)=>c.exports.Decimal.acosh(i),evalComplex:(e,i)=>m.exports.Complex.acosh(i)},Arcsin:{domain:"TrigonometricFunction",range:["Interval","MinusHalfPi","HalfPi"],numeric:!0,simplify:(e,i)=>{var n,t;return null!==(t=null===(n=di.get(i))||void 0===n?void 0:n.Arcsin)&&void 0!==t?t:["Multiply",2,["Arctan2",i,["Add",1,["Sqrt",["Subtract",1,["Square",i]]]]]]},value:["Multiply",2,["Arctan2","_",["Add",1,["Sqrt",["Subtract",1,["Square","_"]]]]]],evalNumber:(e,i)=>Math.asin(i),evalDecimal:(e,i)=>c.exports.Decimal.asin(i),evalComplex:(e,i)=>m.exports.Complex.asin(i)},Arsinh:{domain:"HyperbolicFunction",range:["Interval",-1/0,1/0],numeric:!0,simplify:(e,i)=>{var n,t;return null!==(t=null===(n=di.get(i))||void 0===n?void 0:n.Arsinh)&&void 0!==t?t:["Ln",["Add",i,["Sqrt",["Add",["Square",i],1]]]]},value:["Ln",["Add","_",["Sqrt",["Add",["Square","_"],1]]]],evalNumber:(e,i)=>Math.asinh(i),evalDecimal:(e,i)=>c.exports.Decimal.asinh(i),evalComplex:(e,i)=>m.exports.Complex.asinh(i)},Arctan:{wikidata:"Q2257242",domain:"TrigonometricFunction",range:["Interval","MinusHalfPi","HalfPi"],numeric:!0,simplify:(e,i)=>{var n,t;return null!==(t=null===(n=di.get(i))||void 0===n?void 0:n.Arctan)&&void 0!==t?t:i},evalNumber:(e,i)=>Math.atan(i),evalDecimal:(e,i)=>c.exports.Decimal.atan(i),evalComplex:(e,i)=>m.exports.Complex.atan(i)},Arctan2:{wikidata:"Q776598",range:["Interval","MinusPi","Pi"],domain:"TrigonometricFunction",numeric:!0,evalNumber:(e,i,n)=>Math.atan2(i,n),evalDecimal:(e,i,n)=>c.exports.Decimal.atan2(i,n),evalComplex:(e,i,n)=>m.exports.Complex.atan2(i,n)},Artanh:{domain:"HyperbolicFunction",range:["Interval",-1/0,1/0],numeric:!0,simplify:(e,i)=>{var n,t;return null!==(t=null===(n=di.get(i))||void 0===n?void 0:n.Artanh)&&void 0!==t?t:["Multiply","Half",["Ln",["Divide",["Add",1,i],["Subtract",1,i]]]]},value:["Multiply","Half",["Ln",["Divide",["Add",1,"_"],["Subtract",1,"_"]]]],evalNumber:(e,i)=>Math.atanh(i),evalDecimal:(e,i)=>c.exports.Decimal.atanh(i),evalComplex:(e,i)=>m.exports.Complex.atanh(i)},Cosh:{domain:"HyperbolicFunction",range:["Interval",1,1/0],numeric:!0,simplify:(e,i)=>{var n,t;return null!==(t=null===(n=di.get(i))||void 0===n?void 0:n.Cosh)&&void 0!==t?t:i},value:["Multiply","Half",["Add",["Exp","_"],["Exp",["Negate","_"]]]],evalNumber:(e,i)=>Math.cosh(i),evalDecimal:(e,i)=>c.exports.Decimal.cosh(i),evalComplex:(e,i)=>m.exports.Complex.cosh(i)},Cos:{domain:"TrigonometricFunction",range:["Interval",-1,1],numeric:!0,simplify:(e,i)=>{var n,t;return null!==(t=null===(n=di.get(i))||void 0===n?void 0:n.Cos)&&void 0!==t?t:["Sin",["Add",i,"HalfPi"]]},value:["Sin",["Add","_","HalfPi"]],evalNumber:(e,i)=>Math.cos(i),evalDecimal:(e,i)=>c.exports.Decimal.cos(i),evalComplex:(e,i)=>m.exports.Complex.cos(i)},Cot:{domain:"TrigonometricFunction",range:"ComplexNumber",numeric:!0,simplify:(e,i)=>{var n,t;return null!==(t=null===(n=di.get(i))||void 0===n?void 0:n.Cot)&&void 0!==t?t:["Divide",["Cos",i],["Sin",i]]},value:["Divide",["Cos","_"],["Sin","_"]],evalNumber:(e,i)=>1/Math.tan(i),evalDecimal:(e,i)=>h.div(c.exports.Decimal.tan(i)),evalComplex:(e,i)=>m.exports.Complex.ONE.div(m.exports.Complex.tan(i))},Coth:{domain:"HyperbolicFunction",range:"ComplexNumber",numeric:!0,simplify:(e,i)=>{var n,t;return null!==(t=null===(n=di.get(i))||void 0===n?void 0:n.Coth)&&void 0!==t?t:["Divide",1,["Tanh",i]]},value:["Divide",1,["Tanh","_"]],evalNumber:(e,i)=>1/Math.tanh(i),evalDecimal:(e,i)=>h.div(c.exports.Decimal.tanh(i)),evalComplex:(e,i)=>m.exports.Complex.ONE.div(m.exports.Complex.tanh(i))},Csc:{domain:"TrigonometricFunction",range:["Interval",-1,1],numeric:!0,simplify:(e,i)=>{var n,t;return null!==(t=null===(n=di.get(i))||void 0===n?void 0:n.Csc)&&void 0!==t?t:["Divide",1,["Sin",i]]},value:["Divide",1,["Sin","_"]],evalNumber:(e,i)=>1/Math.tanh(i),evalDecimal:(e,i)=>h.div(c.exports.Decimal.tanh(i)),evalComplex:(e,i)=>m.exports.Complex.ONE.div(m.exports.Complex.tanh(i))},Csch:{domain:"HyperbolicFunction",range:["Interval",-1,1],numeric:!0,simplify:(e,i)=>{var n,t;return null!==(t=null===(n=di.get(i))||void 0===n?void 0:n.Csch)&&void 0!==t?t:["Divide",1,["Sinh",i]]},value:["Divide",1,["Sinh","_"]],evalNumber:(e,i)=>1/Math.sinh(i),evalDecimal:(e,i)=>h.div(c.exports.Decimal.sinh(i)),evalComplex:(e,i)=>m.exports.Complex.ONE.div(m.exports.Complex.sinh(i))},FromPolarCoordinates:{domain:"Function",range:["TupleOf","RealNumber","RealNumber"]},Haversine:{wikidata:"Q2528380",domain:"TrigonometricFunction",range:["Interval",0,1],value:["Divide",["Subtract",1,["Cos","_"]],2],numeric:!0},Hypot:{domain:"Function",range:["Interval",0,1/0],value:["Sqrt",["Square","_"],["Square","_2"]],evalNumber:(e,i,n)=>Math.sqrt(i*i*+n*n),evalDecimal:(e,i,n)=>c.exports.Decimal.sqrt(i.mul(i).add(n.mul(n))),evalComplex:(e,i,n)=>m.exports.Complex.sqrt(i.mul(i).add(n.mul(n)))},InverseFunction:{domain:"Function",range:"Function",simplify:(e,i)=>{var n,t;const r=null!==(n=le(i,1))&&void 0!==n?n:P;return "string"!=typeof r?i:null!==(t={Sin:"Arcsin",Cos:"Arccos",Tan:"Arctan",Sec:"Arcsec",Csc:" Arccsc",Sinh:"Arsinh",Cosh:"Arcosh",Tanh:"Artanh",Sech:"Arcsech",Csch:"Arcsch",Arcosh:"Cosh",Arcos:"Cos",Arccsc:"Csc",Arcsch:"Csch",Arcsec:"Sec",Arcsin:"Sin",Arsinh:"Sinh",Arctan:"Tan",Artanh:"Tanh"}[r])&&void 0!==t?t:i}},InverseHaversine:{domain:"TrigonometricFunction",range:["Interval",["MinusPi"],"Pi"],numeric:!0,value:["Multiply",2,["Arcsin",["Sqrt","_"]]]},Sec:{domain:"TrigonometricFunction",range:["Interval",-1,1],numeric:!0,simplify:(e,i)=>{var n,t;return null!==(t=null===(n=di.get(i))||void 0===n?void 0:n.Sec)&&void 0!==t?t:["Divide",1,["Cos",i]]},value:["Divide",1,["Cos","_"]],evalNumber:(e,i)=>1/Math.cos(i),evalDecimal:(e,i)=>h.div(c.exports.Decimal.cos(i)),evalComplex:(e,i)=>m.exports.Complex.ONE.div(m.exports.Complex.cos(i))},Sech:{domain:"HyperbolicFunction",range:["Interval",-1,1],numeric:!0,simplify:(e,i)=>{var n,t;return null!==(t=null===(n=di.get(i))||void 0===n?void 0:n.Sech)&&void 0!==t?t:["Divide",1,["Cosh",i]]},value:["Divide",1,["Cosh","_"]],evalNumber:(e,i)=>1/Math.cosh(i),evalDecimal:(e,i)=>h.div(c.exports.Decimal.cosh(i)),evalComplex:(e,i)=>m.exports.Complex.ONE.div(m.exports.Complex.cosh(i))},Sinh:{domain:"HyperbolicFunction",range:["Interval",-1/0,1/0],numeric:!0,simplify:(e,i)=>{var n,t;return null!==(t=null===(n=di.get(i))||void 0===n?void 0:n.Sinh)&&void 0!==t?t:["Multiply","Half",["Subtract",["Exp",i],["Exp",["Negate",i]]]]},value:["Multiply","Half",["Subtract",["Exp","_"],["Exp",["Negate","_"]]]]},Sin:{domain:"TrigonometricFunction",range:["Interval",-1,1],numeric:!0,simplify:(e,i)=>{var n,t;return null!==(t=null===(n=di.get(i))||void 0===n?void 0:n.Sin)&&void 0!==t?t:i},value:["Divide",["Subtract",["Exp",["Multiply","ImaginaryUnit","_"]],["Exp",["Multiply","ImaginaryUnit",["Negate","_"]]]],["Multiply",2,"ImaginaryUnit"]],evalNumber:(e,i)=>Math.sin(i),evalDecimal:(e,i)=>i.sin(),evalComplex:(e,i)=>i.sin()},Tanh:{domain:"HyperbolicFunction",range:["Interval",-1/0,1/0],numeric:!0,simplify:(e,i)=>{var n,t;return null!==(t=null===(n=di.get(i))||void 0===n?void 0:n.Tanh)&&void 0!==t?t:["Divide",["Sinh",i],["Cosh",i]]},value:["Divide",["Sinh","_"],["Cosh","_"]],evalNumber:(e,i)=>Math.tanh(i),evalDecimal:(e,i)=>i.tanh(),evalComplex:(e,i)=>i.tanh()},Tan:{domain:"TrigonometricFunction",range:"RealNumber",numeric:!0,simplify:(e,i)=>{var n,t;return null!==(t=null===(n=di.get(i))||void 0===n?void 0:n.Tan)&&void 0!==t?t:["Divide",["Sin",i],["Cos",i]]},value:["Divide",["Sin","_"],["Cos","_"]],evalNumber:(e,i)=>Math.tan(i),evalDecimal:(e,i)=>i.tan(),evalComplex:(e,i)=>i.tan()},ToPolarCoordinates:{domain:"Function",range:["TupleOf","RealNumber","RealNumber"]}};({arithmetic:Ee,algebra:{},calculus:{},combinatorics:{},complex:{},core:{Apply:{domain:"Function",range:"Anything"},About:{domain:"Function",range:"Dictionary"},BaseForm:{domain:"Function",range:"Integer"},Block:{domain:"Function",range:"Anything"},Domain:{domain:"ParametricDomain",range:"Domain"},Evaluate:{domain:"Function",range:"Anything"},Parentheses:{domain:"Function",threadable:!0,pure:!1,range:"Anything"},Head:{domain:"Function",range:"Anything"},Lambda:{domain:"Function",wikidata:"Q567612",hold:"all",range:"Anything"},Latex:{domain:"Function",range:"String"},String:{domain:"Function",threadable:!0,range:"String"},Symbol:{domain:"Function",threadable:!0,range:"Symbol"},Tail:{domain:"Function",range:"List"}},collections:{EmptySet:{domain:"EmptySet",constant:!0,wikidata:"Q226183"},CartesianProduct:{domain:"Function",wikidata:"Q173740",range:"Set",evaluate:function(e,i,n){return "EmptySet"}},Intersection:{domain:"Function",wikidata:"Q185837",threadable:!0,associative:!0,commutative:!0,idempotent:!0,involution:!0,range:"Set",evaluate:function(e,...i){return "EmptySet"}},Complement:{domain:"Function",wikidata:"Q242767",range:"Set"},Union:{domain:"Function",wikidata:"Q185359",threadable:!0,associative:!0,commutative:!0,idempotent:!0,involution:!0,range:"Set",evaluate:function(e,...i){return "EmptySet"}},SymmetricDifference:{domain:"Function",wikidata:"Q1147242",range:"Set"},Subset:{domain:"Predicate",range:"MaybeBoolean",evaluate:function(e,i,n){return "False"}},SubsetEqual:{domain:"Predicate",range:"MaybeBoolean",evaluate:function(e,i,n){return "False"}},SetMinus:{domain:"Function",wikidata:"Q18192442",range:"MaybeBoolean",evaluate:function(e,i,n){return "EmptySet"}}},domains:function(){var e;const i={Nothing:{countable:!0,supersets:[],domain:"Domain"}};for(const n of Object.keys(ii)){const t=Array.isArray(ii[n])?ii[n]:[ii[n]];i[n]=null!==(e=oi[n])&&void 0!==e?e:{},i[n]={domain:oi[n]?"ParametricDomain":"Domain",wikidata:ni[n],supersets:t,value:ti,countable:void 0!==ri[n],size:()=>ri[n],...i[n]};for(const e of t)if("Anything"!==e&&!ii[e])throw new Error(`Unknown parent of domain "${n}": "${e}"`)}const n=new Set;for(const e of Object.keys(i))n.add(e);for(const e of Object.keys(i))for(const t of i[e].supersets)n.delete(t);n.delete("Nothing"),i.Nothing.supersets=[...n.values()];for(const e of Object.keys(i)){let n=!1,t=0,r=[e];for(;t<512&&!n;){const e=r.pop();n="Anything"===e,n||(r=[...e,...i[e].supersets]),t++;}if(!n)throw new Error(`The "${e}" domain cannot reach "Anything"`)}return i}(),dimensions:{},logic:{True:{domain:"Boolean",constant:!0},False:{domain:"Boolean",constant:!0},Maybe:{domain:"MaybeBoolean",constant:!0},And:{domain:"LogicalFunction",threadable:!0,associative:!0,commutative:!0,idempotent:!0,range:"MaybeBoolean"},Or:{domain:"LogicalFunction",threadable:!0,associative:!0,commutative:!0,idempotent:!0,range:"MaybeBoolean"},Not:{domain:"LogicalFunction",involution:!0,range:"MaybeBoolean"},Equivalent:{domain:"LogicalFunction",range:"MaybeBoolean"},Implies:{domain:"LogicalFunction",range:"MaybeBoolean"},Exists:{domain:"LogicalFunction",range:"MaybeBoolean"},Equal:{domain:"LogicalFunction",range:"MaybeBoolean"},NotEqual:{domain:"Function",wikidata:"Q28113351",commutative:!0,range:"MaybeBoolean"}},inequalities:{},intervals:{},"linear-algebra":{},numeric:{},other:{},polynomials:{},physics:{"Mu-0":{constant:!0,wikidata:"Q1515261",domain:"RealNumber",value:125663706212e-17,unit:[L,"H",[R,"m",-1]]}},relations:{},rounding:{},statistics:{},transcendentals:{},trigonometry:vi,units:{}});

// @ts-ignore
const mathlivePromise = import('./mathlive.min-8f27b5fa.js');
let previouslyFocusedCell = null;
let previousCaretPoint = null;
function useContextMenu(lit) {
    const styles = `
.mathlive-context-menu {
  position: fixed;
  z-index: 1000;
  display: none;
  padding: 0px;
  margin: 0;
  font-size: 1rem;
  color: #212529;
  text-align: left;
  background-color: #fff;
  background-clip: padding-box;
  border: 1px solid rgba(0,0,0,.15);
  border-radius: var(--border-radius);
  opacity: 1;
}
.mathlive-context-menu.show {
  display: block;
}
.mathlive-context-menu.transparent {
  opacity: 0;
}
.mathlive-context-menu ul {
  padding: 0;
  margin: 0;
  list-style: none;
}
.mathlive-context-menu li {
  padding: 0px;
  margin: 0px;
}
.mathlive-context-menu .context-menu-header {
  display: block;
  margin-bottom: 0;
  font-size: .875rem;
  color: #6c757d;
  white-space: nowrap;
  padding: .5rem 1rem;
}
.mathlive-context-menu .context-menu-button {
  display: block;
  width: 100%;
  margin: 0px;
  padding: .25rem 1rem;
  text-align: start;
  background: initial;
  border: 0px;
}
.mathlive-context-menu .context-menu-button:hover {
  cursor: pointer;
  background: #e9ecef;
}
`;
    // Context menu with focusable entries
    // https://itnext.io/how-to-create-a-custom-right-click-menu-with-javascript-9c368bb58724
    // https://stackoverflow.com/questions/152975/how-do-i-detect-a-click-outside-an-element
    const contextMenu = document.createElement("div");
    contextMenu.classList.add("mathlive-context-menu");
    contextMenu.style.minWidth = "244px";
    let copyCallback = (type) => { };
    let styleCallback = (style) => { };
    let contextMenuCloseTimeout = null;
    contextMenu.addEventListener("focusin", (ev) => {
        if (contextMenuCloseTimeout !== null)
            clearTimeout(contextMenuCloseTimeout);
    });
    contextMenu.addEventListener("focusout", (ev) => {
        contextMenuCloseTimeout = setTimeout((() => {
            contextMenu.classList.remove("show");
        }), 0);
    });
    contextMenu.addEventListener("keydown", (ev) => {
        if (ev.key === "Escape") {
            contextMenu.classList.remove("show");
        }
    });
    lit.render(lit.html `<ul>
  <li><h6 class="context-menu-header">Format</h6></li>
  <li>
    <button
      title="Clear Formatting"
      class="context-menu-button" 
      tabindex="0"
      @click=${() => {
        styleCallback({
            color: "",
        });
        contextMenu.classList.remove("show");
    }}
    >
     Clear
    </button>
    <button
      title="Text Color"
      class="context-menu-button" 
      tabindex="0"
      @click=${() => {
        styleCallback({
            color: "red",
        });
        contextMenu.classList.remove("show");
    }}
    >
     Color
    </button>
  </li>
  <li><h6 class="context-menu-header">Copy as</h6></li>
  <li>
    <button
      title="Kinky"
      class="context-menu-button" 
      tabindex="0"
      @click=${() => {
        copyCallback("latex-expanded");
        contextMenu.classList.remove("show");
    }}
    >
     Latex Expanded
    </button>
  </li>
  <li>
    <button
      title="Asciimath"
      class="context-menu-button" 
      tabindex="0"
      @click=${() => {
        copyCallback("ascii-math");
        contextMenu.classList.remove("show");
    }}
    >
    Asciimath
    </button>
  </li>
  <li>
    <button
      title="MathJson"
      class="context-menu-button" 
      tabindex="0"
      @click=${() => {
        copyCallback("math-json");
        contextMenu.classList.remove("show");
    }}
    >
    MathJson
    </button>
  </li>
</ul>`, contextMenu);
    function showContextMenu(opts) {
        // https://itnext.io/how-to-create-a-custom-right-click-menu-with-javascript-9c368bb58724
        // Check what starboard does for some of the popup menus
        copyCallback = opts.copyCallback;
        styleCallback = opts.styleCallback;
        contextMenu.classList.add("transparent");
        contextMenu.classList.add("show");
        const boundingRect = contextMenu.getBoundingClientRect();
        // document.documentElement.clientHeight
        if (opts.x + boundingRect.width <= document.documentElement.clientWidth) {
            contextMenu.style.left = opts.x + "px";
        }
        else {
            contextMenu.style.left =
                document.documentElement.clientWidth - boundingRect.width + "px";
        }
        contextMenu.style.top = opts.y + "px";
        setTimeout(() => {
            contextMenu.classList.remove("transparent");
            contextMenu.querySelector(".first-focusable")?.focus();
        });
    }
    return { styles, contextMenu, showContextMenu };
}
function parseCellContent(textContent) {
    // Parse mathjson and use latex as fallback content
    // It's like this for now, because mathjson is still in beta, I guess
    const cellText = textContent;
    if (cellText.startsWith("$") && cellText.endsWith("$")) {
        return cellText.replace(/^\$+|\$+$/g, "");
    }
    else {
        let lines = cellText.split("\n").filter((v) => v.length > 0);
        let parsedMathJson = "";
        try {
            parsedMathJson = Ve(JSON.parse(lines[0]));
        }
        catch (e) {
            parsedMathJson = "";
        }
        if (parsedMathJson) {
            return parsedMathJson;
        }
        else if (lines.length > 1) {
            return lines[1].replace(/^\$+|\$+$/g, "");
        }
    }
    return "";
}
function registerMathlive(runtime) {
    /* These globals are exposed by Starboard Notebook. We can re-use them so we don't have to bundle them again. */
    const lit = runtime.exports.libraries.lit;
    runtime.exports.elements.StarboardTextEditor;
    runtime.exports.templates.cellControls;
    // Definitely a hack
    // @ts-ignore
    window["mathlive-to-expanded-latex"] = async function mathliveSerializer() {
        const ml = await mathlivePromise;
        const editor = new ml.MathfieldElement({
            defaultMode: "math",
            keypressSound: null,
            plonkSound: null,
            keypressVibration: false,
        });
        editor.style.opacity = "0";
        editor.style.pointerEvents = "none";
        document.body.appendChild(editor);
        function toExpandedLatex(textContent) {
            editor.value = parseCellContent(textContent);
            console.log(editor.getValue("latex-expanded"));
            return editor.getValue("latex-expanded");
        }
        function dispose() {
            document.body.removeChild(editor);
        }
        return {
            toExpandedLatex,
            dispose,
        };
    };
    const { styles: contextMenuStyles, contextMenu, showContextMenu, } = useContextMenu(lit);
    document.head.insertAdjacentHTML("beforeend", `<style>math-field:hover,
  math-field:focus,
  math-field:focus-within {
    outline: var(--border-color-secondary) auto 1px;
  }
  math-field {
    transition: outline 0.2s ease-in-out;
  }
  ${contextMenuStyles}
  </style>`);
    document.body.appendChild(contextMenu);
    const MATHLIVE_CELL_TYPE_DEFINITION = {
        name: "Mathlive",
        cellType: ["mathlive"],
        createHandler: (cell, runtime) => new MathLiveCellHandler(cell, runtime),
    };
    class MathLiveCellHandler {
        elements;
        editor;
        cell;
        runtime;
        constructor(cell, runtime) {
            this.cell = cell;
            this.runtime = runtime;
        }
        attach(params) {
            this.elements = params.elements;
            // TODO: More of this stuff https://github.com/stefnotch/quantum-sheet/blob/master/src/ui/elements/ExpressionElement.vue
            mathlivePromise.then((ml) => {
                const editor = new ml.MathfieldElement({
                    defaultMode: "math",
                    // smartSuperscript: true,
                    removeExtraneousParentheses: true,
                    smartFence: true,
                    plonkSound: null,
                    keypressSound: null,
                    onContentDidChange: (mf) => {
                        this.cell.textContent =
                            mf.getValue("math-json").replace(/\n/g, "") +
                                "\n$" +
                                mf.getValue("latex") +
                                "$";
                    },
                    onCommit: (mf) => {
                        this.run();
                    },
                    onMoveOutOf: (mf, direction) => {
                        if (direction === "upward") {
                            this.runtime.controls.emit({
                                type: "FOCUS_CELL",
                                id: this.cell.id,
                                focus: "previous",
                            });
                            previouslyFocusedCell = this.cell.id;
                            previousCaretPoint = editor.caretPoint;
                            return false;
                        }
                        else if (direction === "downward") {
                            this.runtime.controls.emit({
                                type: "FOCUS_CELL",
                                id: this.cell.id,
                                focus: "next",
                            });
                            previouslyFocusedCell = this.cell.id;
                            previousCaretPoint = editor.caretPoint;
                            return false;
                        }
                        else if (direction === "backward") {
                            editor.executeCommand("moveToMathFieldEnd");
                            return false;
                        }
                        else if (direction === "forward") {
                            editor.executeCommand("moveToMathFieldStart");
                            return false;
                        }
                        return true;
                    },
                    onExport: (mf, latex, range) => {
                        return `$\\displaystyle ${latex}$`;
                    },
                });
                editor.addEventListener("pointerup", (ev) => {
                    if (ev.button === 2) {
                        showContextMenu({
                            x: ev.clientX,
                            y: ev.clientY,
                            copyCallback: function (type) {
                                let isSelectionNone = editor.selection.ranges.every((range) => range[0] === range[1]);
                                const selectedText = isSelectionNone
                                    ? editor.getValue(type)
                                    : editor.getValue(editor.selection, type);
                                navigator.clipboard.writeText(selectedText + "").then(function () {
                                    console.log("Copied to clipboard");
                                }, function (e) {
                                    console.log("Failed to copy to clipboard", e);
                                });
                            },
                            styleCallback: function (style) {
                                let isSelectionNone = editor.selection.ranges.every((range) => range[0] === range[1]);
                                if (!isSelectionNone) {
                                    editor.applyStyle(style);
                                }
                            },
                        });
                    }
                });
                editor.addEventListener("contextmenu", (e) => {
                    e.preventDefault();
                    return false;
                });
                // TODO: Fix cdot
                editor.value = parseCellContent(this.cell.textContent);
                editor.style.fontSize = "18px";
                // Later down the road we can use "adoptedStyleSheets"
                const caretCustomStyle = document.createElement("style");
                caretCustomStyle.innerHTML = `.ML__caret:after {
          border-right-width: 0px !important;
          margin-right: 0px !important;
          width: 0px !important;
          box-shadow: 0px 0px 0px 1px var(--caret,hsl(var(--hue,212),40%,49%));
         }`;
                editor.shadowRoot?.appendChild?.(caretCustomStyle);
                this.editor = editor;
                this.elements.topElement.appendChild(editor);
            });
        }
        focusEditor(opts) {
            this.editor?.focus?.();
            this.editor?.executeCommand?.("moveToMathFieldStart");
            const editor = this.editor;
            if (previouslyFocusedCell != null &&
                previousCaretPoint != null &&
                editor != null) {
                let previousIndex = this.runtime.content.cells.findIndex((c) => previouslyFocusedCell === c.id);
                let thisIndex = this.runtime.content.cells.findIndex((c) => this.cell.id === c.id);
                if (previousIndex >= 0 &&
                    (previousIndex + 1 === thisIndex || previousIndex - 1 === thisIndex)) {
                    const editorRect = editor.getBoundingClientRect();
                    editor.setCaretPoint(previousCaretPoint.x, opts?.position === "end" ? editorRect.bottom : editorRect.top);
                    previouslyFocusedCell = null;
                    previousCaretPoint = null;
                }
            }
        }
        async run() {
            // TODO: Ask the CAS
        }
        clear() {
            // Nothing to to do, so eh
        }
        async dispose() {
            const editor = this.editor;
            if (editor) {
                this.elements.topElement.removeChild(editor);
            }
        }
    }
    runtime.definitions.cellTypes.register(MATHLIVE_CELL_TYPE_DEFINITION.cellType, MATHLIVE_CELL_TYPE_DEFINITION);
}
const plugin = {
    id: "starboard-mathlive",
    metadata: {
        name: "Starboard Mathlive",
    },
    exports: {},
    async register(runtime, opts = {}) {
        registerMathlive(runtime);
    },
};

export { plugin, registerMathlive };
